<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="CP Templates">
<meta property="og:url" content="http://example.com/2021/04/23/CP%20Templates/index.html">
<meta property="og:site_name" content="c4Lnn 的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-23T07:45:28.000Z">
<meta property="article:modified_time" content="2023-04-09T06:41:26.964Z">
<meta property="article:author" content="c4Lnn">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/04/23/CP%20Templates/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2021/04/23/CP%20Templates/","path":"2021/04/23/CP Templates/","title":"CP Templates"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CP Templates | c4Lnn 的个人博客</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?f7cb2b1476d95c63da4b0abb7b0eb0a5"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">c4Lnn 的个人博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Head"><span class="nav-number">1.1.</span> <span class="nav-text">Head</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E8%AF%BB%E5%85%A5"><span class="nav-number">1.2.</span> <span class="nav-text">快速读入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%8B%8D"><span class="nav-number">1.3.</span> <span class="nav-text">对拍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows"><span class="nav-number">1.3.1.</span> <span class="nav-text">Windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux"><span class="nav-number">1.3.2.</span> <span class="nav-text">Linux</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E8%A1%A8%E7%A4%BA%E6%B3%95"><span class="nav-number">2.1.</span> <span class="nav-text">最小表示法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KMP"><span class="nav-number">2.2.</span> <span class="nav-text">KMP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95-KMP"><span class="nav-number">2.3.</span> <span class="nav-text">扩展 KMP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Manacher"><span class="nav-number">2.4.</span> <span class="nav-text">Manacher</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trie-%E6%A0%91"><span class="nav-number">2.5.</span> <span class="nav-text">Trie 树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AC-%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">2.6.</span> <span class="nav-text">AC 自动机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.7.</span> <span class="nav-text">Hash 字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84"><span class="nav-number">2.8.</span> <span class="nav-text">后缀数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">2.9.</span> <span class="nav-text">后缀自动机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%BF%E4%B9%89%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">2.10.</span> <span class="nav-text">广义后缀自动机</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92"><span class="nav-number">3.</span> <span class="nav-text">动态规划</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98"><span class="nav-number">3.1.</span> <span class="nav-text">背包问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#01-%E8%83%8C%E5%8C%85"><span class="nav-number">3.1.1.</span> <span class="nav-text">01 背包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E8%83%8C%E5%8C%85"><span class="nav-number">3.1.2.</span> <span class="nav-text">完全背包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E9%87%8D%E8%83%8C%E5%8C%85"><span class="nav-number">3.1.3.</span> <span class="nav-text">多重背包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E8%83%8C%E5%8C%85"><span class="nav-number">3.1.4.</span> <span class="nav-text">分组背包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4-DP"><span class="nav-number">3.2.</span> <span class="nav-text">区间 DP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8A%B6%E5%8E%8B-DP"><span class="nav-number">3.3.</span> <span class="nav-text">状压 DP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E4%BD%8D-DP"><span class="nav-number">3.4.</span> <span class="nav-text">数位 DP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96"><span class="nav-number">3.5.</span> <span class="nav-text">斜率优化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">4.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="nav-number">4.1.</span> <span class="nav-text">并查集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ST-%E8%A1%A8"><span class="nav-number">4.2.</span> <span class="nav-text">ST 表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="nav-number">4.3.</span> <span class="nav-text">树状数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">4.4.</span> <span class="nav-text">线段树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">4.5.</span> <span class="nav-text">可持久化线段树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="nav-number">4.6.</span> <span class="nav-text">平衡树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Splay-%E6%A0%91"><span class="nav-number">4.6.1.</span> <span class="nav-text">Splay 树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E5%A5%97%E6%A0%91"><span class="nav-number">4.7.</span> <span class="nav-text">树套树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E5%A5%97%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">4.7.1.</span> <span class="nav-text">树状数组套可持久化线段树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%AB%E9%98%9F"><span class="nav-number">4.8.</span> <span class="nav-text">莫队</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E8%8E%AB%E9%98%9F"><span class="nav-number">4.8.1.</span> <span class="nav-text">普通莫队</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E4%BF%AE%E8%8E%AB%E9%98%9F"><span class="nav-number">4.8.2.</span> <span class="nav-text">带修莫队</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E8%AE%BA"><span class="nav-number">5.</span> <span class="nav-text">图论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E7%9F%AD%E8%B7%AF"><span class="nav-number">5.1.</span> <span class="nav-text">最短路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dijkstra-%E7%AE%97%E6%B3%95"><span class="nav-number">5.1.1.</span> <span class="nav-text">Dijkstra 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SPFA-%E7%AE%97%E6%B3%95"><span class="nav-number">5.1.2.</span> <span class="nav-text">SPFA 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Floyd-%E7%AE%97%E6%B3%95"><span class="nav-number">5.1.3.</span> <span class="nav-text">Floyd 算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E4%BD%99%E6%9C%80%E7%9F%AD%E8%B7%AF"><span class="nav-number">5.2.</span> <span class="nav-text">同余最短路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F"><span class="nav-number">5.3.</span> <span class="nav-text">差分约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.</span> <span class="nav-text">最小生成树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kurskal-%E7%AE%97%E6%B3%95"><span class="nav-number">5.4.1.</span> <span class="nav-text">Kurskal 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prim-%E7%AE%97%E6%B3%95"><span class="nav-number">5.4.2.</span> <span class="nav-text">Prim 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91%E7%9A%84%E5%94%AF%E4%B8%80%E6%80%A7"><span class="nav-number">5.4.3.</span> <span class="nav-text">最小生成树的唯一性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%A1%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.4.</span> <span class="nav-text">次小生成树</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%9E%E4%B8%A5%E6%A0%BC%E6%AC%A1%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.4.1.</span> <span class="nav-text">非严格次小生成树</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%A5%E6%A0%BC%E6%AC%A1%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.4.2.</span> <span class="nav-text">严格次小生成树</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F-k-%E5%BA%A6%E9%99%90%E5%88%B6%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.5.</span> <span class="nav-text">最小 k 度限制生成树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%93%B6%E9%A2%88%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">5.4.6.</span> <span class="nav-text">瓶颈生成树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E7%93%B6%E9%A2%88%E8%B7%AF"><span class="nav-number">5.4.7.</span> <span class="nav-text">最小瓶颈路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE"><span class="nav-number">5.5.</span> <span class="nav-text">最小树形图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%B1%E5%88%98%E7%AE%97%E6%B3%95"><span class="nav-number">5.5.1.</span> <span class="nav-text">朱刘算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%AE%9A%E6%A0%B9%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE"><span class="nav-number">5.5.2.</span> <span class="nav-text">无定根最小树形图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%9B%BE"><span class="nav-number">5.6.</span> <span class="nav-text">欧拉图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F"><span class="nav-number">5.7.</span> <span class="nav-text">拓扑排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E9%80%9A%E6%80%A7"><span class="nav-number">5.8.</span> <span class="nav-text">连通性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="nav-number">5.8.1.</span> <span class="nav-text">边双连通分量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="nav-number">5.8.2.</span> <span class="nav-text">点双连通分量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="nav-number">5.8.3.</span> <span class="nav-text">强连通分量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-SAT"><span class="nav-number">5.9.</span> <span class="nav-text">2 - SAT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86"><span class="nav-number">5.10.</span> <span class="nav-text">重链剖分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E5%88%86%E6%B2%BB"><span class="nav-number">5.11.</span> <span class="nav-text">树分治</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%88%86%E6%B2%BB"><span class="nav-number">5.11.1.</span> <span class="nav-text">点分治</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E4%B8%8A%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6"><span class="nav-number">5.12.</span> <span class="nav-text">树上启发式合并</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LCA"><span class="nav-number">5.13.</span> <span class="nav-text">LCA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86%E7%AE%97%E6%B3%95"><span class="nav-number">5.13.1.</span> <span class="nav-text">重链剖分算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%91%E4%B8%8A%E5%80%8D%E5%A2%9E%E7%AE%97%E6%B3%95"><span class="nav-number">5.13.2.</span> <span class="nav-text">树上倍增算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%91%E4%B8%8A-Tarjan-%E7%AE%97%E6%B3%95"><span class="nav-number">5.13.3.</span> <span class="nav-text">树上 Tarjan 算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="nav-number">5.14.</span> <span class="nav-text">网络流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="nav-number">5.14.1.</span> <span class="nav-text">最大流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="nav-number">5.14.2.</span> <span class="nav-text">最小费用最大流</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D"><span class="nav-number">5.15.</span> <span class="nav-text">二分图最大匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95"><span class="nav-number">5.15.1.</span> <span class="nav-text">匈牙利算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HK-%E7%AE%97%E6%B3%95"><span class="nav-number">5.15.2.</span> <span class="nav-text">HK 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%B0%8F%E7%82%B9%E8%A6%86%E7%9B%96"><span class="nav-number">5.15.3.</span> <span class="nav-text">二分图最小点覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E7%8B%AC%E7%AB%8B%E9%9B%86"><span class="nav-number">5.15.4.</span> <span class="nav-text">二分图最大独立集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%90%91%E6%97%A0%E7%8E%AF%E5%9B%BE%E7%9A%84%E6%9C%80%E5%B0%8F%E4%B8%8D%E7%9B%B8%E4%BA%A4%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96"><span class="nav-number">5.15.5.</span> <span class="nav-text">有向无环图的最小不相交路径覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%90%91%E6%97%A0%E7%8E%AF%E5%9B%BE%E7%9A%84%E6%9C%80%E5%B0%8F%E5%8F%AF%E7%9B%B8%E4%BA%A4%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96"><span class="nav-number">5.15.6.</span> <span class="nav-text">有向无环图的最小可相交路径覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96"><span class="nav-number">5.15.7.</span> <span class="nav-text">无向图的最小路径覆盖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E6%9D%83%E5%8C%B9%E9%85%8D"><span class="nav-number">5.16.</span> <span class="nav-text">二分图最大权匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#KM-%E7%AE%97%E6%B3%95"><span class="nav-number">5.16.1.</span> <span class="nav-text">KM 算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D"><span class="nav-number">5.17.</span> <span class="nav-text">一般图最大匹配</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6"><span class="nav-number">6.</span> <span class="nav-text">数学</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BE%9F%E9%80%9F%E4%B9%98"><span class="nav-number">6.1.</span> <span class="nav-text">龟速乘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="nav-number">6.2.</span> <span class="nav-text">快速幂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Miller-Rabin-%E7%B4%A0%E6%80%A7%E6%B5%8B%E8%AF%95"><span class="nav-number">6.3.</span> <span class="nav-text">Miller-Rabin 素性测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pollard-Rho-%E5%9B%A0%E5%BC%8F%E5%88%86%E8%A7%A3"><span class="nav-number">6.4.</span> <span class="nav-text">Pollard-Rho 因式分解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%AF%E6%80%A7%E5%87%BD%E6%95%B0"><span class="nav-number">6.5.</span> <span class="nav-text">积性函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">6.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%B4%A8"><span class="nav-number">6.5.2.</span> <span class="nav-text">性质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E7%90%86"><span class="nav-number">6.5.3.</span> <span class="nav-text">定理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-number">6.5.4.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dirichlet-%E5%8D%B7%E7%A7%AF"><span class="nav-number">6.5.5.</span> <span class="nav-text">Dirichlet 卷积</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-number">6.5.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%B4%A8-1"><span class="nav-number">6.5.5.2.</span> <span class="nav-text">性质</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E7%90%86-1"><span class="nav-number">6.5.5.3.</span> <span class="nav-text">定理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-1"><span class="nav-number">6.5.5.4.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-number">6.5.6.</span> <span class="nav-text">欧拉函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E7%90%86-2"><span class="nav-number">6.5.6.1.</span> <span class="nav-text">定理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%87%BD%E6%95%B0"><span class="nav-number">6.5.7.</span> <span class="nav-text">莫比乌斯函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="nav-number">6.5.7.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E7%90%86-3"><span class="nav-number">6.5.7.2.</span> <span class="nav-text">定理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AD%9B"><span class="nav-number">6.6.</span> <span class="nav-text">筛</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B"><span class="nav-number">6.6.1.</span> <span class="nav-text">线性筛</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B-amp-%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-number">6.6.2.</span> <span class="nav-text">线性筛 &amp; 欧拉函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B-amp-%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%87%BD%E6%95%B0"><span class="nav-number">6.6.3.</span> <span class="nav-text">线性筛 &amp; 莫比乌斯函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B"><span class="nav-number">6.6.4.</span> <span class="nav-text">杜教筛</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86"><span class="nav-number">6.7.</span> <span class="nav-text">欧拉定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95"><span class="nav-number">6.8.</span> <span class="nav-text">扩展欧几里得算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B"><span class="nav-number">6.9.</span> <span class="nav-text">线性同余方程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%98%E6%B3%95%E9%80%86%E5%85%83"><span class="nav-number">6.10.</span> <span class="nav-text">乘法逆元</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86"><span class="nav-number">6.11.</span> <span class="nav-text">中国剩余定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0"><span class="nav-number">6.12.</span> <span class="nav-text">离散对数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BSGS"><span class="nav-number">6.12.1.</span> <span class="nav-text">BSGS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E8%AE%BA%E5%88%86%E5%9D%97"><span class="nav-number">6.13.</span> <span class="nav-text">数论分块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99"><span class="nav-number">6.14.</span> <span class="nav-text">二次剩余</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cipolla-%E7%AE%97%E6%B3%95"><span class="nav-number">6.14.1.</span> <span class="nav-text">Cipolla 算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97"><span class="nav-number">6.15.</span> <span class="nav-text">矩阵运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83"><span class="nav-number">6.16.</span> <span class="nav-text">高斯消元</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83%E8%A7%A3%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="nav-number">6.16.1.</span> <span class="nav-text">高斯消元解线性方程组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83%E8%A7%A3-XOR-%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="nav-number">6.16.2.</span> <span class="nav-text">高斯消元解 XOR 方程组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83%E8%A7%A3%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="nav-number">6.16.3.</span> <span class="nav-text">高斯消元解同余方程组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E5%9F%BA"><span class="nav-number">6.17.</span> <span class="nav-text">线性基</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E9%80%92%E6%8E%A8%E6%95%B0%E5%88%97"><span class="nav-number">6.18.</span> <span class="nav-text">线性递推数列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E9%98%B6%E7%BA%BF%E6%80%A7%E9%80%92%E6%8E%A8%E6%95%B0%E5%88%97"><span class="nav-number">6.18.1.</span> <span class="nav-text">一阶线性递推数列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E9%98%B6%E7%BA%BF%E6%80%A7%E9%80%92%E6%8E%A8%E6%95%B0%E5%88%97"><span class="nav-number">6.18.2.</span> <span class="nav-text">二阶线性递推数列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E7%8E%87%E8%AE%BA"><span class="nav-number">6.19.</span> <span class="nav-text">概率论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%A0%E4%BD%95%E5%88%86%E5%B8%83"><span class="nav-number">6.19.1.</span> <span class="nav-text">几何分布</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E5%87%A0%E4%BD%95%E5%88%86%E5%B8%83"><span class="nav-number">6.19.2.</span> <span class="nav-text">超几何分布</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F"><span class="nav-number">6.20.</span> <span class="nav-text">多项式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FFT"><span class="nav-number">6.20.1.</span> <span class="nav-text">FFT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NTT"><span class="nav-number">6.20.2.</span> <span class="nav-text">NTT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%BC%88%E8%AE%BA"><span class="nav-number">6.21.</span> <span class="nav-text">博弈论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B4%E4%BB%80%E5%8D%9A%E5%BC%88"><span class="nav-number">6.21.1.</span> <span class="nav-text">巴什博弈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A8%81%E4%BD%90%E5%A4%AB%E5%8D%9A%E5%BC%88"><span class="nav-number">6.21.2.</span> <span class="nav-text">威佐夫博弈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E5%8D%9A%E5%BC%88"><span class="nav-number">6.21.3.</span> <span class="nav-text">斐波那契博弈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nim-%E6%B8%B8%E6%88%8F"><span class="nav-number">6.21.4.</span> <span class="nav-text">Nim 游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B6%E6%A2%AF-Nim-%E6%B8%B8%E6%88%8F"><span class="nav-number">6.21.5.</span> <span class="nav-text">阶梯 Nim 游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D-Nim-%E6%B8%B8%E6%88%8F"><span class="nav-number">6.21.6.</span> <span class="nav-text">反 Nim 游戏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E5%BC%8F"><span class="nav-number">6.22.</span> <span class="nav-text">公式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%95%B0%E5%85%AC%E5%BC%8F"><span class="nav-number">6.22.1.</span> <span class="nav-text">高数公式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94"><span class="nav-number">6.22.2.</span> <span class="nav-text">莫比乌斯反演</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E8%AE%BA%E5%85%AC%E5%BC%8F"><span class="nav-number">6.22.3.</span> <span class="nav-text">数论公式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-sum-i-x3D-1-n-sum-j-x3D-1-m-gcd-i-j"><span class="nav-number">6.22.3.1.</span> <span class="nav-text">1. $\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}{\gcd(i,j)}$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-sum-i-x3D-1-n-i-gcd-i-n-x3D-1"><span class="nav-number">6.22.3.2.</span> <span class="nav-text">2. $\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-mu-2-n-x3D-sum-d-2-mid-n-mu-d"><span class="nav-number">6.22.3.3.</span> <span class="nav-text">3. $\mu^2(n)&#x3D;\sum_{d^2\mid n}\mu(d)$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-sum-i-x3D-1-n-mu-2-i"><span class="nav-number">6.22.3.4.</span> <span class="nav-text">4. $\sum_{i&#x3D;1}^n{\mu^2(i)}$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-sum-i-x3D-1-n-operatorname-lcm-i-n"><span class="nav-number">6.22.3.5.</span> <span class="nav-text">5. $\sum_{i&#x3D;1}^n{\operatorname{lcm}(i,n)}$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-lcm-i-j"><span class="nav-number">6.22.3.6.</span> <span class="nav-text">6. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{lcm}(i,j)}$</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-d-ij"><span class="nav-number">6.22.3.7.</span> <span class="nav-text">7. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{d}(ij)}$</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F"><span class="nav-number">6.22.4.</span> <span class="nav-text">组合数学公式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%8E%E9%98%B6%E7%AD%89%E5%B9%82%E6%B1%82%E5%92%8C"><span class="nav-number">6.22.5.</span> <span class="nav-text">低阶等幂求和</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF"><span class="nav-number">6.22.6.</span> <span class="nav-text">约瑟夫环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8B%BE%E8%82%A1%E6%95%B0"><span class="nav-number">6.22.7.</span> <span class="nav-text">勾股数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95"><span class="nav-number">7.</span> <span class="nav-text">计算几何</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4"><span class="nav-number">7.1.</span> <span class="nav-text">二维</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9"><span class="nav-number">7.1.1.</span> <span class="nav-text">点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF"><span class="nav-number">7.1.2.</span> <span class="nav-text">线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%86"><span class="nav-number">7.1.3.</span> <span class="nav-text">圆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%B8%E5%8C%85"><span class="nav-number">7.1.4.</span> <span class="nav-text">凸包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E5%9C%86%E8%A6%86%E7%9B%96"><span class="nav-number">7.1.5.</span> <span class="nav-text">最小圆覆盖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%BB%B4"><span class="nav-number">7.2.</span> <span class="nav-text">三维</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9-1"><span class="nav-number">7.2.1.</span> <span class="nav-text">点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%83"><span class="nav-number">7.2.2.</span> <span class="nav-text">球</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E5%AE%83"><span class="nav-number">7.3.</span> <span class="nav-text">其它</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%82%E9%A1%B9"><span class="nav-number">8.</span> <span class="nav-text">杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">8.1.</span> <span class="nav-text">排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F"><span class="nav-number">8.1.1.</span> <span class="nav-text">归并排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F"><span class="nav-number">8.1.2.</span> <span class="nav-text">快速排序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="nav-number">8.2.</span> <span class="nav-text">离散化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86"><span class="nav-number">8.3.</span> <span class="nav-text">二分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E5%88%86"><span class="nav-number">8.4.</span> <span class="nav-text">三分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E5%BA%A6"><span class="nav-number">8.5.</span> <span class="nav-text">高精度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98"><span class="nav-number">8.6.</span> <span class="nav-text">浮点数的精度问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lowbit-%E5%89%8D%E7%BC%80%E5%92%8C"><span class="nav-number">8.7.</span> <span class="nav-text">Lowbit 前缀和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="nav-number">8.8.</span> <span class="nav-text">随机数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#builtin-%E7%B3%BB%E5%88%97%E5%87%BD%E6%95%B0%EF%BC%88%E4%BD%8D%E8%BF%90%E7%AE%97%EF%BC%89"><span class="nav-number">8.9.</span> <span class="nav-text">_builtin 系列函数（位运算）</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="c4Lnn"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">c4Lnn</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">83</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/c4Lnn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;c4Lnn" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://oi-wiki.org/" title="https:&#x2F;&#x2F;oi-wiki.org&#x2F;" rel="noopener" target="_blank">OI Wiki</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://paste.ubuntu.com/" title="https:&#x2F;&#x2F;paste.ubuntu.com" rel="noopener" target="_blank">Pastebin</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://csacademy.com/app/graph_editor" title="https:&#x2F;&#x2F;csacademy.com&#x2F;app&#x2F;graph_editor" rel="noopener" target="_blank">Gragph Editor</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.desmos.com/?lang=zh-CN" title="https:&#x2F;&#x2F;www.desmos.com&#x2F;?lang&#x3D;zh-CN" rel="noopener" target="_blank">Desmos</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/23/CP%20Templates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="c4Lnn">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="c4Lnn 的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="CP Templates | c4Lnn 的个人博客">
      <meta itemprop="description" content=" ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CP Templates
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-23 15:45:28" itemprop="dateCreated datePublished" datetime="2021-04-23T15:45:28+08:00">2021-04-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-09 14:41:26" itemprop="dateModified" datetime="2023-04-09T14:41:26+08:00">2023-04-09</time>
    </span>

  
</div>

            <div class="post-description"> </div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="Head"><a href="#Head" class="headerlink" title="Head"></a>Head</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SZ(x) (int)(x).size()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALL(x) (x).begin(), (x).end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PB push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EB emplace_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FI first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SE second</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> DB;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> LD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ULL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; VI;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;LL&gt; VLL;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;PII&gt; VPII;</span><br><span class="line"><span class="comment">// head</span></span><br></pre></td></tr></table></figure>

<h2 id="快速读入"><a href="#快速读入" class="headerlink" title="快速读入"></a>快速读入</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">read</span><span class="params">(T &amp;t)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ch;</span><br><span class="line">    <span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch!=EOF&amp;&amp;!<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>;</span><br><span class="line">        ch=<span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ch==EOF) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(t=<span class="number">0</span>;<span class="built_in">isdigit</span>(ch);ch=<span class="built_in">getchar</span>()) t=t*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    t*=f;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> stk[<span class="number">70</span>],top;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(t&lt;<span class="number">0</span>) &#123;t=-t;<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);&#125;</span><br><span class="line">    <span class="keyword">while</span>(t) stk[++top]=t%<span class="number">10</span>,t/=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">while</span>(top) <span class="built_in">putchar</span>(stk[top--]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="对拍"><a href="#对拍" class="headerlink" title="对拍"></a>对拍</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">:loop</span><br><span class="line">    rand.exe&gt;data.<span class="keyword">in</span></span><br><span class="line">    std.exe&lt;data.<span class="keyword">in</span>&gt;std.out</span><br><span class="line">    my.exe&lt;data.<span class="keyword">in</span>&gt;my.out</span><br><span class="line">    fc my.out std.out</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">errorlevel</span> <span class="number">1</span> <span class="keyword">goto</span> loop</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>

<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cs=1</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cs=$((<span class="variable">$cs</span>+<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Case <span class="variable">$cs</span>:&quot;</span></span><br><span class="line">    ./data&gt;data.in</span><br><span class="line">    ./my&lt;data.in&gt;my.out</span><br><span class="line">    ./std&lt;data.in&gt;std.out</span><br><span class="line">    <span class="keyword">if</span> diff my.out std.out; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;AC\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;WA\n&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="最小表示法"><a href="#最小表示法" class="headerlink" title="最小表示法"></a>最小表示法</h2><p><strong>找出与一个字符串循环同构的串中字典序最小的串</strong></p>
<p>考虑对于一对字符串 $A,B$，它们在原字符串 $S$ 中的起始位置分别为 $i,j$，且它们的前 $k$ 个字符均相同，即：</p>
<p>$A[i\cdots i+k-1]&#x3D;B[j\cdots j+k-1]$</p>
<p>不妨先考虑 $A[i+k]&gt;B[j+k]$ 的情况</p>
<p>我们发现起始位置下标 $l$ 满足 $i\le l\le i+k$ 的字符串均不能成为答案。因为对于任意一个字符串 $A_{i+p}$（表示以 $i+p$ 为起始位置的字符串）一定存在字符串 $B_{j+p}$ 比它更优</p>
<p>所以我们比较时可以跳过下标 $l \in  [i,i+k]$，直接比较 $A_{i+k+1}$</p>
<p>时间复杂度： $O(n)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_min</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = <span class="number">0</span>, j = <span class="number">1</span>, len = <span class="built_in">SZ</span>(s);</span><br><span class="line">    <span class="keyword">while</span> (k &lt; len &amp;&amp; i &lt; len &amp;&amp; j &lt; len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[(i + k) % len] == s[(j + k) % len]) &#123;</span><br><span class="line">            ++k;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            s[(i + k) % len] &gt; s[(j + k) % len] ? i = i + k + <span class="number">1</span> : j = j + k + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">                ++i;</span><br><span class="line">            &#125;</span><br><span class="line">            k = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(i, j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><ul>
<li>字符串下标从 $0$ 开始，前 $i$ 位的的最小循环节长度为 $i-next_i$，若 $i\mid (i-next_i)$，则前 $i$ 位 的循环周期为 $i&#x2F;(i-next_i)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_next</span><span class="params">(<span class="type">const</span> string &amp;t)</span> </span>&#123; <span class="comment">// next 数组表示 0 ~ i - 1 的最长 border</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">-1</span>;</span><br><span class="line">    nxt[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="built_in">SZ</span>(t)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">-1</span> || t[i] == t[j]) &#123;</span><br><span class="line">            nxt[++i] = ++j;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j = nxt[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>字符串匹配</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 优化后的 next 不再是最长 border</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_next</span><span class="params">(<span class="type">const</span> string &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">-1</span>;</span><br><span class="line">    nxt[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="built_in">SZ</span>(t)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">-1</span> || t[i] == t[j]) &#123;</span><br><span class="line">            ++i, ++j;</span><br><span class="line">            <span class="keyword">if</span> (t[i] != t[j]) &#123;</span><br><span class="line">                nxt[i] = j;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                nxt[i] = nxt[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j = nxt[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kmp</span><span class="params">(<span class="type">const</span> string &amp;s, <span class="type">const</span> string &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">get_next</span>(t);</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="built_in">SZ</span>(s)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">-1</span> || s[i] == t[j]) &#123;</span><br><span class="line">            ++i, ++j;</span><br><span class="line">            <span class="keyword">if</span> (j == <span class="built_in">SZ</span>(t)) &#123;</span><br><span class="line">                cout &lt;&lt; i - j + <span class="number">1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">                j = nxt[j]; <span class="comment">// 匹配成功</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j = nxt[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="扩展-KMP"><a href="#扩展-KMP" class="headerlink" title="扩展 KMP"></a>扩展 KMP</h2><ul>
<li>求 $S$ 的每一个后缀与 $T$ 的最长公共前缀</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> nxt[N]; <span class="comment">// 以 T[i] 开始的子串与 T 的最长相同前缀长度</span></span><br><span class="line"><span class="type">int</span> extend[N]; <span class="comment">// 以 S[i] 开始的子串与 T 的最长相同前缀长度</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_next</span><span class="params">(<span class="type">const</span> string &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>; <span class="comment">// l 为当前最长匹配起点，r 为当前最长匹配终点</span></span><br><span class="line">    nxt[<span class="number">0</span>] = <span class="built_in">SZ</span>(t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="built_in">SZ</span>(t); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; r || i + nxt[i - l] &gt;= r) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; r) &#123;</span><br><span class="line">                r = i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; <span class="built_in">SZ</span>(t) &amp;&amp; t[r] == t[r - i]) &#123;</span><br><span class="line">                ++r; <span class="comment">// 重新暴力匹配更新 r</span></span><br><span class="line">            &#125;</span><br><span class="line">            nxt[i] = r - i;</span><br><span class="line">            l = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nxt[i] = nxt[i - l];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_extend</span><span class="params">(<span class="type">const</span> string &amp;s, <span class="type">const</span> string &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">get_next</span>(t);</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">SZ</span>(s); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; r || i + nxt[i - l] &gt;= r) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; r) &#123;</span><br><span class="line">                r = i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; <span class="built_in">SZ</span>(s) &amp;&amp; r - i &lt; <span class="built_in">SZ</span>(t) &amp;&amp; s[r] == t[r - i]) &#123;</span><br><span class="line">                ++r;</span><br><span class="line">            &#125;</span><br><span class="line">            extend[i] = r - i;</span><br><span class="line">            l = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            extend[i] = nxt[i - l];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> t[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> len[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">manacher</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, mid = <span class="number">0</span>, r = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    t[<span class="number">0</span>] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">        t[++k] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        t[++k] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    t[++k] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; i++) &#123;</span><br><span class="line">        len[i] = i &lt; r ? <span class="built_in">min</span>(r - i, len[<span class="number">2</span> * mid - i]) : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i - len[i] &gt;= <span class="number">1</span> &amp;&amp; i + len[i] &lt;= k &amp;&amp; t[i - len[i]] == t[i + len[i]]) &#123;</span><br><span class="line">            ++len[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len[i] + i &gt; r) &#123;</span><br><span class="line">            r = len[i] + i;</span><br><span class="line">            mid = i;</span><br><span class="line">            res = <span class="built_in">max</span>(res, len[i]); <span class="comment">// 更新id回文串中点和mx回文串最右端</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res - <span class="number">1</span>; <span class="comment">// 返回最大回文串长度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Trie-树"><a href="#Trie-树" class="headerlink" title="Trie 树"></a>Trie 树</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> tr[N][<span class="number">26</span>], tot[N], sz;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">        <span class="type">int</span> v = c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!tr[u][v]) &#123;</span><br><span class="line">            tr[u][v] = ++sz;</span><br><span class="line">        &#125;</span><br><span class="line">        u = tr[u][v];</span><br><span class="line">    &#125;</span><br><span class="line">    tot[u]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">        <span class="type">int</span> v = c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!tr[u][v]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        u = tr[u][v];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tot[u]; <span class="comment">// 返回该字符串的个数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AC-自动机"><a href="#AC-自动机" class="headerlink" title="AC 自动机"></a>AC 自动机</h2><ul>
<li>多组数据字符集大小不一样时，初始化按最大字符集大小处理</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AC</span> &#123;</span><br><span class="line">    <span class="type">int</span> tr[N][<span class="number">26</span>],fail[N],sz; <span class="comment">// fail 指针指向与当前前缀匹配的最长后缀的位置</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=sz;i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++) tr[i][j]=<span class="number">0</span>;</span><br><span class="line">        	fail[i]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sz=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> c:s) &#123;</span><br><span class="line">            <span class="type">int</span> v=c-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(!tr[u][v]) tr[u][v]=++sz;</span><br><span class="line">            u=tr[u][v];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v=<span class="number">0</span>;v&lt;<span class="number">26</span>;v++) <span class="keyword">if</span>(tr[<span class="number">0</span>][v]) q.<span class="built_in">push</span>(tr[<span class="number">0</span>][v]);</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">            <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> v=<span class="number">0</span>;v&lt;<span class="number">26</span>;v++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(tr[u][v]) fail[tr[u][v]]=tr[fail[u]][v],q.<span class="built_in">push</span>(tr[u][v]);</span><br><span class="line">                <span class="keyword">else</span> tr[u][v]=tr[fail[u]][v];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ac;</span><br></pre></td></tr></table></figure>

<h2 id="Hash-字符串"><a href="#Hash-字符串" class="headerlink" title="Hash 字符串"></a>Hash 字符串</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 双 Hash</span></span><br><span class="line"><span class="type">const</span> LL HASH_MOD[<span class="number">2</span>]=&#123;<span class="number">1000000007</span>,<span class="number">1000000009</span>&#125;;</span><br><span class="line"><span class="type">const</span> LL HASH_BASE=<span class="number">13331</span>;</span><br><span class="line">LL ha[<span class="number">2</span>][N],power[<span class="number">2</span>][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">hash_init</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    power[<span class="number">0</span>][<span class="number">0</span>]=power[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">SZ</span>(s);i++) &#123; <span class="comment">// ha[0/1][1] 存 s[0] 的 Hash 值</span></span><br><span class="line">        ha[<span class="number">0</span>][i]=(ha[<span class="number">0</span>][i<span class="number">-1</span>]*HASH_BASE%HASH_MOD[<span class="number">0</span>]+s[i<span class="number">-1</span>])%HASH_MOD[<span class="number">0</span>];</span><br><span class="line">        ha[<span class="number">1</span>][i]=(ha[<span class="number">1</span>][i<span class="number">-1</span>]*HASH_BASE%HASH_MOD[<span class="number">1</span>]+s[i<span class="number">-1</span>])%HASH_MOD[<span class="number">1</span>];</span><br><span class="line">        power[<span class="number">0</span>][i]=power[<span class="number">0</span>][i<span class="number">-1</span>]*HASH_BASE%HASH_MOD[<span class="number">0</span>];</span><br><span class="line">        power[<span class="number">1</span>][i]=power[<span class="number">1</span>][i<span class="number">-1</span>]*HASH_BASE%HASH_MOD[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pair&lt;LL,LL&gt; <span class="title">get_hash</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">MP</span>(</span><br><span class="line">        (ha[<span class="number">0</span>][r]+HASH_MOD[<span class="number">0</span>]-ha[<span class="number">0</span>][l<span class="number">-1</span>]*power[<span class="number">0</span>][r-l+<span class="number">1</span>]%HASH_MOD[<span class="number">0</span>])%HASH_MOD[<span class="number">0</span>],</span><br><span class="line">        (ha[<span class="number">1</span>][r]+HASH_MOD[<span class="number">1</span>]-ha[<span class="number">1</span>][l<span class="number">-1</span>]*power[<span class="number">1</span>][r-l+<span class="number">1</span>]%HASH_MOD[<span class="number">1</span>])%HASH_MOD[<span class="number">1</span>]</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h2><ul>
<li><p>两子串最长公共前缀：$lcp(sa_i,sa_j)&#x3D;\min{height_{i+1\dots j}}$</p>
</li>
<li><p>两个子串的大小关系：</p>
<p>假设需要比较的是 $A&#x3D;S_{a\dots b}$ 和 $B&#x3D;S_{c\dots d}$ 的大小关系</p>
<p>若 $lcp(a,c)\ge \min(|A|,|B|)$，$A&lt;b \Longleftrightarrow |A|&lt;|B|$</p>
<p>否则，$A&lt;b \Longleftrightarrow rk_a&lt;rk_b$</p>
</li>
<li><p>不同子串的数目：$\frac{n(n+1)}{2}-\sum_{i&#x3D;2}^{n}height_i$</p>
</li>
<li><p>合并多个字符串中间用没有出现过的字符隔开</p>
</li>
<li><p>多组数据时，注意初始化 $s_{n+1}&#x3D;0$</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,s[N],sa[N],id[N],rk[N],oldrk[N&lt;&lt;<span class="number">1</span>],cnt[N],height[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m=<span class="number">200</span>; <span class="comment">// 初始最大排名</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) cnt[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) ++cnt[rk[i]=s[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) cnt[i]+=cnt[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) sa[cnt[rk[i]]--]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> w=<span class="number">1</span>,p;w&lt;n;w&lt;&lt;=<span class="number">1</span>,m=p) &#123;</span><br><span class="line">        p=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;n-w;i--) id[++p]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(sa[i]&gt;w) id[++p]=sa[i]-w;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) cnt[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) ++cnt[rk[id[i]]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) cnt[i]+=cnt[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) sa[cnt[rk[id[i]]]--]=id[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) oldrk[i]=rk[i];</span><br><span class="line">        p=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            rk[sa[i]]=(oldrk[sa[i]]==oldrk[sa[i<span class="number">-1</span>]]&amp;&amp;oldrk[sa[i]+w]==oldrk[sa[i<span class="number">-1</span>]+w])?p:++p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_height</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,t=<span class="number">0</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(t) t--;</span><br><span class="line">        <span class="keyword">while</span>(s[i+t]==s[sa[rk[i]<span class="number">-1</span>]+t]) t++;</span><br><span class="line">        height[rk[i]]=t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 是否有某长度为 k 的子串至少不重叠地出现了 2 次</span></span><br><span class="line">    <span class="type">int</span> mn=<span class="number">0</span>,mx=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(height[i]&lt;k) mn=sa[i],mx=sa[i];</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            mn=<span class="built_in">min</span>(mn,sa[i]);</span><br><span class="line">            mx=<span class="built_in">max</span>(mx,sa[i]);</span><br><span class="line">            <span class="keyword">if</span>(mx-mn&gt;=k) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后缀自动机"><a href="#后缀自动机" class="headerlink" title="后缀自动机"></a>后缀自动机</h2><ul>
<li><p>字符集过大，使用 map</p>
</li>
<li><p>不同子串个数：$\sum_{i&#x3D;1}^{sz}(len_i-len_{link_i})$</p>
<p>可以在线计算，每插入一个字符的贡献是：$len_{last}-len_{link_{last}}$</p>
</li>
<li><p>不同子串的总长度：$\sum_{i&#x3D;1}^{sz}(\frac{len_i(len_i+1)}{2}-\frac{len_{link_i}(len_{link_i}+1)}{2})$</p>
<p>可以在线计算，每插入一个字符的贡献是：$\frac{len_{last}(len_{last}+1)}{2}-\frac{len_{link_{last}}(len_{link_{last}}+1)}{2}$</p>
</li>
<li><p>出现次数：将不是复制创建的非初始状态的 $cnt$ 初始化为 $1$，再让 $cnt_{link_v}+&#x3D;cnt_v$</p>
</li>
<li><p>字典序第 $k$ 小子串：根据 $nxt$ 处理子树大小，若求的是去重后的第 $k$ 小，让子树大小初始值为 $1$，否则为该状态出现次数，然后 dfs 求出第 $k$ 小</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,sz,last,len[N&lt;&lt;<span class="number">1</span>],link[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>][<span class="number">26</span>],tot[N&lt;&lt;<span class="number">1</span>]; <span class="comment">// tot 是每个状态出现的次数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sam_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sam_insert</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> cur=++sz,p=last;</span><br><span class="line">    len[cur]=len[last]+<span class="number">1</span>;</span><br><span class="line">    tot[cur]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!nxt[p][x]) nxt[p][x]=cur,p=link[p];</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">-1</span>) link[cur]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> q=nxt[p][x];</span><br><span class="line">        <span class="keyword">if</span>(len[p]+<span class="number">1</span>==len[q]) link[cur]=q;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> t=++sz;</span><br><span class="line">            len[t]=len[p]+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++) nxt[t][i]=nxt[q][i];</span><br><span class="line">            link[t]=link[q];</span><br><span class="line">            <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;nxt[p][x]==q) nxt[p][x]=t,p=link[p];</span><br><span class="line">            link[q]=link[cur]=t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    last=cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> c[N],a[N&lt;&lt;<span class="number">1</span>]; <span class="comment">// a 是拓扑次序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">topo</span><span class="params">(<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sz;i++) ++c[len[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[i]+=c[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=sz;i&gt;=<span class="number">1</span>;i--) a[c[len[i]]--]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=sz;i&gt;=<span class="number">1</span>;i--) tot[link[a[i]]]+=tot[a[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">string <span class="title">lcs</span><span class="params">(<span class="type">const</span> string &amp;S,<span class="type">const</span> string &amp;T)</span> </span>&#123; <span class="comment">// 两个字符串的最长公共子串</span></span><br><span class="line">    n=<span class="built_in">SZ</span>(S);</span><br><span class="line">    <span class="built_in">sam_init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">sam_insert</span>(S[i]);</span><br><span class="line">    <span class="type">int</span> v=<span class="number">0</span>,l=<span class="number">0</span>,mx=<span class="number">0</span>,mxpos=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">SZ</span>(T);i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(v&amp;&amp;!nxt[v].<span class="built_in">count</span>(T[i])) v=link[v],l=len[v];</span><br><span class="line">        <span class="keyword">if</span>(nxt[v].<span class="built_in">count</span>(T[i])) v=nxt[v][T[i]],++l;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;mx) mx=l,mxpos=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T.<span class="built_in">substr</span>(mxpos-mx+<span class="number">1</span>,mx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="广义后缀自动机"><a href="#广义后缀自动机" class="headerlink" title="广义后缀自动机"></a>广义后缀自动机</h2><ul>
<li>多个字符串的最长公共子串长度：记录每个状态是否在某个字符串中存在，通过 link 转移</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// N 为单个字符串最大长度</span></span><br><span class="line"><span class="comment">// M 为字符串个数</span></span><br><span class="line"><span class="type">int</span> n,sz,len[N*M*<span class="number">2</span>],nxt[N*M*<span class="number">2</span>][<span class="number">26</span>],link[N*M*<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">trie_insert</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    n=<span class="built_in">max</span>(n,<span class="built_in">SZ</span>(s));</span><br><span class="line">    <span class="type">int</span> rt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:s) &#123;</span><br><span class="line">        <span class="type">int</span> now=c-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!nxt[rt][now]) nxt[rt][now]=++sz;</span><br><span class="line">        rt=nxt[rt][now];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gsa_insert</span><span class="params">(<span class="type">int</span> last,<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> cur=nxt[last][x],p=link[last];</span><br><span class="line">    len[cur]=len[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!nxt[p][x]) nxt[p][x]=cur,p=link[p];</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">-1</span>) &#123;link[cur]=<span class="number">0</span>;<span class="keyword">return</span> cur;&#125;</span><br><span class="line">    <span class="type">int</span> q=nxt[p][x];</span><br><span class="line">    <span class="keyword">if</span>(len[p]+<span class="number">1</span>==len[q]) &#123;link[cur]=q;<span class="keyword">return</span> cur;&#125;</span><br><span class="line">    <span class="type">int</span> t=++sz;</span><br><span class="line">    len[t]=len[p]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++) nxt[t][i]=len[nxt[q][i]]!=<span class="number">0</span>?nxt[q][i]:<span class="number">0</span>;</span><br><span class="line">    link[t]=link[q];</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;nxt[p][x]==q) nxt[p][x]=t,p=link[p];</span><br><span class="line">    link[q]=link[cur]=t;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gsa_build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    queue&lt;PII&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++) <span class="keyword">if</span>(nxt[<span class="number">0</span>][i]) q.<span class="built_in">emplace</span>(<span class="number">0</span>,i);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="keyword">auto</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">auto</span> last=<span class="built_in">gsa_insert</span>(u.FI,u.SE);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++) <span class="keyword">if</span>(nxt[last][i]) q.<span class="built_in">emplace</span>(last,i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> c[N],a[N*M*<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gsa_topo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sz;i++) ++c[len[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[i]+=c[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=sz;i&gt;=<span class="number">1</span>;i--) a[c[len[i]]--]=i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h2><h3 id="01-背包"><a href="#01-背包" class="headerlink" title="01 背包"></a>01 背包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,dp[W],w[N],v[N];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=w[i];j--)</span><br><span class="line">        dp[j]=<span class="built_in">max</span>(dp[j],dp[j-w[i]]+v[i]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求01背包的方案数</span></span><br><span class="line">dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=w[i];j--)</span><br><span class="line">        dp[j]+=dp[j-w[i]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出第i个物品后的方案数</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=w[i];j&lt;=m;j++)</span><br><span class="line">        dp[j]-=dp[j-w[i]];</span><br></pre></td></tr></table></figure>

<h3 id="完全背包"><a href="#完全背包" class="headerlink" title="完全背包"></a>完全背包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,dp[W],w[N],v[N];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=w[i];j&lt;=m;j++)</span><br><span class="line">        dp[j]=<span class="built_in">max</span>(dp[j],dp[j-w[i]]+v[i]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求完全背包的方案数</span></span><br><span class="line">dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=w[i];j&lt;=m;j++)</span><br><span class="line">        dp[j]+=dp[j-w[i]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出第i个物品后的方案数</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n+<span class="number">1</span>;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=w[i];j--)</span><br><span class="line">        dp[j]-=dp[j-w[i]];</span><br></pre></td></tr></table></figure>

<h3 id="多重背包"><a href="#多重背包" class="headerlink" title="多重背包"></a>多重背包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单调队列优化</span></span><br><span class="line"><span class="type">int</span> n,m,v,w,s,dp[M],pre[M],q[M];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(m/v&lt;s) s=m/v;</span><br><span class="line">    <span class="built_in">memcpy</span>(pre,dp,<span class="keyword">sizeof</span> dp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;v;j++) &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k*v+j&lt;=m;k++) &#123;</span><br><span class="line">            <span class="type">int</span> t=dp[k*v+j]-k*w;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;=r&amp;&amp;k-q[l]&gt;s) l++;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;=r&amp;&amp;pre[q[r]*v+j]-q[r]*w&lt;=t) r--;</span><br><span class="line">            q[++r]=k;</span><br><span class="line">            dp[k*v+j]=pre[q[l]*v+j]-q[l]*w+k*w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分组背包"><a href="#分组背包" class="headerlink" title="分组背包"></a>分组背包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 每组只能取一个物品</span></span><br><span class="line"><span class="type">int</span> n,m,c[N],v[N][N],w[N][N],dp[N];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=<span class="number">0</span>;j--)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=c[i];k++)</span><br><span class="line">            <span class="keyword">if</span>(j-v[i][k]&gt;=<span class="number">0</span>)</span><br><span class="line">                dp[j]=<span class="built_in">max</span>(dp[j],dp[j-v[i][k]]+w[i][k]);</span><br></pre></td></tr></table></figure>

<h2 id="区间-DP"><a href="#区间-DP" class="headerlink" title="区间 DP"></a>区间 DP</h2><p>有 $n$ 堆石子排成一排每堆石子有一定的质量，现在要将这 $n$ 堆石子合并成为一堆，每次只能合并相邻的两堆，求最小代价</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dp[N][N],sum[N];</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dp);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dp[i][i]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">2</span>;l&lt;=n;l++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;j=i+l<span class="number">-1</span>;j&lt;=n;i++,j++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=i;k&lt;=j;k++)</span><br><span class="line">            dp[i][j]=<span class="built_in">min</span>(dp[i][j],dp[i][k]+dp[k+<span class="number">1</span>][j]+sum[j]-sum[i<span class="number">-1</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="状压-DP"><a href="#状压-DP" class="headerlink" title="状压 DP"></a>状压 DP</h2><ul>
<li>预处理二进制状态 $1$ 的个数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// i&amp;(i-1)=i-lowbit(i)</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">1</span>&lt;&lt;n;i++) cnt[i]=cnt[i&amp;(i<span class="number">-1</span>)]+<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>枚举二进制状态的子集</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1</span>&lt;&lt;n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=i;j;j=(j<span class="number">-1</span>)&amp;i)</span><br></pre></td></tr></table></figure>

<h2 id="数位-DP"><a href="#数位-DP" class="headerlink" title="数位 DP"></a>数位 DP</h2><ul>
<li>注意前导 $0$</li>
</ul>
<h2 id="斜率优化"><a href="#斜率优化" class="headerlink" title="斜率优化"></a>斜率优化</h2><ul>
<li><p>将状态转移方程化成 $b&#x3D;-kx+y$ 形式</p>
</li>
<li><p>假如经过判断，我们需要维护的是一个下凸包，那么我们需要找的最优决策点为 $k_{l}\le k_x &lt; k_{r}$ 的最小的 $x$</p>
</li>
<li><p>$x$ 非严格递增时，求斜率时若 $x$ 相等，加上 <code>return y[a]&lt;=y[b]?LDBL_MAX:LDBL_MIN</code></p>
</li>
<li><p>比较斜率时，出队条件最好加上等于，防止分母出锅</p>
</li>
<li><p>根据题意判断队列初始化时是否要加入决策点 $0$</p>
</li>
<li><p>$x$ 单调，$k$ 单调：用单调队列维护凸包</p>
</li>
<li><p>$x$ 单调，$k$ 非单调：用单调栈维护凸包，每次二分找最佳决策点</p>
</li>
</ul>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x==fa[x]?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> tx=<span class="built_in">find</span>(x),ty=<span class="built_in">find</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(tx==ty) <span class="keyword">return</span>;</span><br><span class="line">    fa[tx]=ty;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>边带权</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==fa[x]) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="type">int</span> root=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">    d[x]=    ; <span class="comment">// 更新x的边权（与fa[x]的边权的关系）</span></span><br><span class="line">    <span class="keyword">return</span> fa[x]=root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> tx=<span class="built_in">find</span>(x),ty=<span class="built_in">find</span>(y);</span><br><span class="line">    fa[tx]=ty;</span><br><span class="line">    d[tx]=   ; <span class="comment">// 更新x的边权</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>扩展域</li>
</ul>
<p>扩展域：将一个节点拆成为多个节点</p>
<p>如：判断 $x,y$ 奇偶性</p>
<p>可将节点分为奇数域和偶数域：<code>odd=x,even=x+n;</code></p>
<p>若 $x$ 和 $y$ 奇偶性相同：<code>get(odd)=get(odd),get(even)=get(even);</code></p>
<p>若 $x$ 和 $y$ 奇偶性不同：<code>get(odd)=get(even),get(even)=get(odd);</code></p>
<h2 id="ST-表"><a href="#ST-表" class="headerlink" title="ST 表"></a>ST 表</h2><ul>
<li>一维</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N], mx[<span class="number">25</span>][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">hightbit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">31</span> - __builtin_clz(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        mx[<span class="number">0</span>][i]=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">hightbit</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= t; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j + (<span class="number">1</span> &lt;&lt; i) - <span class="number">1</span> &lt;= n; j++) &#123;</span><br><span class="line">            mx[i][j] = <span class="built_in">max</span>(mx[i - <span class="number">1</span>][j], mx[i - <span class="number">1</span>][j + (<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>))]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="built_in">hightbit</span>(r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(mx[k][l], mx[k][r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>二维</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N],mx[N][N][<span class="number">10</span>][<span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">hightbit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> <span class="number">31</span>-__builtin_clz(x);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t1=<span class="built_in">hightbit</span>(n);</span><br><span class="line">    <span class="type">int</span> t2=<span class="built_in">hightbit</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=t1;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=t2;j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n-(<span class="number">1</span>&lt;&lt;i)+<span class="number">1</span>;k++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=m-(<span class="number">1</span>&lt;&lt;j)+<span class="number">1</span>;l++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!i&amp;&amp;!j) mx[k][l][i][j]=a[k][l];</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(!i) mx[k][l][i][j]=<span class="built_in">max</span>(mx[k][l][i][j<span class="number">-1</span>],mx[k][l+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][i][j<span class="number">-1</span>]);</span><br><span class="line">                    <span class="keyword">else</span> mx[k][l][i][j]=<span class="built_in">max</span>(mx[k][l][i<span class="number">-1</span>][j],mx[k+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][l][i<span class="number">-1</span>][j]);</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x1,<span class="type">int</span> y1,<span class="type">int</span> x2,<span class="type">int</span> y2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t1=<span class="built_in">hightbit</span>(x2-x1+<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> t2=<span class="built_in">hightbit</span>(y2-y1+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(&#123;mx[x1][y1][t1][t2],mx[x2-(<span class="number">1</span>&lt;&lt;t1)+<span class="number">1</span>][y1][t1][t2],</span><br><span class="line">                mx[x1][y2-(<span class="number">1</span>&lt;&lt;t2)+<span class="number">1</span>][t1][t2],mx[x2-(<span class="number">1</span>&lt;&lt;t1)+<span class="number">1</span>][y2-(<span class="number">1</span>&lt;&lt;t2)+<span class="number">1</span>][t1][t2]&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="树状数组"><a href="#树状数组" class="headerlink" title="树状数组"></a>树状数组</h2><ul>
<li>单点修改 &amp; 单点查询 &amp; 区间查询</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,b[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=n;i+=i&amp;-i) b[i]+=v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i) ret+=b[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r;i;i-=i&amp;-i) ret+=b[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l<span class="number">-1</span>;i;i-=i&amp;-i) ret-=b[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>区间修改 &amp; 单点查询 &amp; 区间查询</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,b[N],c[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=n;i+=i&amp;-i) b[i]+=v,c[i]+=l*v;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;=n;i+=i&amp;-i) b[i]-=v,c[i]-=(r+<span class="number">1</span>)*v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i) ret+=(x+<span class="number">1</span>)*b[i]-c[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r;i;i-=i&amp;-i) ret+=(r+<span class="number">1</span>)*b[i]-c[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l<span class="number">-1</span>;i;i-=i&amp;-i) ret-=l*b[i]-c[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,a[N],ls[N&lt;&lt;<span class="number">2</span>],rs[N&lt;&lt;<span class="number">2</span>],w[N&lt;&lt;<span class="number">2</span>],add[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    ls[p]=l,rs[p]=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r) &#123;w[p]=a[l];<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    w[p]=w[p&lt;&lt;<span class="number">1</span>]+w[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(add[p]) &#123;</span><br><span class="line">        w[p&lt;&lt;<span class="number">1</span>]+=(rs[p&lt;&lt;<span class="number">1</span>]-ls[p&lt;&lt;<span class="number">1</span>]+<span class="number">1</span>)*add[p];</span><br><span class="line">        w[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=(rs[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]-ls[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+<span class="number">1</span>)*add[p];</span><br><span class="line">        add[p&lt;&lt;<span class="number">1</span>]+=add[p],add[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=add[p];</span><br><span class="line">        add[p]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ls[p]&gt;=l&amp;&amp;rs[p]&lt;=r) &#123;</span><br><span class="line">        w[p]+=(rs[p]-ls[p]+<span class="number">1</span>)*v;</span><br><span class="line">        add[p]+=v;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">push_down</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=ls[p]+rs[p]&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">update</span>(p&lt;&lt;<span class="number">1</span>,l,r,v);</span><br><span class="line">    <span class="keyword">if</span>(r&gt;mid) <span class="built_in">update</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,v);</span><br><span class="line">    w[p]=w[p&lt;&lt;<span class="number">1</span>]+w[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ls[p]&gt;=l&amp;&amp;rs[p]&lt;=r) <span class="keyword">return</span> w[p];</span><br><span class="line">    <span class="built_in">push_down</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=ls[p]+rs[p]&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(r&lt;=mid) <span class="keyword">return</span> <span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(l&gt;mid) <span class="keyword">return</span> <span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,r)+<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>标记永久化</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,a[N],ls[N&lt;&lt;<span class="number">2</span>],rs[N&lt;&lt;<span class="number">2</span>],w[N&lt;&lt;<span class="number">2</span>],add[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    ls[p]=l,rs[p]=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r) &#123;w[p]=a[l];<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    w[p]=w[p&lt;&lt;<span class="number">1</span>]+w[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    w[p]+=(<span class="built_in">min</span>(rs[p],r)-<span class="built_in">max</span>(ls[p],l)+<span class="number">1</span>)*v;</span><br><span class="line">    <span class="keyword">if</span>(ls[p]&gt;=l&amp;&amp;rs[p]&lt;=r) &#123;</span><br><span class="line">        add[p]+=v;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=ls[p]+rs[p]&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">update</span>(p&lt;&lt;<span class="number">1</span>,l,r,v);</span><br><span class="line">    <span class="keyword">if</span>(r&gt;mid) <span class="built_in">update</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ls[p]&gt;=l&amp;&amp;rs[p]&lt;=r) <span class="keyword">return</span> w[p];</span><br><span class="line">    <span class="type">int</span> mid=ls[p]+rs[p]&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret=(r-l+<span class="number">1</span>)*add[p];</span><br><span class="line">    <span class="keyword">if</span>(r&lt;=mid) <span class="keyword">return</span> ret+<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(l&gt;mid) <span class="keyword">return</span> ret+<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> ret+<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,mid)+<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可持久化线段树"><a href="#可持久化线段树" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h2><ul>
<li>区间修改，有两种方法，lazy 标记下传和标记永久化，前者空间需开大。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 区间第 k 小</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n,m,a[N];</span><br><span class="line"><span class="type">int</span> ls[N&lt;&lt;<span class="number">5</span>],rs[N&lt;&lt;<span class="number">5</span>],sum[N&lt;&lt;<span class="number">5</span>],rt[N],cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> q,<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    p=++cnt;</span><br><span class="line">    ls[p]=ls[q],rs[p]=rs[q],sum[p]=sum[q]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(L==R) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid=L+R&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid) <span class="built_in">update</span>(ls[p],ls[q],L,mid,x);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(rs[p],rs[q],mid+<span class="number">1</span>,R,x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> q,<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L==R) <span class="keyword">return</span> L;</span><br><span class="line">    <span class="type">int</span> mid=L+R&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> lsum=sum[ls[q]]-sum[ls[p]];</span><br><span class="line">    <span class="keyword">if</span>(k&lt;=lsum) <span class="keyword">return</span> <span class="built_in">query</span>(ls[p],ls[q],L,mid,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(rs[p],rs[q],mid+<span class="number">1</span>,R,k-lsum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">update</span>(rt[i],rt[i<span class="number">-1</span>],<span class="number">-1e9</span>,<span class="number">1e9</span>,a[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> l,r,k;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;l,&amp;r,&amp;k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(rt[l<span class="number">-1</span>],rt[r],<span class="number">-1e9</span>,<span class="number">1e9</span>,k));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h2><h3 id="Splay-树"><a href="#Splay-树" class="headerlink" title="Splay 树"></a>Splay 树</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span> &#123;</span><br><span class="line">    <span class="type">int</span> rt,cnt,ch[N][<span class="number">2</span>],sz[N],tot[N],val[N],fa[N];</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x==ch[fa[x]][<span class="number">1</span>];&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;ch[x][<span class="number">0</span>]=ch[x][<span class="number">1</span>]=fa[x]=val[x]=sz[x]=tot[x]=<span class="number">0</span>;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;sz[x]=sz[ch[x][<span class="number">0</span>]]+sz[ch[x][<span class="number">1</span>]]+tot[x];&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y=fa[x],z=fa[y],chk=<span class="built_in">get</span>(x);</span><br><span class="line">        ch[y][chk]=ch[x][chk^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(ch[x][chk^<span class="number">1</span>]) fa[ch[x][chk^<span class="number">1</span>]]=y;</span><br><span class="line">        ch[x][chk^<span class="number">1</span>]=y;</span><br><span class="line">        fa[y]=x,fa[x]=z;</span><br><span class="line">        <span class="keyword">if</span>(z) ch[z][y==ch[z][<span class="number">1</span>]]=x;</span><br><span class="line">        <span class="built_in">push_up</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> f=fa[x];f=fa[x],f;<span class="built_in">rotate</span>(x)) <span class="keyword">if</span>(fa[f])</span><br><span class="line">            <span class="built_in">rotate</span>(<span class="built_in">get</span>(x)==<span class="built_in">get</span>(f)?f:x);</span><br><span class="line">        <span class="built_in">push_up</span>(x);</span><br><span class="line">        rt=x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt) &#123;</span><br><span class="line">            val[++cnt]=x;</span><br><span class="line">            ++tot[cnt];</span><br><span class="line">            rt=cnt;</span><br><span class="line">            <span class="built_in">push_up</span>(rt);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> cur=rt,f=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">            <span class="keyword">if</span>(val[cur]==x) &#123;</span><br><span class="line">                ++tot[cur];</span><br><span class="line">                <span class="built_in">push_up</span>(cur),<span class="built_in">push_up</span>(f);</span><br><span class="line">                <span class="built_in">splay</span>(cur);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            f=cur;</span><br><span class="line">            cur=ch[cur][val[cur]&lt;x];</span><br><span class="line">            <span class="keyword">if</span>(!cur) &#123;</span><br><span class="line">                val[++cnt]=x;</span><br><span class="line">                ++tot[cnt];</span><br><span class="line">                fa[cnt]=f;</span><br><span class="line">                ch[f][val[f]&lt;x]=cnt;</span><br><span class="line">                <span class="built_in">push_up</span>(cnt),<span class="built_in">push_up</span>(f);</span><br><span class="line">                <span class="built_in">splay</span>(cnt);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">rk</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="comment">// 树中存在 x</span></span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>,cur=rt;</span><br><span class="line">        <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;val[cur]) cur=ch[cur][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res+=sz[ch[cur][<span class="number">0</span>]];</span><br><span class="line">                <span class="keyword">if</span>(x==val[cur]) <span class="keyword">break</span>;</span><br><span class="line">                res+=tot[cur];</span><br><span class="line">                cur=ch[cur][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> res+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=rt;</span><br><span class="line">        <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ch[cur][<span class="number">0</span>]&amp;&amp;k&lt;=sz[ch[cur][<span class="number">0</span>]]) cur=ch[cur][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                k-=tot[cur]+sz[ch[cur][<span class="number">0</span>]];</span><br><span class="line">                <span class="keyword">if</span>(k&lt;=<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                cur=ch[cur][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> val[cur];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=ch[rt][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span>(ch[cur][<span class="number">1</span>]) cur=ch[cur][<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=ch[rt][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(ch[cur][<span class="number">0</span>]) cur=ch[cur][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">rk</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(!ch[rt][<span class="number">0</span>]||!ch[rt][<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> cur=rt;</span><br><span class="line">            fa[rt=ch[rt][<span class="number">0</span>]+ch[rt][<span class="number">1</span>]]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 合并左右子树，将左子树最大值 Splay 到根，然后把它的右子树设置为右子树并更新节点的信息</span></span><br><span class="line">            <span class="type">int</span> cur=rt;</span><br><span class="line">            x=<span class="built_in">pre</span>();</span><br><span class="line">            fa[ch[cur][<span class="number">1</span>]]=x;</span><br><span class="line">            ch[x][<span class="number">1</span>]=ch[cur][<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">            <span class="built_in">push_up</span>(rt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_pre</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(x); <span class="comment">// 插入 x，此时 x 位于树根，前驱即为 x 的左子树最右边的节点</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="built_in">pre</span>();</span><br><span class="line">        <span class="built_in">del</span>(x); <span class="comment">// 删除 x</span></span><br><span class="line">        <span class="keyword">return</span> ret;  <span class="comment">// 返回节点 id</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_nxt</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(x);  <span class="comment">// 插入 x，此时 x 位于树根，后驱即为 x 的右子树最左边的节点</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="built_in">nxt</span>();</span><br><span class="line">        <span class="built_in">del</span>(x); <span class="comment">// 删除 x</span></span><br><span class="line">        <span class="keyword">return</span> ret; <span class="comment">// 返回节点 id</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;splay;</span><br></pre></td></tr></table></figure>

<ul>
<li>平衡树维护区间翻转</li>
<li>LibreOJ 104. 文艺平衡树</li>
</ul>
<p>对于区间 $[l,r]$，将 $l-1$ 上旋至树根，$r+1$ 上旋至树根的右子树，那么树根的右子树的左子树就是区间 $[l,r]$，将其标记，注意下放标记并且交换左右子树。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span> &#123;</span><br><span class="line">    <span class="type">int</span> rt,cnt,ch[N][<span class="number">2</span>],sz[N],fa[N],mark[N];</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x==ch[fa[x]][<span class="number">1</span>];&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;sz[x]=sz[ch[x][<span class="number">0</span>]]+sz[ch[x][<span class="number">1</span>]]+<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mark[x]) &#123;</span><br><span class="line">            mark[ch[x][<span class="number">0</span>]]^=<span class="number">1</span>;</span><br><span class="line">            mark[ch[x][<span class="number">1</span>]]^=<span class="number">1</span>;</span><br><span class="line">            mark[x]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">swap</span>(ch[x][<span class="number">0</span>],ch[x][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        ch[mid][<span class="number">0</span>]=ch[mid][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">-1</span>) rt=mid,fa[rt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> ch[f][r&gt;f]=mid,fa[mid]=f;</span><br><span class="line">        <span class="built_in">build</span>(l,mid<span class="number">-1</span>,mid);</span><br><span class="line">        <span class="built_in">build</span>(mid+<span class="number">1</span>,r,mid);</span><br><span class="line">        <span class="built_in">push_up</span>(mid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y=fa[x],z=fa[y];</span><br><span class="line">        <span class="built_in">push_down</span>(y);</span><br><span class="line">        <span class="built_in">push_down</span>(x);</span><br><span class="line">        <span class="type">int</span> chk=<span class="built_in">get</span>(x);</span><br><span class="line">        ch[y][chk]=ch[x][chk^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(ch[x][chk^<span class="number">1</span>]) fa[ch[x][chk^<span class="number">1</span>]]=y;</span><br><span class="line">        ch[x][chk^<span class="number">1</span>]=y;</span><br><span class="line">        fa[y]=x,fa[x]=z;</span><br><span class="line">        <span class="keyword">if</span>(z) ch[z][y==ch[z][<span class="number">1</span>]]=x;</span><br><span class="line">        <span class="built_in">push_up</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">push_down</span>(x);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> f=fa[x];f=fa[x],f!=t;<span class="built_in">rotate</span>(x)) <span class="keyword">if</span>(fa[f]!=t)</span><br><span class="line">            <span class="built_in">rotate</span>(<span class="built_in">get</span>(x)==<span class="built_in">get</span>(f)?f:x);</span><br><span class="line">        <span class="built_in">push_up</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(!t) rt=x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=rt;</span><br><span class="line">        <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">            <span class="built_in">push_down</span>(cur);</span><br><span class="line">            <span class="keyword">if</span>(ch[cur][<span class="number">0</span>]&amp;&amp;k&lt;=sz[ch[cur][<span class="number">0</span>]]) cur=ch[cur][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                k-=<span class="number">1</span>+sz[ch[cur][<span class="number">0</span>]];</span><br><span class="line">                <span class="keyword">if</span>(k&lt;=<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                cur=ch[cur][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(cur,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        l=<span class="built_in">kth</span>(l);</span><br><span class="line">        r=<span class="built_in">kth</span>(r+<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">splay</span>(l,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">splay</span>(r,l);</span><br><span class="line">        mark[ch[ch[rt][<span class="number">1</span>]][<span class="number">0</span>]]^=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(u) &#123;</span><br><span class="line">            <span class="built_in">push_down</span>(u);</span><br><span class="line">            <span class="built_in">print</span>(ch[u][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span>(u&gt;<span class="number">1</span>&amp;&amp;u&lt;n+<span class="number">2</span>) cout&lt;&lt;u<span class="number">-1</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="built_in">print</span>(ch[u][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;splay;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    splay.<span class="built_in">build</span>(<span class="number">1</span>,n+<span class="number">2</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        splay.<span class="built_in">reverse</span>(l,r);</span><br><span class="line">    &#125;</span><br><span class="line">    splay.<span class="built_in">print</span>(splay.rt);</span><br><span class="line">    cout&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="树套树"><a href="#树套树" class="headerlink" title="树套树"></a>树套树</h2><h3 id="树状数组套可持久化线段树"><a href="#树状数组套可持久化线段树" class="headerlink" title="树状数组套可持久化线段树"></a>树状数组套可持久化线段树</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态区间第 k 小</span></span><br><span class="line"><span class="comment">// luogu P2617</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SZ(x) (int)(x).size()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALL(x) (x).begin(),(x).end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PB push_back</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; VI;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n,m,a[N],cnt,rt[N],ls[N*<span class="number">2</span>*<span class="number">18</span>*<span class="number">18</span>],rs[N*<span class="number">2</span>*<span class="number">18</span>*<span class="number">18</span>],sum[N*<span class="number">2</span>*<span class="number">18</span>*<span class="number">18</span>],tot1,tot2,t1[<span class="number">18</span>],t2[<span class="number">18</span>];</span><br><span class="line">VI b;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Q</span> &#123;</span><br><span class="line">    <span class="type">char</span> o;</span><br><span class="line">    <span class="type">int</span> l,r,k;</span><br><span class="line">    <span class="type">int</span> x,v;</span><br><span class="line">&#125;q[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lower_bound</span>(<span class="built_in">ALL</span>(b),x)-b.<span class="built_in">begin</span>()+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!p) p=++cnt;</span><br><span class="line">    sum[p]+=v;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid) <span class="built_in">update</span>(ls[p],l,mid,x,v);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(rs[p],mid+<span class="number">1</span>,r,x,v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>,sz=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot1;i++) sz-=sum[ls[t1[i]]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot2;i++) sz+=sum[ls[t2[i]]];</span><br><span class="line">    <span class="keyword">if</span>(sz&gt;=k) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot1;i++) t1[i]=ls[t1[i]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot2;i++) t2[i]=ls[t2[i]];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(l,mid,k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot1;i++) t1[i]=rs[t1[i]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot2;i++) t2[i]=rs[t2[i]];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(mid+<span class="number">1</span>,r,k-sz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(;p&lt;=n;p+=<span class="built_in">lowbit</span>(p)) <span class="built_in">update</span>(rt[p],<span class="number">1</span>,<span class="built_in">SZ</span>(b),x,v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qry</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    tot1=tot2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;l;l-=<span class="built_in">lowbit</span>(l)) t1[++tot1]=rt[l];</span><br><span class="line">    <span class="keyword">for</span>(;r;r-=<span class="built_in">lowbit</span>(r)) t2[++tot2]=rt[r];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>,<span class="built_in">SZ</span>(b),k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">        b.<span class="built_in">PB</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot; %c&quot;</span>,&amp;q[i].o);</span><br><span class="line">        <span class="keyword">if</span>(q[i].o==<span class="string">&#x27;C&#x27;</span>) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;q[i].x,&amp;q[i].v),b.<span class="built_in">PB</span>(q[i].v);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;q[i].l,&amp;q[i].r,&amp;q[i].k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">ALL</span>(b));</span><br><span class="line">    b.<span class="built_in">resize</span>(<span class="built_in">unique</span>(<span class="built_in">ALL</span>(b))-b.<span class="built_in">begin</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">upd</span>(i,<span class="built_in">find</span>(a[i]),<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(q[i].o==<span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">upd</span>(q[i].x,<span class="built_in">find</span>(q[i].v),<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">upd</span>(q[i].x,<span class="built_in">find</span>(a[q[i].x]),<span class="number">-1</span>);</span><br><span class="line">            a[q[i].x]=q[i].v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,b[<span class="built_in">qry</span>(q[i].l<span class="number">-1</span>,q[i].r,q[i].k)<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="莫队"><a href="#莫队" class="headerlink" title="莫队"></a>莫队</h2><h3 id="普通莫队"><a href="#普通莫队" class="headerlink" title="普通莫队"></a>普通莫队</h3><p>对于长度为 $n$ 的序列上的 $m$ 次区间询问问题，如果从 $[l,r]$ 的答案能够 $O(1)$ 扩展到 $[l-1,r],[l+1,r],[l,r-1],[l,r+1]$ 的答案，可以在 $O(n\sqrt m)$ 的复杂度内求出所有询问的答案。</p>
<p>实现：离线后排序，顺序处理每个询问，暴力从上一个区间的答案转移到下一个区间答案（一步一步移动即可）。</p>
<p>排序方法：设定块的长度为 $S$，取 $S&#x3D;\lceil\frac{n}{\sqrt m}\rceil$，按照 $(\lfloor\frac l {S}\rfloor,r)$ 的二元组从小到大排序。</p>
<p>奇偶优化：设块的编号从 $1$ 开始，对于属于奇数块的询问，$r$ 按从小到大排序，对于属于偶数块的排序，$r$ 从大到小排序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPOJ DQUERY 区间不同数的个数的查询</span></span><br><span class="line"><span class="comment">// 数组均从 0 开始</span></span><br><span class="line"><span class="type">int</span> n,m,unit,ans,a[<span class="number">30005</span>],cnt[<span class="number">1000005</span>],res[<span class="number">200005</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Q</span> &#123;</span><br><span class="line">    <span class="type">int</span> l,r,id;</span><br><span class="line">    <span class="built_in">Q</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Q</span>(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> id):<span class="built_in">l</span>(l),<span class="built_in">r</span>(r),<span class="built_in">id</span>(id) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Q &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(l/unit!=T.l/unit) <span class="keyword">return</span> l&lt;T.l;</span><br><span class="line">        <span class="keyword">if</span>((l/unit)&amp;<span class="number">1</span>) <span class="keyword">return</span> r&gt;T.r;</span><br><span class="line">        <span class="keyword">return</span> r&lt;T.r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; q[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">-1</span>&amp;&amp;--cnt[a[x]]==<span class="number">0</span>) --ans;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>&amp;&amp;++cnt[a[x]]==<span class="number">1</span>) ++ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    unit=<span class="built_in">int</span>(<span class="built_in">ceil</span>(n/<span class="built_in">pow</span>(n,<span class="number">0.5</span>)));</span><br><span class="line">    <span class="built_in">sort</span>(q,q+m);</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>,r=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q[i].l) <span class="built_in">move</span>(--l,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q[i].r) <span class="built_in">move</span>(++r,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q[i].l) <span class="built_in">move</span>(l++,<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q[i].r) <span class="built_in">move</span>(r--,<span class="number">-1</span>);</span><br><span class="line">        res[q[i].id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) cin&gt;&gt;a[i];</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">        cin&gt;&gt;q[i].l&gt;&gt;q[i].r;</span><br><span class="line">        --q[i].l,--q[i].r;</span><br><span class="line">        q[i].id=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mo</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) cout&lt;&lt;res[i]&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="带修莫队"><a href="#带修莫队" class="headerlink" title="带修莫队"></a>带修莫队</h3><p>因为多了修改操作，所以在普通莫队的基础上多加一个时间轴 $t$，可以在 $O(\sqrt[3]{n^4t})$ 的复杂度内求出所有询问的答案。</p>
<p>排序方法：设定块的长度为 $S$，取 $S&#x3D;\lceil\sqrt[3]{nt}\rceil$，按照 $(\lfloor\frac l {S}\rfloor, \lfloor\frac r {S}\rfloor, t)$ 的三元组从小到大排序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BZOJ 2120 带修改的区间不同数的个数的查询</span></span><br><span class="line"><span class="type">int</span> n,m,unit,t=<span class="number">1</span>,ans,a[<span class="number">10005</span>],cnt[<span class="number">1000005</span>],pre[<span class="number">10005</span>],res[<span class="number">10005</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">R</span> &#123;</span><br><span class="line">    <span class="type">int</span> x,v,pre;</span><br><span class="line">    <span class="built_in">R</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">R</span>(<span class="type">int</span> x,<span class="type">int</span> v,<span class="type">int</span> pre):<span class="built_in">x</span>(x),<span class="built_in">v</span>(v),<span class="built_in">pre</span>(pre) &#123;&#125;</span><br><span class="line">&#125; b[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Q</span> &#123;</span><br><span class="line">    <span class="type">int</span> l,r,t,id;</span><br><span class="line">    <span class="built_in">Q</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Q</span>(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> t,<span class="type">int</span> id):<span class="built_in">l</span>(l),<span class="built_in">r</span>(r),<span class="built_in">t</span>(t),<span class="built_in">id</span>(id) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Q &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(l/unit!=T.l/unit) <span class="keyword">return</span> l&lt;T.l;</span><br><span class="line">        <span class="keyword">if</span>(r/unit!=T.l/unit) <span class="keyword">return</span> r&lt;T.r;</span><br><span class="line">        <span class="keyword">return</span> t&lt;T.t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;Q&gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_t</span><span class="params">(<span class="type">int</span> t,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b[t].x&gt;=l&amp;&amp;b[t].x&lt;=r) &#123;</span><br><span class="line">            <span class="keyword">if</span>(--cnt[b[t].pre]==<span class="number">0</span>) --ans;</span><br><span class="line">            <span class="keyword">if</span>(++cnt[b[t].v]==<span class="number">1</span>) ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">        a[b[t].x]=b[t].v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(b[t].x&gt;=l&amp;&amp;b[t].x&lt;=r) &#123;</span><br><span class="line">            <span class="keyword">if</span>(--cnt[b[t].v]==<span class="number">0</span>) --ans;</span><br><span class="line">            <span class="keyword">if</span>(++cnt[b[t].pre]==<span class="number">1</span>) ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">        a[b[t].x]=b[t].pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">-1</span>&amp;&amp;--cnt[a[x]]==<span class="number">0</span>) --ans;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>&amp;&amp;++cnt[a[x]]==<span class="number">1</span>) ++ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    unit=<span class="built_in">int</span>(<span class="built_in">ceil</span>(<span class="built_in">pow</span>(n*t,<span class="number">1.0</span>/<span class="number">3</span>)));</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">ALL</span>(q));</span><br><span class="line">    <span class="type">int</span> t=<span class="number">1</span>,l=<span class="number">0</span>,r=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x:q) &#123;</span><br><span class="line">        <span class="keyword">while</span>(t&lt;x.t) <span class="built_in">update_t</span>(++t,l,r,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(t&gt;x.t) <span class="built_in">update_t</span>(t--,l,r,<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">while</span>(l&gt;x.l) <span class="built_in">update</span>(--l,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;x.r) <span class="built_in">update</span>(++r,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;x.l) <span class="built_in">update</span>(l++,<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;x.r) <span class="built_in">update</span>(r--,<span class="number">-1</span>);</span><br><span class="line">        res[x.id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">SZ</span>(q);i++) cout&lt;&lt;res[i]&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        pre[i]=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> cnt_q=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">        <span class="type">char</span> o;cin&gt;&gt;o;</span><br><span class="line">        <span class="keyword">if</span>(o==<span class="string">&#x27;R&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> x,v;cin&gt;&gt;x&gt;&gt;v;</span><br><span class="line">            --x;</span><br><span class="line">            b[++t]=<span class="built_in">R</span>(x,v,pre[x]);</span><br><span class="line">            pre[x]=v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> l,r;cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">            --l,--r;</span><br><span class="line">            q.<span class="built_in">EB</span>(l,r,t,cnt_q++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mo</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="最短路"><a href="#最短路" class="headerlink" title="最短路"></a>最短路</h2><h3 id="Dijkstra-算法"><a href="#Dijkstra-算法" class="headerlink" title="Dijkstra 算法"></a>Dijkstra 算法</h3><ul>
<li>无法处理负权</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dist[N];</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line">VPII g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    priority_queue&lt;PII,VPII,greater&lt;PII&gt;&gt; q;</span><br><span class="line">    q.<span class="built_in">emplace</span>(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">top</span>().SE;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(st[u]) <span class="keyword">continue</span>;</span><br><span class="line">        st[u]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:g[u]) &#123;</span><br><span class="line">            <span class="type">int</span> v=x.FI,w=x.SE;</span><br><span class="line">            <span class="keyword">if</span>(!st[v]&amp;&amp;dist[u]+w&lt;dist[v]) &#123;</span><br><span class="line">                dist[v]=dist[u]+w;</span><br><span class="line">                q.<span class="built_in">emplace</span>(dist[v],v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SPFA-算法"><a href="#SPFA-算法" class="headerlink" title="SPFA 算法"></a>SPFA 算法</h3><ul>
<li>一条最短路最多有 $n-1$ 条边组成，若经过 $n-1$ 次更新后还能更新，则存在负环</li>
<li>LLL 优化：将普通队列换成双端队列，每次将入队结点距离和队内距离平均值比较，如果更大则插入至队尾，否则插入队首</li>
<li>SLF 优化：将普通队列换成双端队列，每次将入队结点距离和队首比较，如果更大则插入至队尾，否则插入队首</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dist[N];</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line">VPII g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    st[<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        st[u]=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:g[u]) &#123;</span><br><span class="line">            <span class="type">int</span> v=x.FI,w=x.SE;</span><br><span class="line">            <span class="keyword">if</span>(dist[u]+w&lt;dist[v]) &#123;</span><br><span class="line">                dist[v]=dist[u]+w;</span><br><span class="line">                <span class="keyword">if</span>(!st[v]) q.<span class="built_in">push</span>(v),st[v]=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Floyd-算法"><a href="#Floyd-算法" class="headerlink" title="Floyd 算法"></a>Floyd 算法</h3><ul>
<li>全源最短路</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,dist[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">floyd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dist);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n;k++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">                dist[i][j]=<span class="built_in">min</span>(dist[i][j],dist[i][k]+dist[k][j]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="同余最短路"><a href="#同余最短路" class="headerlink" title="同余最短路"></a>同余最短路</h2><ul>
<li>解决形如 $k&#x3D;\sum_{i&#x3D;1}^{n}{a_ix_i}$ 的问题</li>
</ul>
<p>假设数组 $a$ 最小的是 $a_1$，记 $y&#x3D;\sum_{i&#x3D;2}^{n}{a_ix_i}$</p>
<p>设 $f[j]$ 为使 $y \bmod {a_1} &#x3D; j$ 成立的最小的 $y$</p>
<p>可以得到转移式：$f[(j+a_i) % a_1]&#x3D;min(f[(j+a_i) % a_1],f[j]+a_i)$ $(2\le i \le n,0\le j &lt; a_1)$</p>
<p>因此可以在点 $j$ 和点 $(j+a_i) % a_1$ 间建立一条权值为 $a_i$ 的边，跑最短路</p>
<h2 id="差分约束"><a href="#差分约束" class="headerlink" title="差分约束"></a>差分约束</h2><p>一个系统 $n$ 个变量和 $m$ 个约束条件组成，每个约束条件形如 $x_j-x_i \le b_k$</p>
<p>可以发现每个约束条件都形如最短路中的三角不等式 $d_u-d_v \le w _ {u,v}$，因此连一条边 $(i,j,b_k)$ 建图</p>
<p>若要使得所有量两两的值最接近（最小解），源点到各点的距离初始成 $0$，跑最长路</p>
<p>若要使得某一变量与其他变量的差尽可能大（最大解），则源点到各点距离初始化成 $\infty$，跑最短路</p>
<ul>
<li><p>若约束条件中的变量为整数，$d_u-d_v &lt; w _ {u,v}$ 可改为 $d_u-d_v \le w _ {u,v}-1$</p>
</li>
<li><p>若约束条件中的变量为实数，$d_u-d_v &lt; w _ {u,v}$ 可近似为 $d_u-d_v \le w _ {u,v}$</p>
</li>
</ul>
<p>根据约束条件，判断跑最短路还是最长路</p>
<p>跑最短路，有负环则无法满足所有约束条件</p>
<p>跑最长路，有正环则无法满足所有约束条件</p>
<h2 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h2><h3 id="Kurskal-算法"><a href="#Kurskal-算法" class="headerlink" title="Kurskal 算法"></a>Kurskal 算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, fa[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> E &amp;a) <span class="type">const</span> &#123; <span class="keyword">return</span> w&lt;a.w; &#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;E&gt; e;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == fa[x] ? x : fa[x] = <span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        fa[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">ALL</span>(e));</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : e) &#123;</span><br><span class="line">        <span class="type">int</span> fu = <span class="built_in">find</span>(x.u), fv = <span class="built_in">find</span>(x.v);</span><br><span class="line">        <span class="keyword">if</span> (Fu != fv) &#123;</span><br><span class="line">            fa[fu] = fv;</span><br><span class="line">            ret += x.w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Prim-算法"><a href="#Prim-算法" class="headerlink" title="Prim 算法"></a>Prim 算法</h3><ul>
<li>Prim 算法可以堆优化，但用优先队列实现堆不如直接用 Kruskal 算法。</li>
<li>稠密图和完全图用暴力 Prim 算法比 Kruskal 算法更优，但不一定跑得快，时间复杂度 $O(n^2+m)$。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> w[N][N],f[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">prim</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="literal">false</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line">    f[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) <span class="keyword">if</span>(!vis[j]&amp;&amp;(x==<span class="number">0</span>||f[j]&lt;f[x])) &#123;</span><br><span class="line">            x=j;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[x]=<span class="literal">true</span>;</span><br><span class="line">        ret+=f[x];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) <span class="keyword">if</span>(!vis[j]&amp;&amp;w[x][j]&lt;f[j]) &#123;</span><br><span class="line">            f[j]=w[x][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最小生成树的唯一性"><a href="#最小生成树的唯一性" class="headerlink" title="最小生成树的唯一性"></a>最小生成树的唯一性</h3><p>考虑最小生成树的唯一性。如果一条边不在最小生成树的边集中 ，并且可以替换与其权值相同、并且在最小生成树边集 的另一条边。那么这个最小生成树就是不唯一的</p>
<p>对于 Kruskal 算法，只要计算为当前权值的边可以放几条，实际放了几条，如果这两个值不一样，那么就说明这几条边与之前的边产生了一个环（这个环中至少有两条当前权值的边，否则根据并查集，这条边是不能放的），即最小生成树不唯一</p>
<p>寻找权值与当前边相同的边，我们只需要记录头尾指针，用单调队列即可在基本与原算法时间相同的时间复杂度里优秀解决这个问题</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ 1679</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">105</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">    <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w):<span class="built_in">u</span>(u),<span class="built_in">v</span>(v),<span class="built_in">w</span>(w) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> E &amp;a) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> w&lt;a.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;e[N*N];</span><br><span class="line"><span class="type">int</span> n,m,fa[N],cnt;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x==fa[x]?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i;</span><br><span class="line">    <span class="built_in">sort</span>(e+<span class="number">1</span>,e+<span class="number">1</span>+cnt);</span><br><span class="line">    e[++cnt]=<span class="built_in">E</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="type">bool</span> f=<span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,tail=<span class="number">0</span>,sum1=<span class="number">0</span>,sum2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;tail) &#123;</span><br><span class="line">            <span class="keyword">if</span>(sum1!=sum2) &#123;f=<span class="literal">false</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            sum1=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;=cnt;j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(e[j].w!=e[i].w) &#123;tail=j<span class="number">-1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">find</span>(e[j].u)!=<span class="built_in">find</span>(e[j].v)) sum1++;</span><br><span class="line">            &#125;</span><br><span class="line">            sum2=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;cnt) <span class="keyword">break</span>;</span><br><span class="line">        <span class="type">int</span> tx=<span class="built_in">find</span>(e[i].u),ty=<span class="built_in">find</span>(e[i].v);</span><br><span class="line">        <span class="keyword">if</span>(tx==ty) <span class="keyword">continue</span>;</span><br><span class="line">        fa[tx]=ty;</span><br><span class="line">        res+=e[i].w;</span><br><span class="line">        sum2++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(f) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;Not Unique!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">        cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">            <span class="type">int</span> u,v,w;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;u,&amp;v,&amp;w);</span><br><span class="line">            e[++cnt]=<span class="built_in">E</span>(u,v,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">kruskal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="次小生成树"><a href="#次小生成树" class="headerlink" title="次小生成树"></a>次小生成树</h3><h4 id="非严格次小生成树"><a href="#非严格次小生成树" class="headerlink" title="非严格次小生成树"></a>非严格次小生成树</h4><p>求出无向图的最小生成树 $T$，设其权值和为 $M$</p>
<p>遍历每条未被选中的边 $e&#x3D;(u,v,w)$，找到 $T$ 中 $u$ 到 $v$ 路径上边权最大的一条边 $e’&#x3D;(s,t,w’)$,则在 $T$ 中以 $e$ 替换 $e’$，可得一棵权值和为 $M’&#x3D;M+w-w’$ 的生成树 $T’$</p>
<p>对所有替换得到的答案 $M’$ 取最小值即可</p>
<p>使用倍增预处理出每个节点的 $2^i$ 级祖先及到达其 $2^i$ 级祖先路径上最大的边权，这样在倍增求 LCA 的过程中可以直接求得 $u,v$ 路径上的边权最大值</p>
<h4 id="严格次小生成树"><a href="#严格次小生成树" class="headerlink" title="严格次小生成树"></a>严格次小生成树</h4><p>维护到 $2^i$ 级祖先路径上的最大边权的同时维护严格次大边权，当用于替换的边的权值与原生成树中路径最大边权相等时，我们用严格次大值来替换即可</p>
<p>时间复杂度 $O(m\log m)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 洛谷 P4180</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">5</span>,M=<span class="number">3e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n,m,t,fa[N],d[N],f[N][<span class="number">20</span>],g[N][<span class="number">20</span>][<span class="number">2</span>];</span><br><span class="line"><span class="type">bool</span> st[M];</span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; G[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">    <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w):<span class="built_in">u</span>(u),<span class="built_in">v</span>(v),<span class="built_in">w</span>(w) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> E &amp;a) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> w&lt;a.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;e[M];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fa[x]==x?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i;</span><br><span class="line">    <span class="built_in">sort</span>(e+<span class="number">1</span>,e+<span class="number">1</span>+m);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> tx=<span class="built_in">find</span>(e[i].u),ty=<span class="built_in">find</span>(e[i].v);</span><br><span class="line">        <span class="keyword">if</span>(tx==ty) <span class="keyword">continue</span>;</span><br><span class="line">        st[i]=<span class="literal">true</span>;</span><br><span class="line">        fa[tx]=ty;</span><br><span class="line">        res+=e[i].w;</span><br><span class="line">        G[e[i].u].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(e[i].v,e[i].w));</span><br><span class="line">        G[e[i].v].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(e[i].u,e[i].w));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    d[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:G[u]) &#123;</span><br><span class="line">            <span class="type">int</span> v=x.first;</span><br><span class="line">            <span class="keyword">if</span>(v==f[u][<span class="number">0</span>]) <span class="keyword">continue</span>;</span><br><span class="line">            d[v]=d[u]+<span class="number">1</span>;</span><br><span class="line">            f[v][<span class="number">0</span>]=u;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=t;i++) f[v][i]=f[f[v][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">            g[v][<span class="number">0</span>][<span class="number">0</span>]=x.second;</span><br><span class="line">            g[v][<span class="number">0</span>][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=t;j++) &#123;</span><br><span class="line">                g[v][j][<span class="number">0</span>]=<span class="built_in">max</span>(g[v][j<span class="number">-1</span>][<span class="number">0</span>],g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">if</span>(g[v][j<span class="number">-1</span>][<span class="number">0</span>]==g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">0</span>])</span><br><span class="line">                    g[v][j][<span class="number">1</span>]=<span class="built_in">max</span>(g[v][j<span class="number">-1</span>][<span class="number">1</span>],g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(g[v][j<span class="number">-1</span>][<span class="number">0</span>]&lt;g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">0</span>])</span><br><span class="line">                    g[v][j][<span class="number">1</span>]=<span class="built_in">max</span>(g[v][j<span class="number">-1</span>][<span class="number">0</span>],g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(g[v][j<span class="number">-1</span>][<span class="number">0</span>]&gt;g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">0</span>])</span><br><span class="line">                    g[v][j][<span class="number">1</span>]=<span class="built_in">max</span>(g[v][j<span class="number">-1</span>][<span class="number">1</span>],g[f[v][j<span class="number">-1</span>]][j<span class="number">-1</span>][<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            q.<span class="built_in">push</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(d[a]&gt;d[b]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=t;i&gt;=<span class="number">0</span>;i--) <span class="keyword">if</span>(d[f[b][i]]&gt;=d[a]) b=f[b][i];</span><br><span class="line">    <span class="keyword">if</span>(a==b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=t;i&gt;=<span class="number">0</span>;i--) <span class="keyword">if</span>(f[a][i]!=f[b][i]) a=f[a][i],b=f[b][i];</span><br><span class="line">    <span class="keyword">return</span> f[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">calc</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">res</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=t;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">        <span class="keyword">if</span>(d[f[a][i]]&gt;=d[b]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(g[a][i][<span class="number">0</span>]&gt;=res.first) &#123;</span><br><span class="line">                res.second=<span class="built_in">max</span>(res.second,<span class="built_in">max</span>(res.first,g[a][i][<span class="number">1</span>]));</span><br><span class="line">                res.first=g[a][i][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> res.second=<span class="built_in">max</span>(res.second,g[a][i][<span class="number">0</span>]);</span><br><span class="line">            a=f[a][i];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> mst=<span class="built_in">kruskal</span>();</span><br><span class="line">    <span class="built_in">bfs</span>();</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0x7fffffffffffffff</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(st[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> mx,lca=<span class="built_in">LCA</span>(e[i].u,e[i].v);</span><br><span class="line">        pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; t1=<span class="built_in">calc</span>(e[i].u,lca),t2=<span class="built_in">calc</span>(e[i].v,lca);</span><br><span class="line">        <span class="keyword">if</span>(t1.first!=t2.first) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">max</span>(t1.first,t2.first)==e[i].w)</span><br><span class="line">                mx=<span class="built_in">max</span>(<span class="built_in">max</span>(t1.second,t2.second),<span class="built_in">min</span>(t1.first,t2.first));</span><br><span class="line">            <span class="keyword">else</span> mx=<span class="built_in">max</span>(t1.first,t2.first);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(t1.first==e[i].w) mx=<span class="built_in">max</span>(t1.second,t2.second);</span><br><span class="line">            <span class="keyword">else</span> mx=t1.first;</span><br><span class="line">        &#125;</span><br><span class="line">        res=<span class="built_in">min</span>(res,mst-mx+e[i].w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    t=(<span class="type">int</span>)(<span class="built_in">log</span>(n)/<span class="built_in">log</span>(<span class="number">2</span>))+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> u,v,w;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;u,&amp;v,&amp;w);</span><br><span class="line">        e[i]=<span class="built_in">E</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">solve</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最小-k-度限制生成树"><a href="#最小-k-度限制生成树" class="headerlink" title="最小 k 度限制生成树"></a>最小 k 度限制生成树</h3><p>去除 $v_0$，找到所有连通分量，每个连通分量跑最小生成树</p>
<p>添加 $v_0$ 与每个连通分量的最小的边（若有 $t$ 个连通分量，则此时为 $t$ 度最小生成树）</p>
<p>若 $t&lt;k$，则还可添加 $k-t$ 条边，对于每条不属于最小生成树的 $(v_0,v)$，边权为 $z$，找出最小生成树中 $v$ 到 $v_0$ 路径上的的最大边，边权为 $w$，求出使 $w-z$ 最大的点 $v$，若 $w-z&gt;0$,则加入 $(v_0,v)$</p>
<ul>
<li>求$v$ 到 $v_0$ 路径上最大边可以用 DP</li>
</ul>
<p>设 $dp[i]$ 为路径 $v_0$ 到 $v$ 无关联且权值最大的边，$fa[v]$ 为 $v$ 的父节点</p>
<p>转移方程：$dp[v]&#x3D;max(dp[fa[v]],dist[fa[v]][v])$</p>
<p>边界条件：$dp[v_0]&#x3D;-\infty,dp[v’]&#x3D;-\infty$ $((v_0,v’)\in E(T))$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ 1639</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">505</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">    <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w):<span class="built_in">u</span>(u),<span class="built_in">v</span>(v),<span class="built_in">w</span>(w) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> E &amp;a) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> w&lt;a.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;mn[N],mx[N];</span><br><span class="line"><span class="type">int</span> n,m,k,dist[N][N],fa[N],id[N],vis[N];</span><br><span class="line"><span class="type">bool</span> st[N][N];</span><br><span class="line">vector&lt;E&gt; e;</span><br><span class="line">map&lt;string,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x==fa[x]?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i;</span><br><span class="line">    <span class="built_in">sort</span>(e.<span class="built_in">begin</span>(),e.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;e.<span class="built_in">size</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(id[e[i].u]==id[e[i].v]) &#123;</span><br><span class="line">            <span class="type">int</span> tx=<span class="built_in">find</span>(e[i].u),ty=<span class="built_in">find</span>(e[i].v);</span><br><span class="line">            <span class="keyword">if</span>(tx==ty) <span class="keyword">continue</span>;</span><br><span class="line">            fa[tx]=ty;</span><br><span class="line">            res+=e[i].w;</span><br><span class="line">            st[e[i].u][e[i].v]=st[e[i].v][e[i].u]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    id[u]=t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) <span class="keyword">if</span>(dist[u][i]&amp;&amp;!id[i]) <span class="built_in">dfs1</span>(i,t);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i==fa||!st[u][i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(u!=<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(mx[u].w&gt;dist[u][i]) mx[i]=mx[u];</span><br><span class="line">            <span class="keyword">else</span> mx[i]=<span class="built_in">E</span>(u,i,dist[u][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dp</span>(i,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) <span class="keyword">if</span>(!id[i]) <span class="built_in">dfs1</span>(i,++t);</span><br><span class="line">    <span class="type">int</span> res=<span class="built_in">kruskal</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=t;i++) mn[i].w=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">if</span>(dist[<span class="number">1</span>][i]&amp;&amp;dist[<span class="number">1</span>][i]&lt;mn[id[i]].w)</span><br><span class="line">            mn[id[i]]=<span class="built_in">E</span>(<span class="number">1</span>,i,dist[<span class="number">1</span>][i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[id[i]]) <span class="keyword">continue</span>;</span><br><span class="line">        st[<span class="number">1</span>][mn[id[i]].v]=st[mn[id[i]].v][<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">        res+=mn[id[i]].w;</span><br><span class="line">        vis[id[i]]=<span class="literal">true</span>;</span><br><span class="line">        k--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(k) &#123;</span><br><span class="line">        mx[<span class="number">1</span>].w=<span class="number">0xc0c0c0c0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(st[<span class="number">1</span>][i]) mx[i].w=<span class="number">0xc0c0c0c0</span>;</span><br><span class="line">            <span class="keyword">else</span> mx[i].w=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dp</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> temp=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(st[<span class="number">1</span>][i]||!dist[<span class="number">1</span>][i]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(dist[<span class="number">1</span>][i]-mx[i].w&lt;dist[<span class="number">1</span>][temp]-mx[temp].w) temp=i;</span><br><span class="line">        &#125;</span><br><span class="line">        st[<span class="number">1</span>][temp]=st[temp][<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">        st[mx[temp].u][mx[temp].v]=st[mx[temp].v][mx[temp].u]=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(dist[<span class="number">1</span>][temp]-mx[temp].w&gt;<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        res+=dist[<span class="number">1</span>][temp]-mx[temp].w;</span><br><span class="line">        k--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    mp[<span class="string">&quot;Park&quot;</span>]=++n;</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        string a,b;</span><br><span class="line">        <span class="type">int</span> w;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b&gt;&gt;w;</span><br><span class="line">        <span class="keyword">if</span>(!mp.<span class="built_in">count</span>(a)) mp[a]=++n;</span><br><span class="line">        <span class="keyword">if</span>(!mp.<span class="built_in">count</span>(b)) mp[b]=++n;</span><br><span class="line">        dist[mp[a]][mp[b]]=dist[mp[b]][mp[a]]=w;</span><br><span class="line">        e.<span class="built_in">push_back</span>(<span class="built_in">E</span>(mp[a],mp[b],w));</span><br><span class="line">    &#125;</span><br><span class="line">    cin&gt;&gt;k;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Total miles driven: &quot;</span>&lt;&lt;<span class="built_in">solve</span>()&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="瓶颈生成树"><a href="#瓶颈生成树" class="headerlink" title="瓶颈生成树"></a>瓶颈生成树</h3><p>定义：无向图 $G$ 的瓶颈生成树是这样的一个生成树，它的最大的边权值在 $G$ 的所有生成树中最小</p>
<p>性质：最小生成树是瓶颈生成树的充分不必要条件</p>
<h3 id="最小瓶颈路"><a href="#最小瓶颈路" class="headerlink" title="最小瓶颈路"></a>最小瓶颈路</h3><p>定义：无向图 $G$ 中 $x$ 到 $y$ 的最小瓶颈路是这样的一类简单路径，满足这条路径上的最大的边权在所有 $x$ 到 $y$ 的简单路径中是最小的</p>
<p>性质：根据最小生成树定义，$x$ 到 $y$ 的最小瓶颈路上的最大边权等于最小生成树上 $x$ 到 $y$ 路径上的最大边权。虽然最小生成树不唯一，但是每种最小生成树 $x$ 到 $y$ 路径的最大边权相同且为最小值。也就是说，每种最小生成树上的 $x$ 到 $y$ 的路径均为最小瓶颈路</p>
<ul>
<li>并不是所有最小瓶颈路都存在一棵最小生成树满足其为树上 $x$ 到 $y$ 的简单路径</li>
</ul>
<h2 id="最小树形图"><a href="#最小树形图" class="headerlink" title="最小树形图"></a>最小树形图</h2><ul>
<li>有向图最小生成树</li>
</ul>
<h3 id="朱刘算法"><a href="#朱刘算法" class="headerlink" title="朱刘算法"></a>朱刘算法</h3><ul>
<li>$O(nm)$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> in[N],st[N],id[N],pre[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">    <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w):<span class="built_in">u</span>(u),<span class="built_in">v</span>(v),<span class="built_in">w</span>(w) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;E&gt; e;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">edmonds</span><span class="params">(<span class="type">int</span> rt,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>,v,nn=n;</span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) in[i]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:e) <span class="keyword">if</span>(x.u!=x.v&amp;&amp;x.w&lt;in[x.v]) pre[x.v]=x.u,in[x.v]=x.w;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(i!=rt&amp;&amp;in[i]==<span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> tn=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=nn;i++) id[i]=st[i]=<span class="number">-1</span>;</span><br><span class="line">        in[rt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            ret+=in[v=i];</span><br><span class="line">            <span class="keyword">while</span>(st[v]!=i&amp;&amp;id[v]==<span class="number">-1</span>&amp;&amp;v!=rt) st[v]=i,v=pre[v];</span><br><span class="line">            <span class="keyword">if</span>(v!=rt&amp;&amp;id[v]==<span class="number">-1</span>) &#123;</span><br><span class="line">                ++tn;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> u=pre[v];u!=v;u=pre[u]) id[u]=tn;</span><br><span class="line">                id[v]=tn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!tn) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(id[i]==<span class="number">-1</span>) id[i]=++tn;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">SZ</span>(e);) &#123;</span><br><span class="line">            <span class="keyword">auto</span> &amp;x=e[i];</span><br><span class="line">            v=x.v;</span><br><span class="line">            x.u=id[x.u],x.v=id[x.v];</span><br><span class="line">            <span class="keyword">if</span>(x.u!=x.v) x.w-=in[v],++i;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">swap</span>(x,e.<span class="built_in">back</span>()),e.<span class="built_in">pop_back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        n=tn,rt=id[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="无定根最小树形图"><a href="#无定根最小树形图" class="headerlink" title="无定根最小树形图"></a>无定根最小树形图</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出编号最小的根</span></span><br><span class="line"><span class="type">int</span> in[N],st[N],id[N],pre[N],inn[N],sum,t;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> u,v,w,num;</span><br><span class="line">    <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> num):<span class="built_in">u</span>(u),<span class="built_in">v</span>(v),<span class="built_in">w</span>(w),<span class="built_in">num</span>(num) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;E&gt; e;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">edmonds</span><span class="params">(<span class="type">int</span> rt,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> v,nn=n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) in[i]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x.w&lt;in[x.v]) &#123;</span><br><span class="line">                pre[x.v]=x.u,in[x.v]=x.w;</span><br><span class="line">                inn[x.v]=x.u;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        t=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(inn[i]==rt) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:e) <span class="keyword">if</span>(x.u==rt&amp;&amp;x.v==i&amp;&amp;in[x.v]==x.w) t=<span class="built_in">min</span>(t,x.num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> tn=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=nn;i++) id[i]=st[i]=<span class="number">-1</span>;</span><br><span class="line">        in[rt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            ret+=in[v=i];</span><br><span class="line">            <span class="keyword">while</span>(st[v]!=i&amp;&amp;id[v]==<span class="number">-1</span>&amp;&amp;v!=rt) st[v]=i,v=pre[v];</span><br><span class="line">            <span class="keyword">if</span>(v!=rt&amp;&amp;id[v]==<span class="number">-1</span>) &#123;</span><br><span class="line">                ++tn;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> u=pre[v];u!=v;u=pre[u]) id[u]=tn;</span><br><span class="line">                id[v]=tn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!tn) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(id[i]==<span class="number">-1</span>) id[i]=++tn;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">SZ</span>(e);) &#123;</span><br><span class="line">            <span class="keyword">auto</span> &amp;x=e[i];</span><br><span class="line">            v=x.v;</span><br><span class="line">            x.u=id[x.u],x.v=id[x.v];</span><br><span class="line">            <span class="keyword">if</span>(x.u!=x.v) x.w-=in[v],++i;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">swap</span>(x,e.<span class="built_in">back</span>()),e.<span class="built_in">pop_back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        n=tn,rt=id[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> u,v,w;</span><br><span class="line">        cin&gt;&gt;u&gt;&gt;v&gt;&gt;w;</span><br><span class="line">        e.<span class="built_in">EB</span>(u,v,w,<span class="number">0</span>);</span><br><span class="line">        sum+=w;</span><br><span class="line">    &#125;</span><br><span class="line">    ++sum;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) e.<span class="built_in">EB</span>(n+<span class="number">1</span>,i,sum,i);</span><br><span class="line">    <span class="type">int</span> res=<span class="built_in">edmonds</span>(n+<span class="number">1</span>,n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(res==<span class="number">-1</span>||res&gt;=<span class="number">2</span>*sum) cout&lt;&lt;<span class="string">&quot;impossible&quot;</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> cout&lt;&lt;res-sum&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;t&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="欧拉图"><a href="#欧拉图" class="headerlink" title="欧拉图"></a>欧拉图</h2><p>通过图中所有边恰好一次且行遍所有顶点的通路称为欧拉通路</p>
<p>通过图中所有边恰好一次且行遍所有顶点的回路称为欧拉回路</p>
<p>具有欧拉回路的无向图称为欧拉图</p>
<p>具有欧拉通路但不具有欧拉回路的无向图称为半欧拉图</p>
<p><strong>性质</strong></p>
<p>欧拉图中所有顶点的度数都是偶数</p>
<p>若 $G$ 是欧拉图，则它为若干个边不重的圈的并</p>
<p>若 $G$ 是半欧拉图，则它为若干个边不重的圈和一条简单路径的并</p>
<p><strong>判别法</strong></p>
<p>对于无向图 $G$，$G$ 是欧拉图当且仅当 $G$ 是连通的且没有奇度顶点</p>
<p>对于无向图 $G$，$G$ 是半欧拉图当且仅当 $G$ 是连通的且 $G$ 中恰有 $0$ 个或 $2$ 个奇度顶点</p>
<p>对于有向图 $G$，$G$ 是欧拉图当且仅当 $G$ 的所有顶点属于同一个强连通分量且每个顶点的入度和出度相同</p>
<p>对于有向图 $G$，$G$ 是半欧拉图当且仅当</p>
<ul>
<li><p>如果将 $G$ 中的所有有向边退化为无向边时，那么 $G$ 的所有顶点属于同一个连通分量。</p>
</li>
<li><p>有一个顶点的出度与入度差为 $1$，有一个顶点的入度与出度差为 $1$，其他顶点的入度和出度相同或者所有顶点入度和出度相同。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cnt,nxt[M&lt;&lt;<span class="number">1</span>],to[M&lt;&lt;<span class="number">1</span>],head[N];</span><br><span class="line"><span class="type">int</span> top,stk[M&lt;&lt;<span class="number">1</span>],t,ans[M&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">bool</span> st[M&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) head[i]=<span class="number">0</span>;</span><br><span class="line">    top=t=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    nxt[++cnt]=head[u];</span><br><span class="line">    to[cnt]=v;</span><br><span class="line">    head[u]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">hierholzer</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    stk[++top]=s;</span><br><span class="line">    <span class="keyword">while</span>(top) &#123;</span><br><span class="line">        <span class="type">int</span> u=stk[top],i=head[u];</span><br><span class="line">        <span class="keyword">while</span>(i&amp;&amp;st[i]) i=nxt[i];</span><br><span class="line">        <span class="keyword">if</span>(i) &#123;</span><br><span class="line">            stk[++top]=to[i];</span><br><span class="line">            st[i]=st[i^<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">            head[u]=nxt[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> top--,ans[++t]=u; <span class="comment">// 倒序输出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于混合图 $G$，先将无向边随意规定一个方向，计算出各个顶点的入度和出度。</p>
<p>欧拉图：</p>
<p>如果将 $G$ 中的所有有向边退化为无向边时， $G$ 的所有顶点不属于同一个连通分量或者入度出度差是奇数的顶点个数不是 $0$ 个（对于无向边，无论方向如何，入度出度差奇偶性不变），则图 $G$ 不可能是欧拉图。</p>
<p>接下来可以用网络流确定无向边方向判断图 $G$ 是否是欧拉图。</p>
<p>建立起点 $s$ 和终点 $t$，将 $s$ 与出度大于入度的顶点与相连，出度小于入度的顶点与 $t$ 相连，容量为出度入度差的绝对值的 $\frac{1}{2}$，将之前定向的无向边之间建立一条容量为 $1$ 的边，当网络流中与起点相连的边都满流时存在欧拉图。</p>
<p>我们的目的是调整无向边的方向使所有点的出度等于入度，假设网络流中经过 $(a,b)$ 这条边，意味着 $(a,b)$ 需要改变方向，使 $a$ 的出度 $-1$，入度 $+1$ ，$b$ 的入度 $-1$，出度 $+1$，所以网络流中与起点相连的边都满流时存在欧拉图。</p>
<p>半欧拉图：</p>
<p>如果将 $G$ 中的所有有向边退化为无向边时， $G$ 的所有顶点不属于同一个连通分量或者入度出度差是奇数的顶点个数不是 $0$ 或 $2$ 个，则图 $G$ 不可能是半欧拉图。</p>
<p>将入度出度差是奇数的顶点之间加一条容量为 $1$ 的边，这样则所有顶点入度出度差都为偶数，这样只要判断是否是欧拉图即可。</p>
<h2 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,in[N];</span><br><span class="line">VI g[N];</span><br><span class="line">VI res; <span class="comment">// 排序后的结果</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">    in[v]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">topo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!in[i]) q.<span class="built_in">push</span>(i);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        res.<span class="built_in">PB</span>(u);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u])</span><br><span class="line">            <span class="keyword">if</span>(--in[v]==<span class="number">0</span>)</span><br><span class="line">                q.<span class="built_in">push</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">SZ</span>(res)==n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 如果res长度不等于结点个数说明存在环,无拓扑排序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="连通性"><a href="#连通性" class="headerlink" title="连通性"></a>连通性</h2><h3 id="边双连通分量"><a href="#边双连通分量" class="headerlink" title="边双连通分量"></a>边双连通分量</h3><ul>
<li>树形图至少添加 （叶子的数量（若树根只有一个儿子，树根也算叶子）$+1)&#x2F;2$ 条边使其变为边双连通图</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">VI G[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) G[i].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 割边</span></span><br><span class="line"><span class="type">int</span> cnt,dfn[N],low[N],fa[N];</span><br><span class="line"><span class="type">bool</span> isb[N];</span><br><span class="line">VI b;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++cnt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) &#123;</span><br><span class="line">            fa[v]=u;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">            <span class="keyword">if</span>(dfn[u]&lt;low[v]) isb[v]=<span class="literal">true</span>,b.<span class="built_in">PB</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v!=fa[u]) low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getBridge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">    b.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dfn[i]=low[i]=fa[i]=<span class="number">0</span>,isb[i]=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 边双连通分量</span></span><br><span class="line"><span class="type">int</span> dcc,c[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    c[u]=dcc;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(c[v]||u==fa[v]&amp;&amp;isb[v]||v==fa[u]&amp;&amp;isb[u]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    dcc=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!c[i]) ++dcc,<span class="built_in">dfs</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 缩点建图</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123; <span class="comment">// 将边双连通分量缩点与桥形成一棵树,原图不连通则形成森林</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=dcc;i++) g[i].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;b.<span class="built_in">size</span>();i++) &#123;</span><br><span class="line">        <span class="type">int</span> u=c[b[i]],v=c[fa[b[i]]];</span><br><span class="line">        g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">        g[v].<span class="built_in">PB</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点双连通分量"><a href="#点双连通分量" class="headerlink" title="点双连通分量"></a>点双连通分量</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">VI G[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) G[i].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 点双连通分量</span></span><br><span class="line"><span class="type">int</span> root,cnt,cntDcc,top,dfn[N],low[N],stk[N];</span><br><span class="line"><span class="type">bool</span> cut[N];</span><br><span class="line">VI dcc[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++cnt;</span><br><span class="line">    stk[++top]=u;</span><br><span class="line">    <span class="keyword">if</span>(u==root&amp;&amp;!G[u].<span class="built_in">size</span>()) &#123; <span class="comment">// 孤立点</span></span><br><span class="line">        dcc[++cntDcc].<span class="built_in">PB</span>(u);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">            <span class="keyword">if</span>(dfn[u]&lt;=low[v]) &#123;</span><br><span class="line">                flag++;</span><br><span class="line">                <span class="keyword">if</span>(u!=<span class="number">1</span>||flag&gt;<span class="number">1</span>) cut[u]=<span class="literal">true</span>;</span><br><span class="line">                ++cntDcc;</span><br><span class="line">                <span class="type">int</span> x;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    x=stk[top--];</span><br><span class="line">                    dcc[cntDcc].<span class="built_in">PB</span>(x);</span><br><span class="line">                &#125; <span class="keyword">while</span>(x!=v);</span><br><span class="line">                dcc[cntDcc].<span class="built_in">PB</span>(u);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cntDcc;i++) dcc[i].<span class="built_in">clear</span>();</span><br><span class="line">    cnt=cntDcc=top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dfn[i]=low[i]=<span class="number">0</span>,cut[i]=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!dfn[i]) root=i,<span class="built_in">tarjan</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 缩点建图</span></span><br><span class="line"><span class="type">int</span> num,id[N];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    num=cntDcc;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) id[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(cut[i]) id[i]=++num;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=num;i++) g[i].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cntDcc;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:dcc[i])</span><br><span class="line">            <span class="keyword">if</span>(id[x]) &#123;</span><br><span class="line">                g[id[x]].<span class="built_in">PB</span>(i);</span><br><span class="line">                g[i].<span class="built_in">PB</span>(id[x]);</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="强连通分量"><a href="#强连通分量" class="headerlink" title="强连通分量"></a>强连通分量</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">VI G[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) G[i].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 强连通分量</span></span><br><span class="line"><span class="type">int</span> cnt,dfn[N],low[N],top,stk[N],cntScc,c[N];</span><br><span class="line"><span class="type">bool</span> ins[N];</span><br><span class="line">VI scc[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++cnt;</span><br><span class="line">    stk[++top]=u;</span><br><span class="line">    ins[u]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ins[v]) low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[u]==low[u]) &#123;</span><br><span class="line">        ++cntScc;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            x=stk[top--];</span><br><span class="line">            ins[x]=<span class="literal">false</span>;</span><br><span class="line">            c[x]=cntScc;</span><br><span class="line">            scc[cntScc].<span class="built_in">PB</span>(x);</span><br><span class="line">        &#125; <span class="keyword">while</span>(u!=x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cntScc;i++) scc[i].<span class="built_in">clear</span>();</span><br><span class="line">    cnt=cntScc=top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dfn[i]=low[i]=c[i]=<span class="number">0</span>,ins[i]=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 缩点建图</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cntScc;i++) g[i].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="built_in">SZ</span>(G[i]);j++) &#123;</span><br><span class="line">            <span class="type">int</span> u=c[i],v=c[G[i][j]];</span><br><span class="line">            <span class="keyword">if</span>(u==v) <span class="keyword">continue</span>;</span><br><span class="line">            g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-SAT"><a href="#2-SAT" class="headerlink" title="2 - SAT"></a>2 - SAT</h2><p>给出 $n$ 个集合，每个集合有两个元素，已知若干个 $&lt;a,b&gt;$，表示 $a$ 与 $b$ 矛盾（其中 $a$ 与 $b$ 属于不同的集合）</p>
<p>然后从每个集合选择一个元素，判断能否一共选 $n$ 个两两不矛盾的元素</p>
<p>显然可能有多种选择方案，一般题中只需要求出一种即可</p>
<p>假设有两个集合 ${a,\neg a},{b,\neg b}$</p>
<p>若 $a$ 与 $b$ 矛盾，则选了 $a$ 就必须选 $\neg b$，选了 $b$ 就必须选 $\neg a$，按此关系建立有向边（原命题和逆否命题是成对出现的）</p>
<p>若选 $a$ 本身就是不合法的，那么在 $a$ 和 $\neg a$ 之间建立一条有向边，让它直接产生矛盾</p>
<ul>
<li>SCC 缩点</li>
</ul>
<p>若一个集合中的两个元素在同一个 SCC 中，无解</p>
<p>输出方案时可以通过变量在图中的反拓扑序确定该变量的取值</p>
<p>如果变量 $\neg x$ 的反拓扑序在 $x$ 之后，那么取 $x$ 值为真</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,cnt,cnt_scc,top,dfn[N],low[N],c[N],stk[N];</span><br><span class="line"><span class="type">int</span> in[N],val[N],opp[N];</span><br><span class="line"><span class="type">bool</span> ins[N];</span><br><span class="line">VI G[N],g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cnt=cnt_scc=top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*<span class="number">2</span>;i++) &#123;</span><br><span class="line">        G[i].<span class="built_in">clear</span>();</span><br><span class="line">        g[i].<span class="built_in">clear</span>();</span><br><span class="line">        dfn[i]=low[i]=c[i]=in[i]=val[i]=<span class="number">0</span>;</span><br><span class="line">        ins[i]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++cnt;</span><br><span class="line">    stk[++top]=u;</span><br><span class="line">    ins[u]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ins[v]) low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[u]==low[u]) &#123;</span><br><span class="line">        cnt_scc++;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            x=stk[top--];</span><br><span class="line">            ins[x]=<span class="literal">false</span>;</span><br><span class="line">            c[x]=cnt_scc;</span><br><span class="line">        &#125; <span class="keyword">while</span>(u!=x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rebuild</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*<span class="number">2</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:G[i]) &#123;</span><br><span class="line">            <span class="type">int</span> u=c[i],v=c[x];</span><br><span class="line">            <span class="keyword">if</span>(u==v) <span class="keyword">continue</span>;</span><br><span class="line">            in[u]++;</span><br><span class="line">            g[v].<span class="built_in">PB</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">topo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt_scc;i++) <span class="keyword">if</span>(!in[i]) q.<span class="built_in">push</span>(i);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(!val[u]) val[u]=<span class="number">1</span>,val[opp[u]]=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">            in[v]--;</span><br><span class="line">            <span class="keyword">if</span>(!in[v]) q.<span class="built_in">push</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*<span class="number">2</span>;i++) <span class="keyword">if</span>(!dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(c[i]==c[i+n]) &#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        opp[c[i]]=c[i+n],opp[c[i+n]]=c[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rebuild</span>();</span><br><span class="line">    <span class="built_in">topo</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,val[i]&lt;val[i+n]?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为 Tarjan 算法求强连通分量时使用了栈，所以 Tarjan 求得的 SCC 编号相当于反拓扑序，所在 SCC 编号在 $\neg x$ 之前时，取 $x$ 为真</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,c[i]&lt;c[i+n]?<span class="number">0</span>:<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>爆搜</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HDU 1814</span></span><br><span class="line"><span class="comment">// 按字典序输出方案</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">16005</span>;</span><br><span class="line"><span class="type">int</span> n,m,top,stk[N];</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    st[u]=<span class="literal">true</span>;</span><br><span class="line">    stk[++top]=u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(st[v^<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(st[v]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">dfs</span>(v)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m)) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n*<span class="number">2</span>;i++) g[i].<span class="built_in">clear</span>(),st[i]=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">            <span class="type">int</span> u,v;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;u,&amp;v);</span><br><span class="line">            u--,v--;</span><br><span class="line">            g[u].<span class="built_in">push_back</span>(v^<span class="number">1</span>);</span><br><span class="line">            g[v].<span class="built_in">push_back</span>(u^<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">bool</span> f=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n*<span class="number">2</span>;i+=<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(st[i]||st[i^<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">            top=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">dfs</span>(i)) &#123;</span><br><span class="line">                <span class="keyword">while</span>(top) st[stk[top--]]=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">dfs</span>(i^<span class="number">1</span>)) &#123;f=<span class="literal">true</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(f) <span class="built_in">puts</span>(<span class="string">&quot;NIE&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n*<span class="number">2</span>;i++) <span class="keyword">if</span>(st[i]) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重链剖分"><a href="#重链剖分" class="headerlink" title="重链剖分"></a>重链剖分</h2><ul>
<li><p>所有重链长度和等于节点数。</p>
</li>
<li><p>一个点到另一个点经过的轻链最多有 $\log_2{n}$ 条。</p>
</li>
<li><p>一个点到另一个点经过的重链最多有 $\log_2{n}$ 条。</p>
</li>
<li><p>每条链的 DFS 序是连续的。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cnt,sz[N],dep[N],fa[N],top[N],son[N],dfn[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dep[u]=dep[fa[u]]+<span class="number">1</span>;</span><br><span class="line">    sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa[u]) &#123;</span><br><span class="line">        fa[v]=u;</span><br><span class="line">        <span class="built_in">dfs1</span>(v);</span><br><span class="line">        sz[u]+=sz[v];</span><br><span class="line">        <span class="keyword">if</span>(sz[v]&gt;sz[son[u]]) son[u]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    top[u]=t;</span><br><span class="line">    dfn[u]=++cnt;</span><br><span class="line">    <span class="keyword">if</span>(son[u]) <span class="built_in">dfs2</span>(son[u],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(!top[v]) &#123;</span><br><span class="line">        <span class="built_in">dfs2</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="树分治"><a href="#树分治" class="headerlink" title="树分治"></a>树分治</h2><h3 id="点分治"><a href="#点分治" class="headerlink" title="点分治"></a>点分治</h3><blockquote>
<p> <a target="_blank" rel="noopener" href="https://codeforces.com/contest/161/problem/D">CF 161D</a>：节点对 $(u,v)$ 和节点对 $(v,u)$ 被认为是相同的节点对，求树上距离恰好为 $k$ 的不同节点对的数量。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,k,rt,cnt,sz[N],mx[N],dist[N],a[N],tot[N];</span><br><span class="line">LL res;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_rt</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa,<span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">    sz[u]=<span class="number">1</span>;</span><br><span class="line">    mx[u]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa&amp;&amp;!st[v]) &#123;</span><br><span class="line">        <span class="built_in">get_rt</span>(v,u,sum);</span><br><span class="line">        sz[u]+=sz[v];</span><br><span class="line">        mx[u]=<span class="built_in">max</span>(mx[u],sz[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    mx[u]=<span class="built_in">max</span>(mx[u],sum-sz[u]);</span><br><span class="line">    <span class="keyword">if</span>(mx[u]&lt;mx[rt]) rt=u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_dist</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dist[u]&gt;k) <span class="keyword">return</span>;</span><br><span class="line">    a[++cnt]=dist[u];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa&amp;&amp;!st[v]) &#123;</span><br><span class="line">        dist[v]=dist[u]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">get_dist</span>(v,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">calc</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    dist[u]=t;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">get_dist</span>(u,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=k;i++) tot[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) ++tot[a[i]];</span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">        --tot[a[i]];</span><br><span class="line">        ret+=tot[k-a[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">divide</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    mx[rt=<span class="number">0</span>]=INT_MAX;</span><br><span class="line">    <span class="built_in">get_rt</span>(u,<span class="number">0</span>,sz[u]);</span><br><span class="line">    st[u=rt]=<span class="literal">true</span>;</span><br><span class="line">    res+=<span class="built_in">calc</span>(u,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(!st[v]) &#123;</span><br><span class="line">        res-=<span class="built_in">calc</span>(v,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">divide</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="type">int</span> u,v;cin&gt;&gt;u&gt;&gt;v;</span><br><span class="line">        g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">        g[v].<span class="built_in">PB</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    sz[<span class="number">1</span>]=n;<span class="built_in">divide</span>(<span class="number">1</span>);</span><br><span class="line">    cout&lt;&lt;res&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="树上启发式合并"><a href="#树上启发式合并" class="headerlink" title="树上启发式合并"></a>树上启发式合并</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/600/problem/E">CF 600E</a>：一棵树有 $n$ 个结点，每个结点都是一种颜色，每个颜色有一个编号，求树中每个子树的最多的颜色编号的和。</p>
</blockquote>
<p>用 $cnt_i$ 表示颜色 $i$ 的出现次数。</p>
<p>遍历一个节点 $u$，我们按以下的步骤进行遍历：</p>
<ul>
<li>先遍历 $u$ 的轻（非重）儿子，并计算答案，但不保留遍历后它对 $cnt$ 数组的影响；</li>
<li>遍历它的重儿子，保留它对 $cnt$ 数组的影响；</li>
<li>再次遍历 $u$ 的轻儿子的子树结点，加入这些结点的贡献，以得到 $u$ 的答案。</li>
</ul>
<p>时间复杂度：$O(n\log(n))$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">VI g[N];</span><br><span class="line"><span class="type">int</span> w[N],sz[N],son[N],cnt[N],mx,sn;</span><br><span class="line">LL sum,res[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa) &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(v,u);</span><br><span class="line">        sz[u]+=sz[v];</span><br><span class="line">        <span class="keyword">if</span>(sz[v]&gt;sz[son[u]]) son[u]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa,<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">    cnt[w[u]]+=val;</span><br><span class="line">    <span class="keyword">if</span>(cnt[w[u]]&gt;mx) mx=cnt[w[u]],sum=w[u];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt[w[u]]==mx) sum+=w[u];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa&amp;&amp;v!=sn) &#123;</span><br><span class="line">        <span class="built_in">update</span>(v,u,val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dsu</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa,<span class="type">bool</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=fa&amp;&amp;v!=son[u]) &#123;</span><br><span class="line">        <span class="built_in">dsu</span>(v,u,<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u]) <span class="built_in">dsu</span>(son[u],u,<span class="literal">false</span>),sn=son[u];</span><br><span class="line">    <span class="built_in">update</span>(u,fa,<span class="number">1</span>);</span><br><span class="line">    res[u]=sum;</span><br><span class="line">    sn=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(op) <span class="built_in">update</span>(u,fa,<span class="number">-1</span>),mx=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) cin&gt;&gt;w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="type">int</span> u,v;</span><br><span class="line">        cin&gt;&gt;u&gt;&gt;v;</span><br><span class="line">        g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">        g[v].<span class="built_in">PB</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dsu</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) cout&lt;&lt;res[i]&lt;&lt;<span class="string">&quot; \n&quot;</span>[i==n];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h2><h3 id="重链剖分算法"><a href="#重链剖分算法" class="headerlink" title="重链剖分算法"></a>重链剖分算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fa[N],dep[N],fa[N],son[N],top[N];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dep[u]=dep[fa[u]]+<span class="number">1</span>;</span><br><span class="line">    sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(v==fa[u]) <span class="keyword">continue</span>;</span><br><span class="line">        fa[v]=u;</span><br><span class="line">        <span class="built_in">dfs1</span>(v);</span><br><span class="line">        sz[u]+=sz[v];</span><br><span class="line">        <span class="keyword">if</span>(sz[v]&gt;sz[son[u]]) son[u]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    top[u]=t;</span><br><span class="line">    <span class="keyword">if</span>(son[u]) <span class="built_in">dfs2</span>(son[u],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(v==son[u]||v==fa[u]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(top[a]!=top[b]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[a]]&gt;dep[top[b]])  a=fa[top[a]];</span><br><span class="line">        <span class="keyword">else</span> b=fa[top[b]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[a]&lt;dep[b]?a:b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="树上倍增算法"><a href="#树上倍增算法" class="headerlink" title="树上倍增算法"></a>树上倍增算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dep[N],f[N][<span class="number">20</span>];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dep[u]=dep[f[u][<span class="number">0</span>]]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) <span class="keyword">if</span>(v!=f[u][<span class="number">0</span>]) &#123;</span><br><span class="line">        f[v][<span class="number">0</span>]=u;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=LIM;i++) f[v][i]=f[f[v][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[a]&gt;dep[b]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=LIM;~i;i--) <span class="keyword">if</span>(dep[f[b][i]]&gt;=dep[a]) b=f[b][i];</span><br><span class="line">    <span class="keyword">if</span>(a==b) <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=LIM;~i;i--) <span class="keyword">if</span>(f[a][i]!=f[b][i]) a=f[a][i],b=f[b][i];</span><br><span class="line">    <span class="keyword">return</span> f[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="树上-Tarjan-算法"><a href="#树上-Tarjan-算法" class="headerlink" title="树上 Tarjan 算法"></a>树上 Tarjan 算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_query</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    query[a].<span class="built_in">EB</span>(b,id);</span><br><span class="line">    query[b].<span class="built_in">EB</span>(a,id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fa[x]==x) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> fa[x]=<span class="built_in">get</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    st[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(st[v]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">tarjan</span>(v);</span><br><span class="line">        fa[v]=u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">SZ</span>(query[u]);i++) &#123;</span><br><span class="line">        <span class="type">int</span> v=query[u][i].FI,id=query[u][i].SE;</span><br><span class="line">        <span class="keyword">if</span>(st[v]==<span class="number">2</span>) ans[id]=<span class="built_in">get</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">    st[u]=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h2><h3 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h3><ul>
<li>最大流最小割定理：网络流图中，最大流的值等于最小割的容量</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MAXIMUM_FLOW</span> &#123;</span><br><span class="line">    <span class="type">int</span> n,s,t,d[N],cur[N];</span><br><span class="line">    VI g[N];</span><br><span class="line">    VPII e;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) g[i].<span class="built_in">clear</span>();</span><br><span class="line">        e.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">        e.<span class="built_in">EB</span>(v,c);</span><br><span class="line">        e.<span class="built_in">EB</span>(u,<span class="number">0</span>);</span><br><span class="line">        g[u].<span class="built_in">PB</span>(<span class="built_in">SZ</span>(e)<span class="number">-2</span>);</span><br><span class="line">        g[v].<span class="built_in">PB</span>(<span class="built_in">SZ</span>(e)<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) d[i]=<span class="number">0</span>;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(s);</span><br><span class="line">        d[s]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">            <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:g[u]) &#123;</span><br><span class="line">                <span class="type">int</span> v=e[x].FI,c=e[x].SE;</span><br><span class="line">                <span class="keyword">if</span>(d[v]||c&lt;=<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                d[v]=d[u]+<span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d[t];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(u==t) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="type">int</span> f,flow=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> &amp;i=cur[u];i&lt;<span class="built_in">SZ</span>(g[u]);i++) &#123;</span><br><span class="line">            <span class="type">int</span> v=e[g[u][i]].FI,&amp;c=e[g[u][i]].SE;</span><br><span class="line">            <span class="keyword">if</span>(d[v]!=d[u]+<span class="number">1</span>||c&lt;=<span class="number">0</span>||(f=<span class="built_in">dfs</span>(v,<span class="built_in">min</span>(a,c)))&lt;=<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            c-=f;</span><br><span class="line">            e[g[u][i]^<span class="number">1</span>].SE+=f;</span><br><span class="line">            a-=f;</span><br><span class="line">            flow+=f;</span><br><span class="line">            <span class="keyword">if</span>(a==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">bfs</span>()) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) cur[i]=<span class="number">0</span>;</span><br><span class="line">            flow+=<span class="built_in">dfs</span>(s,INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mf;</span><br></pre></td></tr></table></figure>

<h3 id="最小费用最大流"><a href="#最小费用最大流" class="headerlink" title="最小费用最大流"></a>最小费用最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> dist[N],h[N],preu[N],pree[M];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">    <span class="type">int</span> v,c,w;</span><br><span class="line">    <span class="built_in">E</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">E</span>(<span class="type">int</span> v,<span class="type">int</span> c,<span class="type">int</span> w):<span class="built_in">v</span>(v),<span class="built_in">c</span>(c),<span class="built_in">w</span>(w)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;E&gt; e;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        h[i]=<span class="number">0</span>;</span><br><span class="line">        g[i].<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    e.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c,<span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    e.<span class="built_in">EB</span>(v,c,w);</span><br><span class="line">    e.<span class="built_in">EB</span>(u,<span class="number">0</span>,-w);</span><br><span class="line">    g[u].<span class="built_in">PB</span>(<span class="built_in">SZ</span>(e)<span class="number">-2</span>);</span><br><span class="line">    g[v].<span class="built_in">PB</span>(<span class="built_in">SZ</span>(e)<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dijkstra</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> s,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dist[i]=INF;</span><br><span class="line">    priority_queue&lt;PII,VPII,greater&lt;PII&gt;&gt; q;</span><br><span class="line">    dist[s]=<span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">emplace</span>(<span class="number">0</span>,s);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> d=q.<span class="built_in">top</span>().FI,u=q.<span class="built_in">top</span>().SE;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(dist[u]!=d) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:g[u]) &#123;</span><br><span class="line">            <span class="type">int</span> v=e[x].v,c=e[x].c,w=e[x].w;</span><br><span class="line">            <span class="keyword">if</span>(c&gt;<span class="number">0</span>&amp;&amp;dist[v]&gt;dist[u]-h[v]+w+h[u]) &#123;</span><br><span class="line">                dist[v]=dist[u]-h[v]+w+h[u];</span><br><span class="line">                preu[v]=u;</span><br><span class="line">                pree[v]=x;</span><br><span class="line">                q.<span class="built_in">emplace</span>(dist[v],v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist[t]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">PII <span class="title">mcmf</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> s,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">dijkstra</span>(n,s,t)) &#123;</span><br><span class="line">        <span class="type">int</span> c=INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) h[i]=<span class="built_in">min</span>(INF,h[i]+dist[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> u=t;u!=s;u=preu[u]) c=<span class="built_in">min</span>(c,e[pree[u]].c);</span><br><span class="line">        flow+=c;</span><br><span class="line">        cost+=c*h[t];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> u=t;u!=s;u=preu[u]) &#123;</span><br><span class="line">            e[pree[u]].c-=c;</span><br><span class="line">            e[pree[u]^<span class="number">1</span>].c+=c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">MP</span>(flow,cost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二分图最大匹配"><a href="#二分图最大匹配" class="headerlink" title="二分图最大匹配"></a>二分图最大匹配</h2><ul>
<li>定理：一张无向图是二分图当且仅当图中不存在奇环。</li>
</ul>
<h3 id="匈牙利算法"><a href="#匈牙利算法" class="headerlink" title="匈牙利算法"></a>匈牙利算法</h3><p>时间复杂度：$O(n^2)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,match[N];</span><br><span class="line"><span class="type">bool</span> m[N][N],st[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> v=<span class="number">1</span>;v&lt;=n;v++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!m[u][v]||st[v]) <span class="keyword">continue</span>;</span><br><span class="line">        st[v]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(match[v]==<span class="number">-1</span>||<span class="built_in">dfs</span>(match[v])) &#123;</span><br><span class="line">            match[v]=u;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">hungary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) match[i]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) st[j]=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">dfs</span>(i)) res++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HK-算法"><a href="#HK-算法" class="headerlink" title="HK 算法"></a>HK 算法</h3><ul>
<li>时间复杂度：$O(\sqrt{n}m)$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,match[N&lt;&lt;<span class="number">1</span>],dep[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">VI g[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n+m;i++) dep[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(match[i]==<span class="number">-1</span>) dep[i]=<span class="number">1</span>,q.<span class="built_in">push</span>(i);</span><br><span class="line">    <span class="type">bool</span> f=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(dep[v]) <span class="keyword">continue</span>;</span><br><span class="line">            dep[v]=dep[u]+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(match[v]==<span class="number">-1</span>) f=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> dep[match[v]]=dep[v]+<span class="number">1</span>,q.<span class="built_in">push</span>(match[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[v]!=dep[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        dep[v]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(match[v]==<span class="number">-1</span>||<span class="built_in">dfs</span>(match[v])) &#123;</span><br><span class="line">            match[v]=u;</span><br><span class="line">            match[u]=v;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">HK</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n+m;i++) match[i]=<span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>()) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(match[i]==<span class="number">-1</span>&amp;&amp;<span class="built_in">dfs</span>(i)) res++;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二分图最小点覆盖"><a href="#二分图最小点覆盖" class="headerlink" title="二分图最小点覆盖"></a>二分图最小点覆盖</h3><p>图的最小点覆盖就是求出一个最小点集 $S$，使得图中任意一条边都有至少一个端点属于 $S$</p>
<ul>
<li>Konig 定理：二分图最小点覆盖包含的点数等于二分图最大匹配包含的边数</li>
</ul>
<h3 id="二分图最大独立集"><a href="#二分图最大独立集" class="headerlink" title="二分图最大独立集"></a>二分图最大独立集</h3><p>图的最大独立集就是“任意两点之间都没有边相连”的最大点集</p>
<ul>
<li>定理：二分图中，最大独立集 &#x3D; $n$ - 最小点覆盖</li>
</ul>
<p>对应地，“任意两点之间都有一条边相连“的子图被称为无向图的“团”，点数最多的团被称为图的最大团</p>
<ul>
<li>定理：无向图 $G$ 的最大团等于其补图 $G’$ 的最大独立集</li>
</ul>
<h3 id="有向无环图的最小不相交路径覆盖"><a href="#有向无环图的最小不相交路径覆盖" class="headerlink" title="有向无环图的最小不相交路径覆盖"></a>有向无环图的最小不相交路径覆盖</h3><ul>
<li>有向无环图 $G$ 的最小不相交路径覆盖包含的路径条数 $&#x3D;$ 点数 $-$ 拆点二分图 $G_2$ 的最大匹配数</li>
</ul>
<h3 id="有向无环图的最小可相交路径覆盖"><a href="#有向无环图的最小可相交路径覆盖" class="headerlink" title="有向无环图的最小可相交路径覆盖"></a>有向无环图的最小可相交路径覆盖</h3><ul>
<li>有向无环图 $G$ 的最小可相交路径覆盖等价于先对有向图传递闭包，得到有向无环图 $G’$，再在 $G’$ 上求最小不相交路径覆盖</li>
</ul>
<h3 id="无向图的最小路径覆盖"><a href="#无向图的最小路径覆盖" class="headerlink" title="无向图的最小路径覆盖"></a>无向图的最小路径覆盖</h3><ul>
<li>无向图 $G$ 的最小路径覆盖包含的路径条数 $&#x3D;$ 点数 $-$ 拆点二分图 $G_2$ 的最大匹配数 $&#x2F;2$</li>
</ul>
<h2 id="二分图最大权匹配"><a href="#二分图最大权匹配" class="headerlink" title="二分图最大权匹配"></a>二分图最大权匹配</h2><h3 id="KM-算法"><a href="#KM-算法" class="headerlink" title="KM 算法"></a>KM 算法</h3><p>KM 算法只能在满足带权最大匹配一定是完美匹配的图中求解。</p>
<p>两边点数不同，需增加虚点让两边点数相同，虚点与另一边的所有点相连构成虚边。</p>
<p>若题目允许不完美匹配，虚边边权设为 $0$，否则为 $-\infty$。</p>
<p>注意根据题意考虑邻接矩阵初始值是 $0$ 还是 $-\infty$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> w[N][N],la[N],lb[N],ma[N],mb[N],vb[N],slk[N],pre[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">km</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        la[i]=<span class="number">0xc0c0c0c0</span>;</span><br><span class="line">        lb[i]=ma[i]=mb[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) la[i]=<span class="built_in">max</span>(la[i],w[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=n;j++) vb[j]=pre[j]=<span class="number">0</span>,slk[j]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="type">int</span> b=<span class="number">0</span>,p=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(mb[b]=i;mb[b];b=p) &#123;</span><br><span class="line">            <span class="type">int</span> d=<span class="number">0x3f3f3f3f</span>,a=mb[b];</span><br><span class="line">            vb[b]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">                <span class="keyword">if</span>(!vb[j]) &#123;</span><br><span class="line">                    <span class="type">int</span> t=la[a]+lb[j]-w[a][j];</span><br><span class="line">                    <span class="keyword">if</span>(t&lt;slk[j]) slk[j]=t,pre[j]=b;</span><br><span class="line">                    <span class="keyword">if</span>(slk[j]&lt;d) d=slk[j],p=j;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=n;j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(vb[j]) la[mb[j]]-=d,lb[j]+=d;</span><br><span class="line">                <span class="keyword">else</span> slk[j]-=d;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(;b;b=pre[b]) mb[b]=mb[pre[b]],ma[mb[b]]=b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) res+=w[i][ma[i]];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">    <span class="comment">// nn 为二分图左边集合大小，不存在完美匹配返回 -1</span></span><br><span class="line">    <span class="comment">// int res=0,cnt=0;</span></span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=nn;i++) &#123;</span></span><br><span class="line">    <span class="comment">//     if(ma[i]&amp;&amp;w[i][ma[i]]!=0xc0c0c0c0) &#123;</span></span><br><span class="line">    <span class="comment">//         ++cnt;</span></span><br><span class="line">    <span class="comment">//         res+=w[i][ma[i]];</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// return cnt==nn?res:-1;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>HDU 2853</li>
</ul>
<blockquote>
<p>二分图两边集合大小为 $n,m$，给定匹配边，改变最少的匹配边使二分图权值匹配最大。</p>
</blockquote>
<p>将权值扩大 $k$ $(k&gt;n)$ 倍，再将原匹配边权值 $+1$，跑 KM 算法，新二分图最大权值匹配 $&#x2F;k$ 为原二分图最大权值匹配，最少改变的匹配边为 $n-$ 新二分图最大权值匹配 $%k$。</p>
<h2 id="一般图最大匹配"><a href="#一般图最大匹配" class="headerlink" title="一般图最大匹配"></a>一般图最大匹配</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,cnt,fa[N],vis[N],pre[N],dfn[N],match[N];</span><br><span class="line">VI g[N];</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) g[i].<span class="built_in">clear</span>(),match[i]=dfn[i]=<span class="number">0</span>;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    g[u].<span class="built_in">PB</span>(v);</span><br><span class="line">    g[v].<span class="built_in">PB</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x==fa[x]?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    u=<span class="built_in">find</span>(u),v=<span class="built_in">find</span>(v);</span><br><span class="line">    <span class="keyword">while</span>(dfn[u]!=cnt) &#123;</span><br><span class="line">        dfn[u]=cnt;</span><br><span class="line">        u=<span class="built_in">find</span>(pre[match[u]]);</span><br><span class="line">        <span class="keyword">if</span>(v) <span class="built_in">swap</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">blossom</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> lca)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">find</span>(u)!=lca) &#123;</span><br><span class="line">        pre[u]=v;</span><br><span class="line">        v=match[u];</span><br><span class="line">        <span class="keyword">if</span>(vis[v]==<span class="number">2</span>) vis[v]=<span class="number">1</span>,q.<span class="built_in">push</span>(v);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(u)==u) fa[u]=lca;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(v)==v) fa[v]=lca;</span><br><span class="line">        u=pre[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">aug</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) fa[i]=i,vis[i]=pre[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) q.<span class="built_in">pop</span>();</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    vis[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SZ</span>(q)) &#123;</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> v:g[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">find</span>(u)==<span class="built_in">find</span>(v)||vis[v]==<span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(!vis[v]) &#123;</span><br><span class="line">                vis[v]=<span class="number">2</span>,pre[v]=u;</span><br><span class="line">                <span class="keyword">if</span>(!match[v]) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> x=v,lst;x;x=lst) &#123;</span><br><span class="line">                        lst=match[pre[x]];</span><br><span class="line">                        match[x]=pre[x];</span><br><span class="line">                        match[pre[x]]=x;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                vis[match[v]]=<span class="number">1</span>,q.<span class="built_in">push</span>(match[v]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> lca=<span class="built_in">LCA</span>(u,v);</span><br><span class="line">                <span class="built_in">blossom</span>(u,v,lca);</span><br><span class="line">                <span class="built_in">blossom</span>(v,u,lca);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">edmonds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(!match[i]) res+=<span class="built_in">aug</span>(i);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h1><h2 id="龟速乘"><a href="#龟速乘" class="headerlink" title="龟速乘"></a>龟速乘</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">qmul</span><span class="params">(LL a,LL b,LL m)</span> </span>&#123; <span class="comment">// b &gt;= 0</span></span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=(ret+a)%m;</span><br><span class="line">        a=(a+a)%m;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">qpow</span><span class="params">(LL a,LL b,LL m)</span> </span>&#123;</span><br><span class="line">    LL ret=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=ret*a%m;</span><br><span class="line">        a=a*a%m;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>防爆 LL</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：龟速乘</span></span><br><span class="line"><span class="function">LL <span class="title">qpow</span><span class="params">(LL a,LL b,LL m)</span> </span>&#123;</span><br><span class="line">    LL ret=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=<span class="built_in">qmul</span>(ret,a,m);</span><br><span class="line">        a=<span class="built_in">qmul</span>(a,a,m);</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Miller-Rabin-素性测试"><a href="#Miller-Rabin-素性测试" class="headerlink" title="Miller-Rabin 素性测试"></a>Miller-Rabin 素性测试</h2><ul>
<li>二次探测定理：如果 $p$ 是奇素数，则 $x^2\equiv 1\pmod p$ 的解为 $x\equiv 1 \pmod p$ 或者 $x\equiv p-1 \pmod p$</li>
<li>int 范围内只需检查 $2, 7, 61$</li>
<li>long long 范围内 $2, 325, 9375, 28178, 450775, 9780504, 1795265022$</li>
<li>$3e15$ 内 $2, 2570940, 880937, 610386380, 4130785767$</li>
<li>$4e13$ 内 $2, 2570940, 211991001, 3749873356$</li>
<li><a target="_blank" rel="noopener" href="http://miller-rabin.appspot.com/">http://miller-rabin.appspot.com</a></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：龟速乘、快速幂</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(LL a,LL n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>||!(n&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    LL d=n<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!(d&amp;<span class="number">1</span>)) d&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    LL t=<span class="built_in">qpow</span>(a,d,n);</span><br><span class="line">    <span class="keyword">while</span>(d!=n<span class="number">-1</span>&amp;&amp;t!=<span class="number">1</span>&amp;&amp;t!=n<span class="number">-1</span>) &#123;</span><br><span class="line">        t=<span class="built_in">qmul</span>(t,t,n);</span><br><span class="line">        d&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t==n<span class="number">-1</span>||d&amp;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">miller_rabin</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> vector&lt;LL&gt; P=&#123;<span class="number">2</span>,<span class="number">325</span>,<span class="number">9375</span>,<span class="number">28178</span>,<span class="number">450775</span>,<span class="number">9780504</span>,<span class="number">1795265022</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(LL x:P) &#123;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;n) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">check</span>(x,n)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Pollard-Rho-因式分解"><a href="#Pollard-Rho-因式分解" class="headerlink" title="Pollard-Rho 因式分解"></a>Pollard-Rho 因式分解</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：Miller-Rabin 素性测试</span></span><br><span class="line"><span class="function">mt19937 <span class="title">mt</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">LL <span class="title">pollard_rho</span><span class="params">(LL n,LL c)</span> </span>&#123;</span><br><span class="line">    LL x=<span class="built_in">uniform_int_distribution</span>&lt;LL&gt;(<span class="number">1</span>,n<span class="number">-1</span>)(mt),y=x;</span><br><span class="line">    <span class="keyword">auto</span> f=[&amp;](LL v) &#123;</span><br><span class="line">        LL t=<span class="built_in">qmul</span>(v,v,n)+c;</span><br><span class="line">        <span class="keyword">return</span> t&lt;n?t:t-n;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        x=<span class="built_in">f</span>(x),y=<span class="built_in">f</span>(<span class="built_in">f</span>(y));</span><br><span class="line">        <span class="keyword">if</span>(x==y) <span class="keyword">return</span> n;</span><br><span class="line">        LL d=__gcd(<span class="built_in">abs</span>(x-y),n);</span><br><span class="line">        <span class="keyword">if</span>(d!=<span class="number">1</span>) <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">VI fac; <span class="comment">// 无序，有重复质因数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_fac</span><span class="params">(LL n,LL cc=<span class="number">19260817</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">4</span>) &#123;fac.<span class="built_in">PB</span>(<span class="number">2</span>),fac.<span class="built_in">PB</span>(<span class="number">2</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">miller_rabin</span>(n)) &#123;fac.<span class="built_in">PB</span>(n);<span class="keyword">return</span>;&#125;</span><br><span class="line">    LL p=n;</span><br><span class="line">    <span class="keyword">while</span>(p==n) p=<span class="built_in">pollard_rho</span>(n,--cc);</span><br><span class="line">    <span class="built_in">get_fac</span>(p),<span class="built_in">get_fac</span>(n/p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">go_fac</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    fac.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">get_fac</span>(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="积性函数"><a href="#积性函数" class="headerlink" title="积性函数"></a>积性函数</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>若函数 $f(n)$ 满足 $f(1)&#x3D;1$ 且 $\forall x,y \in \mathbb{N}^+,\gcd(x,y)&#x3D;1$ 都有 $f(xy)&#x3D;f(x)f(y)$，则 $f(n)$ 为积性函数。</p>
<p>若函数 $f(n)$ 满足 $f(1)&#x3D;1$ 且 $\forall x,y \in \mathbb{N}^+$ 都有 $f(xy)&#x3D;f(x)f(y)$，则 $f(n)$ 为完全积性函数。</p>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><p>若 $f(x)$ 和 $g(x)$ 均为积性函数，则以下函数也为积性函数：</p>
<ul>
<li>$h(x)&#x3D;f(x^p)$</li>
<li>$h(x)&#x3D;f^p(x)$</li>
<li>$h(x)&#x3D;f(x)g(x)$</li>
<li>$h(x)&#x3D;\sum_{d \mid x}f(x)g(\frac{x}{d})$</li>
</ul>
<p>设 $x&#x3D;\prod p_i^{k_i}$，</p>
<ul>
<li>若 $F(x)$ 为积性函数，则有 $F(x)&#x3D;\prod F(p_i^{k_i})$。</li>
<li>若 $F(x)$ 为完全积性函数，则有 $F(x)&#x3D;\prod F(p_i)^{k_i}$。</li>
</ul>
<h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p><strong>定理 1.1：</strong></p>
<p>如果 $f$ 是积性函数，那么 $F(n)&#x3D;\sum_{d\mid n}f(d)$ 也是积性函数。</p>
<p><strong>证明：</strong></p>
<p>当 $\gcd(n,m)&#x3D;1$ 时，$nm$ 的因子必能写成 $n$ 的因子 $d_1$ 与 $m$ 的因子 $d_2$ 之积，</p>
<p>所以 $F(nm)&#x3D;\sum_{i\mid n}\sum_{j\mid m}f(ij)&#x3D;\sum_{i\mid n}f(i)\sum_{j\mid m}f(j)&#x3D;F(n)F(m)$。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><ul>
<li>单位函数：$\varepsilon(n)&#x3D;[n&#x3D;1]$（完全积性）</li>
<li>恒等函数：$\operatorname{id}_k(n)&#x3D;n^k$，$\operatorname{id}_1(n)$ 通常简记作 $\operatorname{id}(n)$（完全积性）</li>
<li>常数函数：$1(n)&#x3D;1$（完全积性）</li>
<li>除数函数：$\sigma_{k}(n)&#x3D;\sum_{d\mid n}d^k$，$\sigma_{0}(n)$ 通常简记为 $\operatorname{d}(n)$ 或 $\tau(n)$，$\sigma_{1}(n)$ 通常简记为 $\sigma(n)$</li>
<li>欧拉函数：$\varphi(n)&#x3D;\sum_{i&#x3D;1}^n[\gcd(i,n)&#x3D;1]$</li>
<li>莫比乌斯函数：$\mu(n)&#x3D;\begin{cases}<br>1 &amp; n&#x3D;1 \<br>0 &amp; \exists d&gt;1,d^2\mid n \<br>(-1)^k &amp; k;为;n;的不同质因子个数<br>\end{cases}$</li>
</ul>
<h3 id="Dirichlet-卷积"><a href="#Dirichlet-卷积" class="headerlink" title="Dirichlet 卷积"></a>Dirichlet 卷积</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><p>对于两个数论函数 $f(x)$ 和 $g(x)$，则它们的 Dirichlet 卷积得到的结果 $h(x)$ 定义为：</p>
<p>$$h(x)&#x3D;\sum_{d\mid x}f(d)g(x&#x2F;d)&#x3D;\sum_{ab&#x3D;x}f(a)g(b)$$</p>
<p>简记为：$h&#x3D;f*g$。</p>
<h4 id="性质-1"><a href="#性质-1" class="headerlink" title="性质"></a>性质</h4><ul>
<li>交换律：$f<em>g&#x3D;g</em>f$。</li>
<li>结合律：$(f<em>g)<em>h&#x3D;f</em>(g</em>h)$。</li>
<li>分配律：$(f+g)<em>h&#x3D;f</em>h+g*h$。</li>
<li>等式的性质：$f&#x3D;g$ 的充要条件是 $f<em>g&#x3D;g</em>h$，其中数论函数 $h(x)$ 要满足 $h(1)\neq 0$。</li>
<li>单位元：单位函数 $\varepsilon$ 是 Dirichlet 卷积运算中的单位元，即对于任何数论函数 $f$，都有 $f*\varepsilon&#x3D;f$。</li>
</ul>
<h4 id="定理-1"><a href="#定理-1" class="headerlink" title="定理"></a>定理</h4><p><strong>定理 2.1：</strong></p>
<p>两个积性函数的 Dirichlet 卷积也是积性函数。</p>
<p><strong>证明：</strong></p>
<p>设两个积性函数为 $f(x)$ 和 $g(x)$，再记 $h&#x3D;f*g$。</p>
<p>设 $\gcd(a,b)&#x3D;1$，则 $h(a)&#x3D;\sum_{d_1\mid a}f(a)g(a&#x2F;d_1),h(b)&#x3D;\sum_{d_2\mid b}f(b)g(b&#x2F;d_2)$，</p>
<p>所以 $h(a)h(b)&#x3D;\sum_{d_1\mid a}f(a)g(a&#x2F;d_1)\sum_{d_2\mid b}f(b)g(b&#x2F;d_2)&#x3D;\sum_{d\mid ab}f(d)g(ab&#x2F;d)&#x3D;h(ab)$。</p>
<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><ul>
<li>$\varepsilon&#x3D;\mu *1\iff\varepsilon(n)&#x3D;\sum_{d\mid n}\mu(d)$</li>
<li>$d&#x3D;1*1\iff d(n)&#x3D;\sum_{d\mid n}1$</li>
<li>$\sigma&#x3D;\operatorname{id}*1\iff \sigma(n)&#x3D;\sum_{d\mid n}d$</li>
<li>$\operatorname{id}&#x3D;\varphi*1\iff n&#x3D;\sum_{d\mid n}{\varphi(d)}$</li>
<li>$\varphi&#x3D;\operatorname{id}*\mu\iff\varphi(n)&#x3D;\sum_{d\mid n}{\mu(d)(n&#x2F;d)}$</li>
</ul>
<h3 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h3><h4 id="定理-2"><a href="#定理-2" class="headerlink" title="定理"></a>定理</h4><p><strong>定理 3.1：</strong></p>
<p>$n&#x3D;\sum_{d\mid n} \varphi(d)$。</p>
<p><strong>证明：</strong></p>
<p>$f(n)&#x3D;\sum_{d\mid n} \varphi(d)$ 为积性函数。</p>
<p>证明：当 $\gcd(n,m)&#x3D;1$ 时，</p>
<p>$\begin{aligned}<br>&amp; f(n)f(m) \<br>&#x3D; &amp; \sum_{i\mid n}\varphi(i)\sum_{j\mid m}\varphi(j) \<br>&#x3D; &amp; \sum_{i\mid n}\sum_{j\mid m}(\varphi(i)\varphi(j)) \<br>&#x3D; &amp; \sum_{i\mid n}\sum_{j\mid m}\varphi(ij) \<br>&#x3D; &amp; \sum_{d\mid nm}\varphi(d) \<br>&#x3D; &amp; f(nm)<br>\end{aligned}$</p>
<p>证毕。</p>
<p>那么根据算术基本定理 $n&#x3D;p_1^{c_1}p_2^{c_2}\cdots p_k^{c_k}$，</p>
<p>由 $f$ 是积性函数可知 $f(n)&#x3D;f(p_1^{c_1})f(p_2^{c_2})\cdots f(p_k^{c_k})$，</p>
<p>又因为 $f(p^c)&#x3D;\varphi(1)+\varphi(p)+\varphi(p^2)+\cdots+\varphi(p^c)&#x3D;1+(p-1)+(p^2-p)+\cdots+(p^c-p^{c-1})&#x3D;p^c$，</p>
<p>所以 $f(n)&#x3D;f(p_1^{c_1})f(p_2^{c_2})\cdots f(p_k^{c_k})&#x3D;p_1^{c_1}p_2^{c_2}\cdots p_k^{c_k}&#x3D;n$。</p>
<p><strong>定理 3.2：</strong></p>
<p>$\varphi(n)&#x3D;\sum_{d\mid n}(\mu(d)(n&#x2F;d))$。</p>
<p><strong>证明：</strong></p>
<p>根据定理 3.1 可得 $\varphi<em>1&#x3D;\operatorname{id}\iff \varphi</em>\varepsilon&#x3D;\operatorname{id}*\mu\iff \varphi(n)&#x3D;\sum_{d\mid n}(\mu(d)(n&#x2F;d))$。</p>
<h3 id="莫比乌斯函数"><a href="#莫比乌斯函数" class="headerlink" title="莫比乌斯函数"></a>莫比乌斯函数</h3><h4 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h4><p>$\mu$ 为莫比乌斯函数，定义为：</p>
<p>$$\mu(n)&#x3D;<br>\begin{cases} 1 &amp; n&#x3D;1 \<br>0 &amp; \exists d&gt;1,d^2\mid n \<br>(-1)^k &amp; k;为;n;的不同质因子个数<br>\end{cases}$$</p>
<h4 id="定理-3"><a href="#定理-3" class="headerlink" title="定理"></a>定理</h4><p><strong>定理 4.1：</strong></p>
<p>$\mu(n)$ 是积性函数。</p>
<p><strong>证明：</strong></p>
<p>假设 $\gcd(n,m)&#x3D;1$</p>
<ul>
<li>当 $n&#x3D;1$ 或 $m&#x3D;1$ 时，若 $n&#x3D;1$，$\mu(nm)&#x3D;\mu(n)\mu(m)&#x3D;\mu(m)$，$m&#x3D;1$ 时同理；</li>
<li>当 $n$ 和 $m$ 中至少有一个数含有平方质因子时，$nm$ 也有平方质因子，$\mu(nm)&#x3D;\mu(n)\mu(m)&#x3D;0$；</li>
<li>当 $n,m$ 都没有平方质因子且都不为 $1$ 时，假设 $n$ 有 $p$ 个不同质因子个数，$m$ 有 $q$ 个不同质因子个数，$\mu(nm)&#x3D;(-1)^{p+q}&#x3D;(-1)^p+(-1)^q&#x3D;\mu(n)\mu(m)$。</li>
</ul>
<p><strong>定理 4.2：</strong></p>
<p>$F(n)&#x3D;\sum_{d \mid n}{\mu(d)}&#x3D;\begin{cases}1 &amp; n&#x3D;1 \0 &amp; n&gt;1\end{cases}&#x3D;\varepsilon(n)&#x3D;[n&#x3D;1]$</p>
<p><strong>证明：</strong></p>
<ul>
<li><p>当 $n&#x3D;1$ 时，$F(1)&#x3D;\sum_{d \mid 1}{\mu(d)}&#x3D;\mu(1)&#x3D;1$；</p>
</li>
<li><p>当 $n&gt;1$ 时，因为 $\mu(n)$ 是积性函数，所以 $\mu(n)$ 的因数和函数 $F(n)&#x3D;\sum_{d \mid n}{\mu(d)}$ 也是积性函数,</p>
<p>  现在假设 $p$ 是质数，$F(n)&#x3D;F(p_1^{k_1})F(p_2^{k_2})\cdots F(p_t^{k_t})$，</p>
<p>  而 $F(p^k)&#x3D;\sum_{d \mid p^k}{\mu(d)}&#x3D;\mu(1)+\mu(p)+\mu(p^2)+\cdots+\mu(p^k)&#x3D;1+(-1)+0+\cdots+0&#x3D;0$，</p>
<p>  所以 $F(n)&#x3D;0$。</p>
</li>
</ul>
<p><strong>定理 4.3：</strong></p>
<p>若 $f$ 是数论函数，$F(n)&#x3D;\sum_{d \mid n}{f(d)}$，则 $f(n)&#x3D;\sum_{d \mid n}\mu(d)F(n&#x2F;d)$。</p>
<p><strong>证明：</strong></p>
<p>$\sum_{d \mid n}\mu(d)F(n&#x2F;d)&#x3D;\sum_{d \mid n}\mu(d)\sum_{e \mid (n&#x2F;d)}{f(e)}&#x3D;\sum_{e \mid n}f(e)\sum_{d \mid (n&#x2F;e)}{\mu(d)}$，</p>
<p>根据定理 4.2，当 $e&#x3D;n$ 时，$\sum_{d \mid (n&#x2F;e)}{\mu(d)}&#x3D;1$，否则为 $0$，</p>
<p>所以 $\sum_{e \mid n}(f(e)\sum_{d \mid (n&#x2F;e)}{\mu(d)})&#x3D;f(n)$。</p>
<h2 id="筛"><a href="#筛" class="headerlink" title="筛"></a>筛</h2><h3 id="线性筛"><a href="#线性筛" class="headerlink" title="线性筛"></a>线性筛</h3><ul>
<li>$1\sim n$ 的素数个数近似为 $\frac {n} {\ln{n}}$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> mn[N];</span><br><span class="line">VI p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prime_seive</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mn[i]) &#123;</span><br><span class="line">            mn[i] = i,</span><br><span class="line">            p.<span class="built_in">PB</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : p) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; mn[i] || x * i &gt; n) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mn[x * i] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线性筛-amp-欧拉函数"><a href="#线性筛-amp-欧拉函数" class="headerlink" title="线性筛 &amp; 欧拉函数"></a>线性筛 &amp; 欧拉函数</h3><p>$\varphi(N)&#x3D;N * \prod_{p\mid N}{(1-\frac{1}{p})}$（$p$ 为质数）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> mn[N], phi[N];</span><br><span class="line">VI p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_phi</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mn[i]) &#123;</span><br><span class="line">            mn[i] = i,</span><br><span class="line">            p.<span class="built_in">PB</span>(i);</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : p) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; mn[i] || x * i &gt; n) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mn[x * i] = x;</span><br><span class="line">            phi[x * i] = i % x ? phi[i] * (x - <span class="number">1</span>) : phi[i] * x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线性筛-amp-莫比乌斯函数"><a href="#线性筛-amp-莫比乌斯函数" class="headerlink" title="线性筛 &amp; 莫比乌斯函数"></a>线性筛 &amp; 莫比乌斯函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> mn[N], mu[N];</span><br><span class="line">VI p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_mu</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mn[i]) &#123;</span><br><span class="line">            mn[i] = i,</span><br><span class="line">            mu[i] = <span class="number">-1</span>,</span><br><span class="line">            p.<span class="built_in">PB</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : p) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x * i &gt; n) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mn[x * i] = x;</span><br><span class="line">            <span class="keyword">if</span> (i % x == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[x * i] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[x * i] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="杜教筛"><a href="#杜教筛" class="headerlink" title="杜教筛"></a>杜教筛</h3><p>求 $S(n)&#x3D;\sum_{i&#x3D;1}^n{f(i)}$，其中 $f$ 是一个数论函数。</p>
<p>构造一个积性函数 $g$，求 $g*f$ 的前缀和：</p>
<p>$\begin{aligned}<br>\sum_{i&#x3D;1}^n(g*f)(i)&#x3D; &amp; \sum_{i&#x3D;1}^n\sum_{d\mid i}{g(d)f(\frac{i}{d})} \<br>&#x3D; &amp; \sum_{d&#x3D;1}^ng(d)\sum_{d\mid i}f(\frac{i}{d}) \<br>&#x3D; &amp; \sum_{d&#x3D;1}^ng(d)\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}{f(i)} \<br>&#x3D; &amp; \sum_{d&#x3D;1}^ng(d)S(\lfloor\frac{n}{d}\rfloor)<br>\end{aligned}$</p>
<p>容斥一下，有 $g(1)S(n)&#x3D;\sum_{i&#x3D;1}^ng(i)S(\lfloor\frac{n}{i}\rfloor)-\sum_{i&#x3D;2}^ng(i)S(\lfloor\frac{n}{i}\rfloor)&#x3D;\sum_{i&#x3D;1}^n(g*f)(i)-\sum_{i&#x3D;2}^ng(i)S(\lfloor\frac{n}{i}\rfloor)$。</p>
<p>前半部分是 Dirichlet 卷积的前缀和，后半部分可以数论分块求。</p>
<p>我们要做的是构造一个 $g$ 使 $g*f$ 的前缀和好算。</p>
<p>例子：</p>
<ol>
<li><p>$\sum_{i&#x3D;1}^n\mu(i)$</p>
<p>由 $\sum_{d\mid n}\mu(d)&#x3D;[n&#x3D;1]$，选择 $g&#x3D;1(i)$，那么 $\sum_{i&#x3D;1}^n{(1*\mu)(i)}&#x3D;1$，所以 $S(n)&#x3D;\sum_{i&#x3D;1}^n{\mu(i)}&#x3D;1-\sum_{i&#x3D;2}^nS(\lfloor\frac{n}{i}\rfloor)$。</p>
</li>
<li><p>$\sum_{i&#x3D;1}^n\varphi(i)$</p>
<p>由 $\sum_{d\mid n}\varphi(d)&#x3D;n$，选择 $g&#x3D;1(i)$，那么 $\sum_{i&#x3D;1}^n{(1*\varphi)(i)}&#x3D;\frac{n(n+1)}{2}$，所以  $S(n)&#x3D;\sum_{i&#x3D;1}^n{\varphi(i)}&#x3D;\frac{n(n+1)}{2}-\sum_{i&#x3D;2}^nS(\lfloor\frac{n}{i}\rfloor)$。</p>
</li>
</ol>
<p>要能够由此计算 $S(n)$，对 $f,g$ 有一些要求：</p>
<ul>
<li>$f*g$ 能够快速求前缀和。</li>
<li>$g$ 能够快速求分段和（前缀和）。</li>
</ul>
<p>线性筛预处理 $S$ 的前 $n^{\frac{2}{3}}$ 项，剩余部分的时间复杂度为 $O(n^{\frac{2}{3}})$，对于较大的值，用 map 存其对应的值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">LL mn[N],phi[N],mu[N];</span><br><span class="line">VI p;</span><br><span class="line">unordered_map&lt;LL,LL&gt; _phi,_mu;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>]=mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!mn[i]) mn[i]=i,mu[i]=<span class="number">-1</span>,phi[i]=i<span class="number">-1</span>,p.<span class="built_in">PB</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:p) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x*i&gt;n) <span class="keyword">break</span>;</span><br><span class="line">            mn[x*i]=x;</span><br><span class="line">            <span class="keyword">if</span>(i%x==<span class="number">0</span>) &#123;mu[x*i]=<span class="number">0</span>,phi[x*i]=phi[i]*x;<span class="keyword">break</span>;&#125;</span><br><span class="line">            mu[x*i]=-mu[i];</span><br><span class="line">            phi[x*i]=i%x?phi[i]*(x<span class="number">-1</span>):phi[i]*x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) phi[i]+=phi[i<span class="number">-1</span>],mu[i]+=mu[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">calc_phi</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=LIM) <span class="keyword">return</span> phi[n];</span><br><span class="line">    <span class="keyword">if</span>(_phi.<span class="built_in">count</span>(n)) <span class="keyword">return</span> _phi[n];</span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(LL l=<span class="number">2</span>,r;l&lt;=n;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">        r=n/(n/l);</span><br><span class="line">        ret+=(r-l+<span class="number">1</span>)*<span class="built_in">calc_phi</span>(n/l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _phi[n]=n*(n+<span class="number">1</span>)/<span class="number">2</span>-ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">calc_mu</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=LIM) <span class="keyword">return</span> mu[n];</span><br><span class="line">    <span class="keyword">if</span>(_mu.<span class="built_in">count</span>(n)) <span class="keyword">return</span> _mu[n];</span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(LL l=<span class="number">2</span>,r;l&lt;=n;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">        r=n/(n/l);</span><br><span class="line">        ret+=(r-l+<span class="number">1</span>)*<span class="built_in">calc_mu</span>(n/l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _mu[n]=<span class="number">1</span>-ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h2><ul>
<li><p>欧拉定理：$a^{\varphi(m)}\equiv 1\pmod m$ $(a,m\in \mathbb{Z}^+,a\perp m)$</p>
</li>
<li><p>费马小定理：$a^{p-1}\equiv 1\pmod p$（$p$ 为质数，$a\perp p$）</p>
</li>
<li><p>扩展欧拉定理：</p>
</li>
</ul>
<p>$$<br>a^b\equiv<br>\begin{cases}<br>{a^{b\bmod\varphi(m)}} &amp; a\perp m\<br>{a^b} &amp; a\not \perp m,b&lt;\varphi(m)\<br>{a^{b\bmod\varphi(m)+\varphi(m)}} &amp;a\not \perp m,b\ge \varphi(m)<br>\end{cases} \pmod{m}<br>$$</p>
<p>也可表示为：</p>
<p>$$<br>a^b\equiv<br>\begin{cases}<br>a^b &amp; b&lt;\varphi(m)\<br>a^{b\bmod\varphi(m)+\varphi(m)} &amp; b\ge \varphi(m)<br>\end{cases} \pmod{m}<br>$$</p>
<ul>
<li>若 $a\perp m$，则满足 $a^x\equiv 1\pmod m$ 的最小正整数 $x_0$ 是 $\varphi(n)$ 的约数</li>
</ul>
<h2 id="扩展欧几里得算法"><a href="#扩展欧几里得算法" class="headerlink" title="扩展欧几里得算法"></a>扩展欧几里得算法</h2><p>裴蜀定理：对于任意整数 $a,b$，存在一对整数，满足$ax+by&#x3D;\gcd(a,b)$</p>
<p>即 $ax+by&#x3D;c$，当 $\gcd(a,b)\mid c$，等式成立</p>
<ul>
<li><p>若 $x’$，$y’$ 为方程  $ax+by&#x3D;\gcd(a,b)$ 的一组解，则该方程的任意解表示为：$x&#x3D;x’+kb&#x2F;\gcd(a,b),y&#x3D;y’-ka&#x2F;\gcd(a,b)$，且对任意整数 $k$ 都成立</p>
</li>
<li><p>设 $t&#x3D;b&#x2F;\gcd(a,b)$，那么 $x$ 的最小非负整数解 $x&#x3D;(x’%t+t)%t$</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">exgcd</span><span class="params">(LL a,LL b,LL &amp;x,LL &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b) &#123;x=<span class="number">1</span>,y=<span class="number">0</span>;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    LL ret=<span class="built_in">exgcd</span>(b,a%b,y,x);</span><br><span class="line">    y-=a/b*x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性同余方程"><a href="#线性同余方程" class="headerlink" title="线性同余方程"></a>线性同余方程</h2><p>形如 $ax\equiv b\pmod m$ 的方程被称为线性同余方程</p>
<p>方程 $ax\equiv b\pmod m$ 等价于方程 $ax+my&#x3D;b$，有整数解的充要条件为 $gcd(a,m)\mid b$</p>
<h2 id="乘法逆元"><a href="#乘法逆元" class="headerlink" title="乘法逆元"></a>乘法逆元</h2><p>如果一个线性同余方程 $ax\equiv 1\pmod m,a\perp m$，则称 $x$ 为 $a\bmod m$ 的乘法逆元，记作 $a^{-1}$</p>
<ul>
<li>当模数 $m$ 为质数时，$a^{m-2}$ 为 $a$ 的乘法逆元</li>
<li>当模数 $m$ 为合数时，通过求解同余方程 $ax\equiv 1\pmod m$ 可得到乘法逆元</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：扩展欧几里得</span></span><br><span class="line"><span class="function">LL <span class="title">get_inv</span><span class="params">(LL a,LL m)</span> </span>&#123;</span><br><span class="line">    LL x,y;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">exgcd</span>(a,m,x,y)!=<span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> (x%m+m)%m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>预处理 $1\sim n$ 的乘法逆元</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LL inv[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init_inv</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">2</span>;i&lt;=n;i++) inv[i]=(MOD-MOD/i)*inv[MOD%i]%MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>预处理 $1\sim n$ 的阶乘及其乘法逆元</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：快速幂</span></span><br><span class="line">LL fac[N],invfac[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init_invfac</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">    n=<span class="built_in">min</span>(n,MOD<span class="number">-1</span>);</span><br><span class="line">    fac[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">1</span>;i&lt;=n;i++) fac[i]=fac[i<span class="number">-1</span>]*i%MOD;</span><br><span class="line">    invfac[n]=<span class="built_in">qpow</span>(fac[n],MOD<span class="number">-2</span>);</span><br><span class="line">    <span class="keyword">for</span>(LL i=n<span class="number">-1</span>;~i;i--) invfac[i]=invfac[i+<span class="number">1</span>]*(i+<span class="number">1</span>)%MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h2><p>中国剩余定理可求解如下形式的一元线性同余方程组（其中 $m_1,m_2,\cdots,n_k$ 两两互质)：</p>
<p>$$<br>\begin{cases}<br>x &amp; \equiv a_1 \pmod {m_1} \<br>x &amp; \equiv a_2 \pmod {m_2} \<br>  &amp; \vdots\<br>x &amp; \equiv a_k \pmod {m_k}<br>\end{cases}<br>$$</p>
<p><strong>算法流程</strong></p>
<ol>
<li><p>计算所有模数的积 $M$</p>
</li>
<li><p>对于第 $i$ 个方程：</p>
<p>a. 计算 $b_i&#x3D;\frac m {m_i}$</p>
<p>b. 计算 $b_i$ 在模 $m_i$ 意义下的逆元 $b_i^{-1}$</p>
<p>c. 计算 $c_i&#x3D;b_i b_i^{-1}$（ 不要对 $m_i$ 取模 ）</p>
</li>
<li><p>方程组的特解为：$Y&#x3D;\sum_{i&#x3D;1}^k a_i c_i \pmod M$，通解为 $kM+Y(k\in \mathbb Z)$</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：龟速乘，扩展欧几里得</span></span><br><span class="line"><span class="function">LL <span class="title">crt</span><span class="params">(LL *m,LL *a,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    LL M=<span class="number">1</span>,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) M*=m[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        LL b=M/m[i],x,y;</span><br><span class="line">        LL d=<span class="built_in">exgcd</span>(b,m[i],x,y);</span><br><span class="line">        res=(res+<span class="built_in">qmul</span>(<span class="built_in">qmul</span>(b,a[i],M),(x%m[i]+m[i])%m[i],M))%M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>扩展：模数不互质的情况</strong></p>
<p>设两个方程分别是 $x\equiv a_1\pmod {m_1}$、$x\equiv a_2\pmod {m_2}$</p>
<p>将它们转为不定方程：$x&#x3D;m_1+a_1&#x3D;m_2q+a_2$，其中 $p,q$ 是整数，则有 $m_1 p-m_2 q&#x3D;a_2-a_1$</p>
<p>由裴蜀定理，当 $a_2-a_1$ 不能被 $\gcd(m_1,m_2)$ 整除时，无解</p>
<p>其他情况下，可以通过扩展欧几里得算法解出来一组可行解 $(p,q)$</p>
<p>则原来的两方程组成的模方程组的解为 $x\equiv b\pmod M$，其中 $b&#x3D;m_1p+a_1$，$M&#x3D;\text{lcm}(m_1,m_2)$</p>
<p>两两合并多个方程，能得出特解 $x$，通解为 $k*\text{lcm}(m_1,m_2,\cdots,m_n)+x(k\in \mathbb Z)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置模板：龟速乘，扩展欧几里得</span></span><br><span class="line"><span class="function">LL <span class="title">excrt</span><span class="params">(LL *m,LL *a,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    LL M=m[<span class="number">1</span>],A=a[<span class="number">1</span>],x,y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        LL d=<span class="built_in">exgcd</span>(M,m[i],x,y);</span><br><span class="line">        LL c=(a[i]-A%m[i]+m[i])%m[i];</span><br><span class="line">        <span class="keyword">if</span>(c%d) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        x=<span class="built_in">qmul</span>(x,c/d,m[i]/d); <span class="comment">// 防爆 LL</span></span><br><span class="line">        A+=M*x;</span><br><span class="line">        M*=m[i]/d;</span><br><span class="line">        A%=M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (A%M+M)%M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="离散对数"><a href="#离散对数" class="headerlink" title="离散对数"></a>离散对数</h2><h3 id="BSGS"><a href="#BSGS" class="headerlink" title="BSGS"></a>BSGS</h3><p>在 $O(\sqrt m)$ 的时间内求解 $a^x\equiv\pmod m,a\perp m$</p>
<p>方程的解 $x$ 满足 $0\le x &lt;m$</p>
<p>令 $x&#x3D;A\lceil \sqrt m \rceil -B (0\le A,B\le\lceil \sqrt m \rceil)$，则有 $a^{A\lceil \sqrt m \rceil -B} \equiv b\pmod m$，即 $a^{A\lceil \sqrt m \rceil} \equiv ba^B\pmod m$</p>
<p>枚举 $B$，算出 $ba^B$ 的所有取值，然后枚举 $A$，逐一计算 $a^{A\lceil \sqrt m \rceil}$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">BSGS</span><span class="params">(LL a,LL b,LL m)</span> </span>&#123;</span><br><span class="line">    a%=m,b%=m;</span><br><span class="line">    <span class="keyword">if</span>(!a&amp;&amp;!b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(!a) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="type">static</span> unordered_map&lt;LL,LL&gt; mp;</span><br><span class="line">    mp.<span class="built_in">clear</span>();</span><br><span class="line">    LL r=<span class="built_in">sqrt</span>(m+<span class="number">1.5</span>),v=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=r;i++) &#123;</span><br><span class="line">        v=v*a%m;</span><br><span class="line">        mp[b*v%m]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    LL vv=v;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=r;i++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> it=mp.<span class="built_in">find</span>(vv);</span><br><span class="line">        <span class="keyword">if</span>(it!=mp.<span class="built_in">end</span>()) <span class="keyword">return</span> i*r-it-&gt;second;</span><br><span class="line">        vv=vv*v%m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数论分块"><a href="#数论分块" class="headerlink" title="数论分块"></a>数论分块</h2><ul>
<li>$\sum_{i&#x3D;1}^n \lfloor \frac ni \rfloor$</li>
<li>$O(\sqrt{n})$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    LL res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>,r;l&lt;=n;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">        r=n/(n/l);</span><br><span class="line">        res+=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*(n/l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>卡常 $O(\sqrt n)$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    LL res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> t=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=t;i++) res+=n/i;</span><br><span class="line">    res=res*<span class="number">2</span><span class="number">-1ll</span>*t*t;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>$\sum_{i&#x3D;1}^n \sum_{j&#x3D;1}^m\lfloor \frac ni \rfloor \lfloor \frac mi \rfloor$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    LL res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> lim=<span class="built_in">min</span>(n,m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>,r;l&lt;=lim;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">        r=<span class="built_in">min</span>(n/(n/l),m/(m/l));</span><br><span class="line">        res+=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*(n/l)*(m/l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二次剩余"><a href="#二次剩余" class="headerlink" title="二次剩余"></a>二次剩余</h2><p>一个数 $a$，如果不是 $p$ 的倍数且模 $p$ 同余于某个数的平方，则称 $a$ 为模 $p$ 的 二次剩余。</p>
<p>而一个不是 $p$ 的倍数的数 $b$，不同余于任何数的平方，则称 $b$ 为模 $p$ 的 非二次剩余。</p>
<p>$x^2\equiv n\pmod{p}$​（$n&gt;0$，$p$​​ 为质数），对常数 $n$ 求 $x$。</p>
<p>当解得 $x&gt;0$ 时， $p-x$​ 也是一个解。</p>
<h3 id="Cipolla-算法"><a href="#Cipolla-算法" class="headerlink" title="Cipolla 算法"></a>Cipolla 算法</h3><ul>
<li>时间复杂度：$O(\log p)$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">LL w;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    LL r,i;</span><br><span class="line">    <span class="built_in">C</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">C</span>(LL r,LL i):<span class="built_in">r</span>(r),<span class="built_in">i</span>(i) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">C <span class="title">mul</span><span class="params">(C a,C b,LL p)</span> </span>&#123;</span><br><span class="line">    C ret=<span class="built_in">C</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    ret.r=((a.r*b.r%p+a.i*b.i%p*w%p)%p+p)%p;</span><br><span class="line">    ret.i=((a.r*b.i%p+a.i*b.r%p)%p+p)%p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">qpow_r</span><span class="params">(LL a,LL b,LL p)</span> </span>&#123;</span><br><span class="line">    LL ret=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=ret*a%p;</span><br><span class="line">        a=a*a%p;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">qpow_i</span><span class="params">(C a,LL b,LL p)</span> </span>&#123;</span><br><span class="line">    C ret=<span class="built_in">C</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=<span class="built_in">mul</span>(ret,a,p);</span><br><span class="line">        a=<span class="built_in">mul</span>(a,a,p);</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret.r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">cioplla</span><span class="params">(LL n,LL p)</span> </span>&#123;</span><br><span class="line">    n%=p;</span><br><span class="line">    <span class="keyword">if</span>(!n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">qpow_r</span>(n,(p<span class="number">-1</span>)/<span class="number">2</span>,p)==p<span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    LL a;</span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        a=<span class="built_in">rand</span>()%p;</span><br><span class="line">        w=((a*a%p-n)%p+p)%p;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">qpow_r</span>(w,(p<span class="number">-1</span>)/<span class="number">2</span>,p)==p<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    C x=<span class="built_in">C</span>(a,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qpow_i</span>(x,(p+<span class="number">1</span>)/<span class="number">2</span>,p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="矩阵运算"><a href="#矩阵运算" class="headerlink" title="矩阵运算"></a>矩阵运算</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">M</span> &#123;</span><br><span class="line">    LL a[N][N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a);&#125;</span><br><span class="line">    <span class="built_in">M</span>() &#123;<span class="built_in">clear</span>();&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++) a[i][i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    M <span class="keyword">operator</span> + (<span class="type">const</span> M &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">        M ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                ret.a[i][j]=(a[i][j]+T.a[i][j])%MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    M <span class="keyword">operator</span> - (<span class="type">const</span> M &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">        M ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                ret.a[i][j]=(a[i][j]-T.a[i][j]+MOD)%MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    M <span class="keyword">operator</span> * (<span class="type">const</span> LL &amp;v) <span class="type">const</span> &#123;</span><br><span class="line">        M ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++) <span class="keyword">if</span>(a[i][j])</span><br><span class="line">                ret.a[i][j]=a[i][j]*v%MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    M <span class="keyword">operator</span> * (<span class="type">const</span> M &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">        M ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;N;k++) <span class="keyword">if</span>(a[i][k])</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++) <span class="keyword">if</span>(T.a[k][j])</span><br><span class="line">                    ret.a[i][j]=(ret.a[i][j]+a[i][k]*T.a[k][j]%MOD)%MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    M <span class="keyword">operator</span> ^ (LL b) <span class="type">const</span> &#123;</span><br><span class="line">        M ret,bas;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++) ret.a[i][i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                bas.a[i][j]=a[i][j];</span><br><span class="line">        <span class="keyword">while</span>(b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=ret*bas;</span><br><span class="line">            bas=bas*bas;</span><br><span class="line">            b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                cout&lt;&lt;a[i][j]&lt;&lt;<span class="string">&quot; \n&quot;</span>[j==N<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h2><h3 id="高斯消元解线性方程组"><a href="#高斯消元解线性方程组" class="headerlink" title="高斯消元解线性方程组"></a>高斯消元解线性方程组</h3><ul>
<li>浮点数版本</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> DB EPS=<span class="number">1e-9</span>;</span><br><span class="line">DB a[N][N],x[N]; <span class="comment">// a 是增广矩阵，x 是解</span></span><br><span class="line"><span class="type">bool</span> free_x[N]; <span class="comment">// 是否为自由变量</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span><span class="params">(DB x)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>(x)&lt;EPS?<span class="number">0</span>:(x&gt;<span class="number">0</span>?<span class="number">1</span>:<span class="number">-1</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123; <span class="comment">// n 个方程，m 个变量</span></span><br><span class="line">    <span class="built_in">memset</span>(x,<span class="number">0</span>,<span class="keyword">sizeof</span> x);</span><br><span class="line">    <span class="built_in">memset</span>(free_x,<span class="literal">true</span>,<span class="keyword">sizeof</span> free_x);</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,c=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n&amp;&amp;c&lt;m) &#123;</span><br><span class="line">        <span class="type">int</span> R=r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(<span class="built_in">fabs</span>(a[i][c])&gt;<span class="built_in">fabs</span>(a[R][c])) R=i;</span><br><span class="line">        <span class="keyword">if</span>(R!=r) <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) <span class="built_in">swap</span>(a[r][j],a[R][j]);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">sgn</span>(a[r][c])) &#123;a[r][c]=<span class="number">0</span>;++c;<span class="keyword">continue</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(a[i][c]) &#123;</span><br><span class="line">            DB t=a[i][c]/a[r][c];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) a[i][j]-=a[r][j]*t;</span><br><span class="line">        &#125;</span><br><span class="line">        ++r,++c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r;i&lt;n;i++) <span class="keyword">if</span>(<span class="built_in">sgn</span>(a[i][m])) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(r&lt;m) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">            <span class="type">int</span> cnt=<span class="number">0</span>,k=<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m;j++) <span class="keyword">if</span>(<span class="built_in">sgn</span>(a[i][j])&amp;&amp;free_x[j]) ++cnt,k=j;</span><br><span class="line">            <span class="keyword">if</span>(cnt&gt;<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            DB s=a[i][m];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m;j++) <span class="keyword">if</span>(<span class="built_in">sgn</span>(a[i][j])&amp;&amp;j!=k) s-=a[i][j]*x[j];</span><br><span class="line">            x[k]=s/a[i][k];</span><br><span class="line">            free_x[k]=<span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> m-r; <span class="comment">// 自由变量个数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=m<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">        DB s=a[i][m];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;m;j++) s-=a[i][j]*x[j];</span><br><span class="line">        <span class="comment">// 整数版本中 if(s%a[i][i]!=0) return -2; // 说明有浮点数解，但无整数解</span></span><br><span class="line">        x[i]=s/a[i][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高斯消元解-XOR-方程组"><a href="#高斯消元解-XOR-方程组" class="headerlink" title="高斯消元解 XOR 方程组"></a>高斯消元解 XOR 方程组</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N],x[N]; <span class="comment">// a 是增广矩阵，x 是解</span></span><br><span class="line">VI free_x;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123; <span class="comment">// n 个方程，m 个变量</span></span><br><span class="line">    <span class="built_in">memset</span>(x,<span class="number">0</span>,<span class="keyword">sizeof</span> x);</span><br><span class="line">    free_x.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,c=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n&amp;&amp;c&lt;m) &#123;</span><br><span class="line">        <span class="type">int</span> R=r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(a[i][c]&gt;a[R][c]) R=i;</span><br><span class="line">        <span class="keyword">if</span>(R!=r) <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) <span class="built_in">swap</span>(a[r][j],a[R][j]);</span><br><span class="line">        <span class="keyword">if</span>(!a[r][c]) &#123;free_x.<span class="built_in">PB</span>(c),++c;<span class="keyword">continue</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(a[i][c]) &#123;</span><br><span class="line">            <span class="type">int</span> t=a[i][c]^a[r][c];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) a[i][j]^=a[r][j]^t;</span><br><span class="line">        &#125;</span><br><span class="line">        ++r,++c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r;i&lt;n;i++) <span class="keyword">if</span>(a[i][m]) <span class="keyword">return</span> INT_MAX; <span class="comment">// 无解</span></span><br><span class="line">    <span class="type">int</span> mn=INT_MAX;</span><br><span class="line">    <span class="comment">// 自由变量个数为 m - r 个</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1</span>&lt;&lt;(m-r);i++) &#123; <span class="comment">//枚举变元</span></span><br><span class="line">        <span class="type">int</span> cnt=<span class="number">0</span>,idx=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m-r;j++) &#123;</span><br><span class="line">            x[free_x[j]]=idx&amp;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(x[free_x[j]]) ++cnt;</span><br><span class="line">            idx&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=r<span class="number">-1</span>;j&gt;=<span class="number">0</span>;j--) &#123;</span><br><span class="line">            <span class="type">int</span> k=j;</span><br><span class="line">            <span class="keyword">while</span>(!a[j][k]) ++k;</span><br><span class="line">            x[k]=a[j][m];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l=k+<span class="number">1</span>;l&lt;m;l++) x[k]^=a[j][l]&amp;x[l];</span><br><span class="line">            <span class="keyword">if</span>(x[k]) ++cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        mn=<span class="built_in">min</span>(mn,cnt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mn; <span class="comment">// 最小操作数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高斯消元解同余方程组"><a href="#高斯消元解同余方程组" class="headerlink" title="高斯消元解同余方程组"></a>高斯消元解同余方程组</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MOD=<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> a[N][N],x[N]; <span class="comment">// a 是增广矩阵，x 是解</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCM</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a/__gcd(a,b)*b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">get_inv</span><span class="params">(LL a,LL m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">get_inv</span>(m%a,m)*(m-m/a)%m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123; <span class="comment">// n 个方程，m 个变量</span></span><br><span class="line">    <span class="built_in">memset</span>(x,<span class="number">0</span>,<span class="keyword">sizeof</span> x);</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,c=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n&amp;&amp;c&lt;m) &#123;</span><br><span class="line">        <span class="type">int</span> R=r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(<span class="built_in">abs</span>(a[i][c])&gt;<span class="built_in">abs</span>(a[R][c])) R=i;</span><br><span class="line">        <span class="keyword">if</span>(R!=r) <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) <span class="built_in">swap</span>(a[r][j],a[R][j]);</span><br><span class="line">        <span class="keyword">if</span>(!a[r][c]) &#123;++c;<span class="keyword">continue</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=r+<span class="number">1</span>;i&lt;n;i++) <span class="keyword">if</span>(a[i][c]) &#123;</span><br><span class="line">            <span class="type">int</span> lcm=<span class="built_in">LCM</span>(a[i][c],a[r][c]);</span><br><span class="line">            <span class="type">int</span> ta=lcm/a[i][c],tb=lcm/a[r][c];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=c;j&lt;=m;j++) a[i][j]=(a[i][j]*ta%MOD-a[r][j]*tb%MOD+MOD)%MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ++r,++c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=r;i&lt;n;i++) <span class="keyword">if</span>(a[i][m]) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// 无解</span></span><br><span class="line">    <span class="keyword">if</span>(r&lt;m) <span class="keyword">return</span> m-r; <span class="comment">// 自由变量个数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=m<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123; <span class="comment">// 必有唯一解</span></span><br><span class="line">        <span class="type">int</span> s=a[i][m];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;m;j++) s=(s-a[i][j]*x[j]%MOD+MOD)%MOD;</span><br><span class="line">        x[i]=s*<span class="built_in">get_inv</span>(a[i][i],MOD)%MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性基"><a href="#线性基" class="headerlink" title="线性基"></a>线性基</h2><p>线性基是向量空间的一组基，通常可以解决有关异或的一些题目</p>
<p>通俗一点的讲法就是由一个集合构造出来的另一个集合，它有以下几个性质：</p>
<ul>
<li>线性基的元素能相互异或得到原集合的元素的所有相互异或得到的值</li>
<li>线性基是满足性质 $1$ 的最小的集合</li>
<li>线性基没有异或和为 $0$ 的子集</li>
<li>线性基中每个元素的异或方案唯一，也就是说，线性基中不同的异或组合异或出的数都是不一样的</li>
<li>线性基中每个元素的二进制最高位互不相同</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询原集合内任意几个元素异或后的值</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100</span>;</span><br><span class="line"><span class="type">int</span> n,tot;</span><br><span class="line">LL d[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">add</span><span class="params">(LL x)</span> </span>&#123; <span class="comment">// 插入</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">62</span>;~i;i--) <span class="keyword">if</span>((x&gt;&gt;i)&amp;<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!d[i]) &#123;d[i]=x;<span class="keyword">return</span> <span class="literal">true</span>;&#125;</span><br><span class="line">        x^=d[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123; <span class="comment">// 统计线性基元素数量</span></span><br><span class="line">    tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">63</span>;i++) <span class="keyword">if</span>(d[i]) ++tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">get_max</span><span class="params">()</span> </span>&#123; <span class="comment">// 最大值</span></span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">62</span>;~i;i--) <span class="keyword">if</span>(ret^d[i]&gt;ret) ret^=d[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">get_min</span><span class="params">()</span> </span>&#123; <span class="comment">// 最小值</span></span><br><span class="line">    <span class="keyword">if</span>(tot&lt;n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">63</span>;i++) <span class="keyword">if</span>(d[i]) <span class="keyword">return</span> d[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">63</span>;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++)</span><br><span class="line">            <span class="keyword">if</span>((d[i]&gt;&gt;j)&amp;<span class="number">1</span>)</span><br><span class="line">                d[i]^=d[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// k 小值</span></span><br><span class="line">    <span class="keyword">if</span>(tot&lt;n) --k; <span class="comment">// 去掉 0</span></span><br><span class="line">    LL ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">63</span>;i++) <span class="keyword">if</span>(d[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>) ret^=d[i];</span><br><span class="line">        k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(k) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span> d);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        LL x;cin&gt;&gt;x;</span><br><span class="line">        <span class="built_in">add</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">calc</span>();</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性递推数列"><a href="#线性递推数列" class="headerlink" title="线性递推数列"></a>线性递推数列</h2><h3 id="一阶线性递推数列"><a href="#一阶线性递推数列" class="headerlink" title="一阶线性递推数列"></a>一阶线性递推数列</h3><p>对于一阶线性递推数列，形如 $a_{n+1}&#x3D;pa_n+q$，可采用参数法求通项。</p>
<p>对于 $a_{n+1}&#x3D;pa_n+q$，设 $a_{n+1}-t&#x3D;p(a_n-t)$，</p>
<p>得：$q&#x3D;t-pt$，解出 $t$ 代入上式，用等比数列通项得到：$a_n&#x3D;p^{n-1}(a_1-t)+t$。</p>
<h3 id="二阶线性递推数列"><a href="#二阶线性递推数列" class="headerlink" title="二阶线性递推数列"></a>二阶线性递推数列</h3><p>对于二阶线性递推数列，形如 $a_{n+2}&#x3D;pa_{n+1}+qa_n$ $(q\neq 0)$，可采用特征方程法求通项。</p>
<p>对于 $a_{n+2}&#x3D;pa_{n+1}+qa_n$，设有 $s$ 和 $r$，使 $a_{n+2}-sa_{n+1}&#x3D;r(a_{n+1}-sa_{n})$。</p>
<p>得：$s+r&#x3D;p$，$rs&#x3D;-q$，易发现这是韦达定理。</p>
<p>那么 $s,r$ 为一元二次方程 $x^2-px-q&#x3D;0$ 的解。</p>
<p>称一元二次方程 $x^2-px-q&#x3D;0$ 为递推数列 $a_{n+2}&#x3D;pa_{n+1}+qa_n$ $(q\neq 0)$ 的特征方程。</p>
<p>在等式 $a_{n+2}-sa_{n+1}&#x3D;r(a_{n+1}-sa_{n})$ 中，易发现 $s,r$ 是可以交换的。</p>
<p>那么可以得到方程组：</p>
<p>$\begin{cases}<br>a_{n+2}-sa_{n+1}&#x3D;r^{n-1}(a_2-sa_1) \<br>a_{n+2}-ra_{n+1}&#x3D;s^{n-1}(a_2-ra_1)<br>\end{cases}$</p>
<ul>
<li>若 $s\neq r$，$a_n&#x3D;\frac{r^{n-1}(a_2-sa_1)-s^{n-1}(a_2-ra_1)}{r-s}$；</li>
<li>若 $s&#x3D;r$，则 $a&#x3D;b\neq 0$，$a_n&#x3D;(2-n)s^{n-1}a_1+(n-1)s^{n-2}a_2$。</li>
</ul>
<h2 id="概率论"><a href="#概率论" class="headerlink" title="概率论"></a>概率论</h2><h3 id="几何分布"><a href="#几何分布" class="headerlink" title="几何分布"></a>几何分布</h3><p>在 $n$ 次伯努利试验中，试验 $k$ 次才得到第一次成功的机率。</p>
<p>记在伯努利试验中，成功的概率为 $p$，试验次数为 $x$。</p>
<p>$P(x)&#x3D;(1-p)^{x-1}p$</p>
<p>$E(x)&#x3D;\frac{1}{p}$</p>
<h3 id="超几何分布"><a href="#超几何分布" class="headerlink" title="超几何分布"></a>超几何分布</h3><h2 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h2><h3 id="FFT"><a href="#FFT" class="headerlink" title="FFT"></a>FFT</h3><ul>
<li>$n$ 必须超过 $a,b$ 最高指数之和</li>
<li>空间大于 $a,b$ 最高指数之和的两倍</li>
<li>所求系数是整数时，卷积后注意四舍五入</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> LD PI=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> FFT &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">C</span> &#123;</span><br><span class="line">        LD r,i;</span><br><span class="line">        <span class="built_in">C</span>(LD r=<span class="number">0</span>,LD i=<span class="number">0</span>):<span class="built_in">r</span>(r),<span class="built_in">i</span>(i) &#123;&#125;</span><br><span class="line">        C <span class="keyword">operator</span> + (<span class="type">const</span> C &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">C</span>(r+T.r,i+T.i);</span><br><span class="line">        &#125;</span><br><span class="line">        C <span class="keyword">operator</span> - (<span class="type">const</span> C &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">C</span>(r-T.r,i-T.i);</span><br><span class="line">        &#125;</span><br><span class="line">        C <span class="keyword">operator</span> * (<span class="type">const</span> C &amp;T) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">C</span>(r*T.r-i*T.i,r*T.i+i*T.r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">FFT</span><span class="params">(C x[],<span class="type">int</span> n,<span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="function">VI <span class="title">rev</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">            rev[i]=rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>|(i&amp;<span class="number">1</span>?n&gt;&gt;<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(i&lt;rev[i]) <span class="built_in">swap</span>(x[i],x[rev[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mid=<span class="number">1</span>;mid&lt;n;mid&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">C <span class="title">wn</span><span class="params">(cos(PI/mid),sin(on*PI/mid))</span></span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i+=(mid&lt;&lt;<span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="function">C <span class="title">w</span><span class="params">(<span class="number">1</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;mid;j++,w=w*wn) &#123;</span><br><span class="line">                    C t1=x[i+j],t2=w*x[i+j+mid];</span><br><span class="line">                    x[i+j]=t1+t2,x[i+j+mid]=t1-t2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(on==<span class="number">-1</span>) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) x[i].r/=n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">conv</span><span class="params">(C a[],C b[],<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">FFT</span>(a,n,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">FFT</span>(b,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i]=a[i]*b[i];</span><br><span class="line">        <span class="built_in">FFT</span>(a,n,<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h3><ul>
<li>$998244353,1004535809,469762049$ 原根都为 $3$</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> NTT &#123;</span><br><span class="line">   <span class="type">const</span> LL G=<span class="number">3</span>,MOD=<span class="number">998244353</span>;</span><br><span class="line">   <span class="function">LL <span class="title">qpow</span><span class="params">(LL a,LL b)</span> </span>&#123;</span><br><span class="line">       LL ret=<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span>(b) &#123;</span><br><span class="line">           <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ret=ret*a%MOD;</span><br><span class="line">           a=a*a%MOD;</span><br><span class="line">           b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ret;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(LL x[],<span class="type">int</span> n,<span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="function">VI <span class="title">rev</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">            rev[i]=rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>|(i&amp;<span class="number">1</span>?n&gt;&gt;<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(i&lt;rev[i]) <span class="built_in">swap</span>(x[i],x[rev[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mid=<span class="number">1</span>;mid&lt;n;mid&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">            LL wn=<span class="built_in">qpow</span>(on==<span class="number">1</span>?G:<span class="built_in">qpow</span>(G,MOD<span class="number">-2</span>),(MOD<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i+=(mid&lt;&lt;<span class="number">1</span>)) &#123;</span><br><span class="line">                LL w=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;mid;j++,w=w*wn%MOD) &#123;</span><br><span class="line">                    LL t1=x[i+j],t2=w*x[i+j+mid]%MOD;</span><br><span class="line">                    x[i+j]=(t1+t2)%MOD,x[i+j+mid]=(t1-t2+MOD)%MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(on==<span class="number">-1</span>) &#123;</span><br><span class="line">            LL inv=<span class="built_in">qpow</span>(n,MOD<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) x[i]=x[i]*inv%MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">conv</span><span class="params">(LL a[],LL b[],<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">NTT</span>(a,n,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">NTT</span>(b,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i]=a[i]*b[i]%MOD;</span><br><span class="line">        <span class="built_in">NTT</span>(a,n,<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博弈论"><a href="#博弈论" class="headerlink" title="博弈论"></a>博弈论</h2><h3 id="巴什博弈"><a href="#巴什博弈" class="headerlink" title="巴什博弈"></a>巴什博弈</h3><p>一堆 $n$ 个物品，两个人轮流从中取出 $1 \sim m$个，最后取光者胜。</p>
<p>先手必败条件：$n%(m+1)&#x3D;0$。</p>
<h3 id="威佐夫博弈"><a href="#威佐夫博弈" class="headerlink" title="威佐夫博弈"></a>威佐夫博弈</h3><p>有两堆各若干个物品，两个人轮流从任一堆取至少一个或同时从两堆中取同样多的物品，规定每次至少取一个，多者不限，最后取光者得胜。</p>
<p>先手必败条件：$|n-m|*\frac{1+\sqrt{5}}{2}&#x3D;\min(n,m)$。</p>
<h3 id="斐波那契博弈"><a href="#斐波那契博弈" class="headerlink" title="斐波那契博弈"></a>斐波那契博弈</h3><p>一堆石子有 $n$ 个，两人轮流取，先取者第一次可以取任意多个，但是不能取完，以后每次取的石子数不能超过上次取子数的 $2$ 倍。取完者胜。</p>
<p>先手必败条件：$n$ 是斐波那契数。</p>
<h3 id="Nim-游戏"><a href="#Nim-游戏" class="headerlink" title="Nim 游戏"></a>Nim 游戏</h3><p>有 $n$ 堆石子，两人轮流取，每次取某堆中不少于 $1$ 个，最后取完者胜。</p>
<p>先手必败条件：各堆石子数目全部异或后结果等于 $0$。</p>
<h3 id="阶梯-Nim-游戏"><a href="#阶梯-Nim-游戏" class="headerlink" title="阶梯 Nim 游戏"></a>阶梯 Nim 游戏</h3><p>有 $n$ 个位置 $1\dots n$，每个位置上有 $a_i$ 个石子。两人轮流操作。每次挑选 $1\dots n$ 中任一一个存在石子的位置 $i$，将至少 $1$ 个石子移动至 $i−1$ 位置（也就是最后所有石子都堆在 $0$ 这个位置），谁不能操作谁输。</p>
<p>先手必败条件：奇数位置石子数目全部异或后结果等于 $0$。</p>
<h3 id="反-Nim-游戏"><a href="#反-Nim-游戏" class="headerlink" title="反 Nim 游戏"></a>反 Nim 游戏</h3><p>有 $n$ 堆石子，两人轮流取，每次取某堆中不少于 $1$ 个，最后取完者败。</p>
<p>先手必胜条件：</p>
<ol>
<li><p>各堆石子数目异或结果等于 $0$，且所有石子堆数目全部为 $1$。</p>
</li>
<li><p>各堆石子数目异或结果不等于 $0$，且存在有石子数目大于 $1$ 的石子堆。</p>
</li>
</ol>
<h2 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h2><h3 id="高数公式"><a href="#高数公式" class="headerlink" title="高数公式"></a>高数公式</h3><ul>
<li><p>$\lim \limits_{x\to 0}\frac{\sin x}{x}&#x3D;\lim \limits_{x\to 0}\frac{x}{\sin x}&#x3D;1$</p>
</li>
<li><p>$\lim \limits_{x\to\infty}(1+\frac{1}{x})^x&#x3D;\lim\limits_{x\to 0}(1+x)^{\frac{1}{x}}&#x3D;\mathrm{e}$</p>
</li>
<li><p>$\int_0^1{x^{a-1}(1-x)^{b-1}}&#x3D;\frac{1}{b\binom{a+b-1}{a-1}}(a,b\in\mathbb{Z}^+)$</p>
</li>
</ul>
<h3 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h3><p>$F(n)&#x3D;\sum_{d\mid n}f(d)\Leftrightarrow f(n)&#x3D;\sum_{d\mid n}\mu(d)F(\frac{n}{d})$</p>
<p>$F(n)&#x3D;\sum_{n\mid d}f(d)\Leftrightarrow f(n)&#x3D;\sum_{n\mid d}\mu(\frac{d}{n})F(d)$</p>
<h3 id="数论公式"><a href="#数论公式" class="headerlink" title="数论公式"></a>数论公式</h3><h4 id="1-sum-i-x3D-1-n-sum-j-x3D-1-m-gcd-i-j"><a href="#1-sum-i-x3D-1-n-sum-j-x3D-1-m-gcd-i-j" class="headerlink" title="1. $\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}{\gcd(i,j)}$"></a>1. $\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}{\gcd(i,j)}$</h4><p>由 $\varphi*1&#x3D;\operatorname{id}$ 得：</p>
<p>$\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}{\gcd(i,j)}&#x3D;\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}\sum_{d\mid \gcd(i,j)}{\varphi(d)}&#x3D;\sum_{d&#x3D;1}\varphi(d)\lfloor{\frac{n}{d}}\rfloor\lfloor{\frac{m}{d}}\rfloor$</p>
<h4 id="2-sum-i-x3D-1-n-i-gcd-i-n-x3D-1"><a href="#2-sum-i-x3D-1-n-i-gcd-i-n-x3D-1" class="headerlink" title="2. $\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}$"></a>2. $\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}$</h4><ul>
<li><p>当 $n&#x3D;1$ 时，$\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}&#x3D;1$。</p>
</li>
<li><p>当 $n&gt;1$ 时，$\gcd(i,n)&#x3D;\gcd(n-i,n)$，与 $n$ 互质的数是成对出现的。</p>
<p>因此 $\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}&#x3D;\frac{n\varphi(n)}{2}$。</p>
</li>
</ul>
<p>所以 $\sum_{i&#x3D;1}^n{i[\gcd(i,n)&#x3D;1]}&#x3D;\frac{n\varphi(n)+[n&#x3D;1]}{2}$。</p>
<h4 id="3-mu-2-n-x3D-sum-d-2-mid-n-mu-d"><a href="#3-mu-2-n-x3D-sum-d-2-mid-n-mu-d" class="headerlink" title="3. $\mu^2(n)&#x3D;\sum_{d^2\mid n}\mu(d)$"></a>3. $\mu^2(n)&#x3D;\sum_{d^2\mid n}\mu(d)$</h4><p>证明：</p>
<ul>
<li><p>$n$ 无平方因子，$\mu^2(n)&#x3D;1$。</p>
</li>
<li><p>$n$ 有平方因子，徦设 $d’$ 是最大的数满足 $d’^2\mid n$ 且 $d’$ 无平方因子，那么 $n$ 的其它因子当且仅当其质因子构成的可重集是 $d$ 的质因子集合的子集时，才对 $\sum_{d^2\mid n}\mu(d)$ 产生贡献。</p>
<p>假设  $d’$ 的质因子集合大小为 $m$，那么考虑枚举 $d’$ 质因子集合的子集：$\sum_{i&#x3D;0}^m{(-1)^i\binom{m}{i}}&#x3D;(1-1)^m&#x3D;0$</p>
</li>
</ul>
<p>所以 $\mu^2(n)&#x3D;\sum_{d^2\mid n}\mu(d)$ 成立。</p>
<h4 id="4-sum-i-x3D-1-n-mu-2-i"><a href="#4-sum-i-x3D-1-n-mu-2-i" class="headerlink" title="4. $\sum_{i&#x3D;1}^n{\mu^2(i)}$"></a>4. $\sum_{i&#x3D;1}^n{\mu^2(i)}$</h4><p>$\sum_{i&#x3D;1}^n{\mu^2(i)}&#x3D;\sum_{i&#x3D;1}^n\sum_{d^2\mid i}{\mu(d)}&#x3D;\sum_{d&#x3D;1}^{\sqrt{n}}{\lfloor\frac{n}{d^2}\rfloor}\mu(d)$</p>
<h4 id="5-sum-i-x3D-1-n-operatorname-lcm-i-n"><a href="#5-sum-i-x3D-1-n-operatorname-lcm-i-n" class="headerlink" title="5. $\sum_{i&#x3D;1}^n{\operatorname{lcm}(i,n)}$"></a>5. $\sum_{i&#x3D;1}^n{\operatorname{lcm}(i,n)}$</h4><p>$\begin{aligned}<br>\sum_{i&#x3D;1}^n{\operatorname{lcm}(i,n)}&#x3D; &amp; \sum_{i&#x3D;1}^n{\frac{in}{\gcd(i,n)}} \<br>&#x3D; &amp; \sum_{d\mid n}(n\sum_{i&#x3D;1}^n{\frac{i}{d}[\gcd(i,n)&#x3D;d]}) \<br>&#x3D; &amp; \sum_{d\mid n}n\sum_{i&#x3D;1}^{\frac{n}{d}}{i[\gcd(i,\frac{n}{d})&#x3D;1]} \<br>&#x3D; &amp; n\sum_{d\mid n}\frac{(\frac{n}{d})\varphi(\frac{n}{d})+[\frac{n}{d}&#x3D;1]}{2} \<br>&#x3D; &amp; n\sum_{d\mid n}\frac{d\varphi(d)+[d&#x3D;1]}{2} \<br>\end{aligned}$</p>
<h4 id="6-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-lcm-i-j"><a href="#6-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-lcm-i-j" class="headerlink" title="6. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{lcm}(i,j)}$"></a>6. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{lcm}(i,j)}$</h4><p>$\begin{aligned}<br>\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{lcm}(i,j)} &#x3D; &amp; \sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\frac{ij}{\gcd(i,j)}} \<br>&#x3D; &amp; \sum_{d&#x3D;1}\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\frac{ij[\gcd(i,j)&#x3D;d]}{d}} \<br>&#x3D; &amp; \sum_{d&#x3D;1}\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}{ij[\gcd(i,j)&#x3D;1]} \<br>&#x3D; &amp; \sum_{d&#x3D;1}d\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}{ij[\gcd(i,j)&#x3D;1]}<br>\end{aligned}$</p>
<p>设 $f(n,m)&#x3D;\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{ij[\gcd(i,j)&#x3D;1]}$，</p>
<p>$\begin{aligned}<br>f(n,m)&#x3D; &amp; \sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\sum_{d\mid \gcd(i,j)}{ij\mu(d)} \<br>&#x3D; &amp; \sum_{d&#x3D;1}\sum_{d\mid i}^n\sum_{d\mid j}^m{ij\mu(d)} \<br>&#x3D; &amp; \sum_{d&#x3D;1}d^2\mu(d)\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}{ij} \<br>\end{aligned}$</p>
<p>设 $g(n,m)&#x3D;\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}{ij}$，</p>
<p>根据等差数列求和公式得 $g(n,m)&#x3D;(n+\frac{n(n-1)}{2})(m+\frac{m(m-1)}{2})&#x3D;\frac{nm(n+1)(m+1)}{4}$，</p>
<p>$f(n,m)&#x3D;\sum_{d&#x3D;1}d^2\mu(d)g(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)$，数论分块加速求和。</p>
<p>因此 $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{lcm}(i,j)}&#x3D;\sum_{d&#x3D;1}df(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)$，数论分块加速求和。</p>
<h4 id="7-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-d-ij"><a href="#7-sum-i-x3D-1-n-sum-j-x3D-1-m-operatorname-d-ij" class="headerlink" title="7. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{d}(ij)}$"></a>7. $\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{d}(ij)}$</h4><p>$\begin{aligned}<br>d(ij)&#x3D; &amp; \sum_{x\mid i}\sum_{y\mid j}{[\gcd(x,y)&#x3D;1]} \<br>&#x3D; &amp; \sum_{x\mid i}\sum_{y\mid j}\sum_{d\mid\gcd(x,y)}{\mu(d)} \<br>&#x3D; &amp; \sum_{d&#x3D;1}\mu(d)\sum_{x\mid i}\sum_{y\mid j}{[d\mid \gcd(x,y)]} \<br>&#x3D; &amp; \sum_{d\mid i,d\mid j}\mu(d)\operatorname{d}(\frac{i}{d})\operatorname{d}(\frac{j}{d})<br>\end{aligned}$</p>
<p>代入原式：</p>
<p>$\begin{aligned}<br>\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m{\operatorname{d}(ij)}&#x3D; &amp; \sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\sum_{d\mid i,d\mid j}\mu(d)\operatorname{d}(\frac{i}{d})\operatorname{d}(\frac{j}{d}) \<br>&#x3D; &amp; \sum_{d&#x3D;1}\mu(d)\sum_{d\mid i}^n\sum_{d \mid j}^m\operatorname{d}(\frac{i}{d})\operatorname{d}(\frac{j}{d}) \<br>&#x3D; &amp; \sum_{d&#x3D;1}\mu(d)\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\operatorname{d}(i)\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\operatorname{d}(j) \<br>\end{aligned}$</p>
<p>$O(n)$ 预处理 $\mu,\operatorname{d}$ 的前缀和，$O(\sqrt{n})$ 数论分块加速求和。</p>
<h3 id="组合数学公式"><a href="#组合数学公式" class="headerlink" title="组合数学公式"></a>组合数学公式</h3><ul>
<li><p>$\binom{n}{m}&#x3D;\binom{n-1}{m-1}+\binom{n-1}{m}$</p>
</li>
<li><p>$(x+y)^n&#x3D;\sum_{k&#x3D;0}^{n}\binom{n}{k}x^{n-k}y^k&#x3D;\sum_{k&#x3D;0}^{n}\binom{n}{k}x^{k}y^{n-k}$</p>
</li>
<li><p>$n$ 个无差别的球放进 $k$ 个不同的盒子，不允许空盒子，方案数为 $\binom{n-1}{k-1}$</p>
</li>
<li><p>$n$ 个无差别的球放进 $k$ 个不同的盒子，允许空盒子，方案数为 $\binom{n+k-1}{k-1}$</p>
</li>
<li><p>Catalan 数：<br>递推式：$H(n)&#x3D;\frac{H(n-1)<em>(4</em>n-2)}{n+1}$<br>该递推关系的解为：$H(n)&#x3D;\binom{2n}{n}-\binom{2n}{n-1}&#x3D;\frac{\binom{2n}{n}}{n+1}$</p>
<p>$H_n&#x3D;\begin{cases}<br>\sum_{i&#x3D;1}^{n}H_{i-1}H_{n-i} &amp; n\ge 2,n\in\mathbb{N^+} \<br>1 &amp; n&#x3D;0,1<br>\end{cases}$</p>
<p>以下问题属于 Catalan 数列：</p>
<ol>
<li>有 $2n$ 个人排成一行进入剧场。入场费 $5$ 元。其中只有 $n$ 个人有一张 $5$ 元钞票，另外 $n$ 人只有 $10$ 元钞票，剧院无其它钞票，问有多少中方法使得只要有 $10$ 元的人买票，售票处就有 $5$ 元的钞票找零？</li>
<li>一位大城市的律师在她住所以北 $n$ 个街区和以东 $n$ 个街区处工作。每天她走 $2n$ 个街区去上班。如果他从不穿越（但可以碰到）从家到办公室的对角线，那么有多少条可能的道路？</li>
<li>在圆上选择 $2n$ 个点，将这些点成对连接起来使得所得到的 $n$ 条线段不相交的方法数？</li>
<li>对角线不相交的情况下，将一个凸多边形区域分成三角形区域的方法数？</li>
<li>$n$ 个结点可构造多少个不同的二叉树？</li>
<li>$n$ 个不同的数依次进栈，求不同的出栈结果的种数？</li>
<li>$n$ 个 $+1$ 和 $n$ 个 $-1$ 构成 $2n$ 项 $a_1,a_2,\dots,a_{2n}$，其部分和满足 $a_1+a_2+\dots+a_k\ge0(k&#x3D;1,2,3,\dots,2n)$ 的方法数？</li>
</ol>
</li>
</ul>
<h3 id="低阶等幂求和"><a href="#低阶等幂求和" class="headerlink" title="低阶等幂求和"></a>低阶等幂求和</h3><ul>
<li>$\sum_{i&#x3D;1}^{n} i^{1} &#x3D; \frac{n(n+1)}{2} &#x3D; \frac{1}{2}n^2 +\frac{1}{2} n$</li>
<li>$\sum_{i&#x3D;1}^{n} i^{2} &#x3D; \frac{n(n+1)(2n+1)}{6} &#x3D; \frac{1}{3}n^3 + \frac{1}{2}n^2 + \frac{1}{6}n$</li>
<li>$\sum_{i&#x3D;1}^{n} i^{3} &#x3D; \left[\frac{n(n+1)}{2}\right]^{2} &#x3D; \frac{1}{4}n^4 + \frac{1}{2}n^3 + \frac{1}{4}n^2$</li>
<li>$\sum_{i&#x3D;1}^{n} i^{4} &#x3D; \frac{n(n+1)(2n+1)(3n^2+3n-1)}{30} &#x3D; \frac{1}{5}n^5 + \frac{1}{2}n^4 + \frac{1}{3}n^3 - \frac{1}{30}n$</li>
<li>$\sum_{i&#x3D;1}^{n} i^{5} &#x3D; \frac{n^{2}(n+1)^{2}(2n^2+2n-1)}{12} &#x3D; \frac{1}{6}n^6 + \frac{1}{2}n^5 + \frac{5}{12}n^4 - \frac{1}{12}n^2$</li>
</ul>
<h3 id="约瑟夫环"><a href="#约瑟夫环" class="headerlink" title="约瑟夫环"></a>约瑟夫环</h3><p>$n$ 个人围成一圈，从第一个开始报数，第 $m$ 个将被杀掉，最后剩下一个，其余人都将被杀掉</p>
<p>$f[i]$ 表示 $i$ 个人玩游戏报 $m$ 退出最后胜利者的编号</p>
<p>$f_n &#x3D;<br>\begin{cases}<br>0 &amp; n&#x3D;1\<br>(f _ {n-1}+m) %n &amp; n&gt;1<br>\end{cases}$</p>
<h3 id="勾股数"><a href="#勾股数" class="headerlink" title="勾股数"></a>勾股数</h3><p>所谓勾股数，一般是指能够构成直角三角形三条边的三个正整数</p>
<p>即 $a^2+b^2&#x3D;c^2,a,b,c\in N$</p>
<p>当 $a$ 为大于 $1$ 的奇数 $2n+1$ 时，$b&#x3D;2n²+2n,c&#x3D;2n²+2n+1$</p>
<p>当 $a$ 为大于 $4$ 的偶数 $2n$ 时，$b&#x3D;n²-1,c&#x3D;n²+1$</p>
<h1 id="计算几何"><a href="#计算几何" class="headerlink" title="计算几何"></a>计算几何</h1><h2 id="二维"><a href="#二维" class="headerlink" title="二维"></a>二维</h2><h3 id="点"><a href="#点" class="headerlink" title="点"></a>点</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> DB EPS=<span class="number">1e-8</span>;</span><br><span class="line"><span class="type">const</span> DB PI=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span><span class="params">(DB x)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>(x)&lt;EPS?<span class="number">0</span>:(x&gt;<span class="number">0</span>?<span class="number">1</span>:<span class="number">-1</span>);&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">    DB x,y;</span><br><span class="line">    <span class="built_in">P</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">P</span>(DB x,DB y):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> !<span class="built_in">sgn</span>(x-a.x)&amp;&amp;!<span class="built_in">sgn</span>(y-a.y);&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="built_in">sgn</span>(x-a.x)&lt;<span class="number">0</span>||<span class="built_in">sgn</span>(x-a.x)==<span class="number">0</span>&amp;&amp;<span class="built_in">sgn</span>(y-a.y)&lt;<span class="number">0</span>;&#125;</span><br><span class="line">    P <span class="keyword">operator</span> + (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="built_in">P</span>(x+a.x,y+a.y);&#125;</span><br><span class="line">    P <span class="keyword">operator</span> - (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="built_in">P</span>(x-a.x,y-a.y);&#125;</span><br><span class="line">    P <span class="keyword">operator</span> * (<span class="type">const</span> DB &amp;k) <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="built_in">P</span>(x*k,y*k);&#125;</span><br><span class="line">    P <span class="keyword">operator</span> / (<span class="type">const</span> DB &amp;k) <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="built_in">P</span>(x/k,y/k);&#125;</span><br><span class="line">    <span class="comment">// 点积</span></span><br><span class="line">    DB <span class="keyword">operator</span> * (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> x*a.x+y*a.y;&#125;</span><br><span class="line">    <span class="comment">// 叉积</span></span><br><span class="line">    DB <span class="keyword">operator</span> ^ (<span class="type">const</span> P &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> x*a.y-y*a.x;&#125;</span><br><span class="line">    <span class="comment">// 这个点与 a, b 所成的夹角</span></span><br><span class="line">    <span class="function">DB <span class="title">rad</span><span class="params">(<span class="type">const</span> P &amp;a,<span class="type">const</span> P &amp;b)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">atan2</span>(<span class="built_in">fabs</span>((a-*<span class="keyword">this</span>)^(b-*<span class="keyword">this</span>)),(a-*<span class="keyword">this</span>)*(b-*<span class="keyword">this</span>)));&#125;</span><br><span class="line">    <span class="comment">// 点到原点的距离</span></span><br><span class="line">    <span class="function">DB <span class="title">len</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">hypot</span>(x,y);&#125;</span><br><span class="line">    <span class="comment">// 点到原点的距离的平方</span></span><br><span class="line">    <span class="function">DB <span class="title">len2</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> x*x+y*y;&#125;</span><br><span class="line">    <span class="comment">// 两点距离</span></span><br><span class="line">    <span class="function">DB <span class="title">dist</span><span class="params">(<span class="type">const</span> P &amp;p)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">hypot</span>(x-p.x,y-p.y);&#125;</span><br><span class="line">    <span class="comment">// 绕原点逆时针旋转 90 度</span></span><br><span class="line">    <span class="function">P <span class="title">rotleft</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">P</span>(-y,x);&#125;</span><br><span class="line">    <span class="comment">// 绕原点顺时针旋转 90 度</span></span><br><span class="line">    <span class="function">P <span class="title">rotright</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">P</span>(y,-x);&#125;</span><br><span class="line">    <span class="comment">// 绕 P 点逆时针旋转 angle 度</span></span><br><span class="line">    <span class="function">P <span class="title">rotate</span><span class="params">(<span class="type">const</span> P &amp;p,<span class="type">const</span> DB &amp;angle)</span> </span>&#123;</span><br><span class="line">        P v=*<span class="keyword">this</span>-p;</span><br><span class="line">        DB c=<span class="built_in">cos</span>(angle),s=<span class="built_in">sin</span>(angle);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">P</span>(p.x+v.x*c-v.y*s,p.y+v.x*s+v.y*c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="线"><a href="#线" class="headerlink" title="线"></a>线</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">L</span> &#123;</span><br><span class="line">    P s,t;</span><br><span class="line">    <span class="built_in">L</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">L</span>(P s,P t):<span class="built_in">s</span>(s),<span class="built_in">t</span>(t) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> L &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> s==a.s&amp;&amp;t==a.t;&#125;</span><br><span class="line">    <span class="comment">// -1在左侧，1在右侧，0在直线上</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">relation</span><span class="params">(<span class="type">const</span> P &amp;p)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>((p-s)^(t-s));&#125;</span><br><span class="line">    <span class="comment">// -1 在 T 的逆时针方向，1 在 T 的顺时针方向，0 共线</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">relation</span><span class="params">(<span class="type">const</span> L &amp;T)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>((t-s)^(T.t-T.s));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">P <span class="title">cross_point</span><span class="params">(<span class="type">const</span> L &amp;a)</span> </span>&#123; <span class="comment">// 直线交,需保证不平行不重合</span></span><br><span class="line">        DB s1=(t-s)^(a.s-s);</span><br><span class="line">        DB s2=(t-s)^(a.t-s);</span><br><span class="line">        <span class="keyword">return</span> (a.s*s2-a.t*s1)/(s2-s1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">parallel</span><span class="params">(<span class="type">const</span> L &amp;a)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>((t-s)^(a.t-a.s))==<span class="number">0</span>;&#125; <span class="comment">// 平行</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">P_on_seg</span><span class="params">(<span class="type">const</span> P &amp;p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">sgn</span>((p-s)^(t-s))&amp;&amp;<span class="built_in">sgn</span>((p-s)*(p-t))&lt;=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 求 a, b 直线交是否在线段 b 上无需判断 sgn((p-s)^(t-s))</span></span><br><span class="line">    <span class="comment">// 因为已经保证了该点在线段 b 或线段 b 的延长线上，加上会有精度问题</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="圆"><a href="#圆" class="headerlink" title="圆"></a>圆</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    P p;</span><br><span class="line">    DB r;</span><br><span class="line">    <span class="built_in">C</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">C</span>(P p,DB r):<span class="built_in">p</span>(p),<span class="built_in">r</span>(r) &#123;&#125;</span><br><span class="line">    <span class="function">DB <span class="title">area</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> PI*r*r;&#125;</span><br><span class="line">    <span class="function">DB <span class="title">circumference</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="number">2</span>*PI*r;&#125;</span><br><span class="line">    <span class="comment">// 点和圆的关系</span></span><br><span class="line">    <span class="comment">// 2 圆外</span></span><br><span class="line">    <span class="comment">// 1 圆上</span></span><br><span class="line">    <span class="comment">// 0 圆内</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">p_relation</span><span class="params">(P a)</span> </span>&#123;</span><br><span class="line">        DB d=p.<span class="built_in">dist</span>(a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r)&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r)==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 圆与圆的关系</span></span><br><span class="line">    <span class="comment">// 5 相离</span></span><br><span class="line">    <span class="comment">// 4 外切</span></span><br><span class="line">    <span class="comment">// 3 相交</span></span><br><span class="line">    <span class="comment">// 2 内切</span></span><br><span class="line">    <span class="comment">// 1 内含</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">c_relation</span><span class="params">(C c)</span> </span>&#123;</span><br><span class="line">        DB d=p.<span class="built_in">dist</span>(c.p);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-c.r)&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-c.r)==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">        DB l=<span class="built_in">fabs</span>(r-c.r);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-c.r)&lt;<span class="number">0</span>&amp;&amp;<span class="built_in">sgn</span>(d-l)&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-l)==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-l)&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">DB <span class="title">c_area</span><span class="params">(C c)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> rel=<span class="built_in">c_relation</span>(c);</span><br><span class="line">        <span class="keyword">if</span>(rel&gt;=<span class="number">4</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(rel&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">area</span>(),c.<span class="built_in">area</span>());</span><br><span class="line">        DB d=p.<span class="built_in">dist</span>(c.p);</span><br><span class="line">        DB hf=(r+c.r+d)/<span class="number">2</span>;</span><br><span class="line">        DB ss=<span class="number">2</span>*<span class="built_in">sqrt</span>(hf*(hf-r)*(hf-c.r)*(hf-d));</span><br><span class="line">        DB a1=<span class="built_in">acos</span>((r*r+d*d-c.r*c.r)/(<span class="number">2</span>*r*d))*r*r;</span><br><span class="line">        DB a2=<span class="built_in">acos</span>((c.r*c.r+d*d-r*r)/(<span class="number">2</span>*c.r*d))*c.r*c.r;</span><br><span class="line">        <span class="keyword">return</span> a1+a2-ss;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">P <span class="title">compute_circle_center</span><span class="params">(P a,P b)</span> </span>&#123;<span class="keyword">return</span>(a+b)/<span class="number">2</span>;&#125; <span class="comment">// 两点定圆</span></span><br><span class="line"><span class="function">P <span class="title">compute_circle_center</span><span class="params">(P a,P b,P c)</span> </span>&#123; <span class="comment">// 三点定圆</span></span><br><span class="line">    b=(a+b)/<span class="number">2</span>;</span><br><span class="line">    c=(a+c)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">L</span>(b,b+(a-b).<span class="built_in">rotright</span>()).<span class="built_in">cross_point</span>(&#123;c,c+(a-c).<span class="built_in">rotright</span>()&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="凸包"><a href="#凸包" class="headerlink" title="凸包"></a>凸包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">andrew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(p+<span class="number">1</span>,p+<span class="number">1</span>+n);</span><br><span class="line">    <span class="comment">// 有重复点需要去重，至少三个不相同的点才能构成凸包，根据题意判断点或线段的特殊情况</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++) stk[++top]=p[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">sgn</span>((stk[top]-stk[top<span class="number">-1</span>])^(p[i]-stk[top]))&lt;=<span class="number">0</span>) --top;</span><br><span class="line">        stk[++top]=p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> temp=top;</span><br><span class="line">    stk[++top]=p[n<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n<span class="number">-2</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=temp&amp;&amp;<span class="built_in">sgn</span>((stk[top]-stk[top<span class="number">-1</span>])^(p[i]-stk[top]))&lt;=<span class="number">0</span>) --top;</span><br><span class="line">        stk[++top]=p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1 和 top 为同一个点，凸包上共有 top - 1 个点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最小圆覆盖"><a href="#最小圆覆盖" class="headerlink" title="最小圆覆盖"></a>最小圆覆盖</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C <span class="title">min_circle_cover</span><span class="params">(<span class="type">const</span> vector&lt;P&gt; &amp;T)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;P&gt; <span class="title">a</span><span class="params">(ALL(T))</span></span>;</span><br><span class="line">    <span class="built_in">random_shuffle</span>(<span class="built_in">ALL</span>(a));</span><br><span class="line">    P c=a[<span class="number">0</span>];DB r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="built_in">SZ</span>(a);i++) <span class="keyword">if</span>(!<span class="built_in">p_in_circle</span>(a[i],&#123;c,r&#125;)) &#123;</span><br><span class="line">        c=a[i];r=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++) <span class="keyword">if</span>(!<span class="built_in">p_in_circle</span>(a[j],&#123;c,r&#125;)) &#123;</span><br><span class="line">            c=<span class="built_in">compute_circle_center</span>(a[i],a[j]);</span><br><span class="line">            r=a[j].<span class="built_in">dist</span>(c);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;j;k++) <span class="keyword">if</span>(!<span class="built_in">p_in_circle</span>(a[k],&#123;c,r&#125;)) &#123;</span><br><span class="line">                c=<span class="built_in">compute_circle_center</span>(a[i],a[j],a[k]);</span><br><span class="line">                r=a[k].<span class="built_in">dist</span>(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;c,r&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三维"><a href="#三维" class="headerlink" title="三维"></a>三维</h2><h3 id="点-1"><a href="#点-1" class="headerlink" title="点"></a>点</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">    DB x,y,z;</span><br><span class="line">    <span class="built_in">P</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">P</span>(DB x,DB y,DB z):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y),<span class="built_in">z</span>(z) &#123;&#125;</span><br><span class="line">    <span class="function">DB <span class="title">dist</span><span class="params">(<span class="type">const</span> P &amp;p)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">sqrt</span>((x-p.x)*(x-p.x)+(y-p.y)*(y-p.y)+(z-p.z)*(z-p.z));&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="球"><a href="#球" class="headerlink" title="球"></a>球</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> &#123;</span><br><span class="line">    P p;</span><br><span class="line">    DB r;</span><br><span class="line">    <span class="built_in">S</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">S</span>(P p,DB r):<span class="built_in">p</span>(p),<span class="built_in">r</span>(r) &#123;&#125;</span><br><span class="line">    <span class="function">DB <span class="title">vol</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="number">4</span>*PI*r*r*r/<span class="number">3</span>;&#125; <span class="comment">// 体积</span></span><br><span class="line">    <span class="function">DB <span class="title">s_s_area</span><span class="params">(S &amp;T)</span> </span>&#123; <span class="comment">// 两球体积交</span></span><br><span class="line">        DB d=p.<span class="built_in">dist</span>(T.p);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-T.r)&gt;=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d-<span class="built_in">fabs</span>(r-T.r))&lt;=<span class="number">0</span>) <span class="keyword">return</span> r&lt;T.r?<span class="built_in">vol</span>():T.<span class="built_in">vol</span>();</span><br><span class="line">        DB h1=r-(r*r-T.r*T.r+d*d)/(<span class="number">2</span>*d);</span><br><span class="line">        DB h2=T.r-(T.r*T.r-r*r+d*d)/(<span class="number">2</span>*d);</span><br><span class="line">        <span class="keyword">return</span> PI/<span class="number">3</span>*(h1*h1*(<span class="number">3</span>*r-h1)+h2*h2*(<span class="number">3</span>*T.r-h2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li>圆台体积公式：$V&#x3D;\frac1 3\pi h(R^2+r^2+Rr)$ （$r$ 为上底半径、$R$ 为下底半径、$h$ 为高）</li>
</ul>
<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N], temp[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> mid, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = l, j = mid + <span class="number">1</span>, t = l;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt;= a[j]) &#123;</span><br><span class="line">            temp[t++] = a[i++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            temp[t++] = a[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) &#123;</span><br><span class="line">        temp[t++] = a[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) &#123;</span><br><span class="line">        temp[t++] = a[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">        a[i] = temp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &lt; r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">merge_sort</span>(l, mid);</span><br><span class="line">        <span class="built_in">merge_sort</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">merge</span>(l, mid, r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &lt; r) &#123;</span><br><span class="line">        <span class="type">int</span> i = l, j = r, key = a[l];</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; a[j] &gt;= key) &#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">                a[i++] = a[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; a[i] &lt;= key) &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">                a[j--] = a[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        a[i] = key;</span><br><span class="line">        <span class="built_in">quick_sort</span>(l, i - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">quick_sort</span>(i + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    b.<span class="built_in">PB</span>(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sort</span>(<span class="built_in">ALL</span>(b));</span><br><span class="line">b.<span class="built_in">resize</span>(<span class="built_in">unique</span>(<span class="built_in">ALL</span>(b)) - b.<span class="built_in">begin</span>());</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    a[i] = <span class="built_in">lower_bound</span>(<span class="built_in">ALL</span>(b), a[i]) - b.<span class="built_in">begin</span>() + <span class="number">1</span>; <span class="comment">// 最小值为1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h2><ul>
<li>整数最小值</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r) &#123;</span><br><span class="line">        <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) r=mid;</span><br><span class="line">        <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>整数最大值</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// 最大值</span></span><br><span class="line">    <span class="keyword">while</span>(l&lt;r) &#123;</span><br><span class="line">        <span class="type">int</span> mid=l+r+<span class="number">1</span>&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l=mid;</span><br><span class="line">        <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>实数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DB <span class="title">find</span><span class="params">(DB l,DB r)</span> </span>&#123; <span class="comment">// 实数二分</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">        DB mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">      	<span class="keyword">if</span>(<span class="built_in">check</span>(mid)) l=mid;</span><br><span class="line">      	<span class="keyword">else</span> r=mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三分"><a href="#三分" class="headerlink" title="三分"></a>三分</h2><ul>
<li>三分用来寻找凸函数或凹函数的极值</li>
<li>以寻找凸函数的极大值为例</li>
<li>实数三分</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    DB mid=(r-l)/<span class="number">3.0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">calc</span>(l+mid)&gt;<span class="built_in">calc</span>(r-mid)) r=r-mid;</span><br><span class="line">    <span class="keyword">else</span> l=l+mid;</span><br><span class="line">&#125;</span><br><span class="line">mx=<span class="built_in">calc</span>(l);</span><br></pre></td></tr></table></figure>

<ul>
<li>整数三分</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(l&lt;r) &#123;</span><br><span class="line">    <span class="type">int</span> lmid=l+(r-l)/<span class="number">3</span>,rmid=r-(r-l)/<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">calc</span>(lmid)&gt;<span class="built_in">calc</span>(rmid)) r=rmid<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> l=lmid+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">mx=<span class="built_in">calc</span>(l);</span><br></pre></td></tr></table></figure>

<h2 id="高精度"><a href="#高精度" class="headerlink" title="高精度"></a>高精度</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">bign</span> &#123;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="type">int</span> num[<span class="number">1005</span>];</span><br><span class="line">    <span class="built_in">bign</span>() &#123;</span><br><span class="line">        len=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(num,<span class="number">0</span>,<span class="keyword">sizeof</span> num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(len!=a.len) <span class="keyword">return</span> len&lt;a.len;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=len;i&gt;=<span class="number">1</span>;i--) <span class="keyword">if</span>(num[i]!=a.num[i]) <span class="keyword">return</span> num[i]&lt;a.num[i];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &gt; (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> a&lt;*<span class="keyword">this</span>;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;= (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> !(a&lt;*<span class="keyword">this</span>);&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &gt;= (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> !(*<span class="keyword">this</span>&lt;a);&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> a&lt;*<span class="keyword">this</span>||*<span class="keyword">this</span>&lt;a;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> bign &amp;a) <span class="type">const</span> &#123;<span class="keyword">return</span> !(a&lt;*<span class="keyword">this</span>)&amp;&amp;!(*<span class="keyword">this</span>&lt;a);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">bign <span class="title">get</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    bign res;</span><br><span class="line">    res.len=<span class="built_in">SZ</span>(s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=res.len;i++) res.num[i]=s[res.len-i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">bign <span class="title">get</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    bign res;</span><br><span class="line">    <span class="keyword">while</span>(n) &#123;</span><br><span class="line">        res.num[res.len++]=n%<span class="number">10</span>;</span><br><span class="line">        n/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(res.len&gt;<span class="number">1</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(bign a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a.len;i;i--) cout&lt;&lt;a.num[i];</span><br><span class="line">    cout&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">non_zero</span><span class="params">(bign T)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> T.len&gt;<span class="number">1</span>||T.len==<span class="number">1</span>&amp;&amp;T.num[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> + (bign a,bign b) &#123;</span><br><span class="line">    bign res;</span><br><span class="line">    res.len=<span class="built_in">max</span>(a.len,b.len);</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=res.len;i++) &#123;</span><br><span class="line">        res.num[i]=x+a.num[i]+b.num[i];</span><br><span class="line">        x=res.num[i]/<span class="number">10</span>;</span><br><span class="line">        res.num[i]%=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x) res.num[++res.len]=x;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> - (bign a,bign b) &#123; <span class="comment">// a &gt; b</span></span><br><span class="line">    bign res;</span><br><span class="line">    res.len=<span class="built_in">max</span>(a.len,b.len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=res.len;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(a.num[i]&lt;b.num[i]) --a.num[i+<span class="number">1</span>],a.num[i]+=<span class="number">10</span>;</span><br><span class="line">        res.num[i]=a.num[i]-b.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> * (bign a,<span class="type">int</span> b) &#123;</span><br><span class="line">    bign res;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=a.len;i++) &#123;</span><br><span class="line">        x+=a.num[i]*b;</span><br><span class="line">        res.num[res.len++]=x%<span class="number">10</span>;</span><br><span class="line">        x/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(x) &#123;</span><br><span class="line">        res.num[res.len++]=x%<span class="number">10</span>;</span><br><span class="line">        x/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> * (bign a,bign b) &#123;</span><br><span class="line">    bign res;</span><br><span class="line">    res.len=a.len+b.len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=res.len;i++) res.num[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=a.len;i++) &#123;</span><br><span class="line">        <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=b.len;j++) &#123;</span><br><span class="line">            res.num[i+j<span class="number">-1</span>]+=a.num[i]*b.num[j]+x;</span><br><span class="line">            x=res.num[i+j<span class="number">-1</span>]/<span class="number">10</span>;</span><br><span class="line">            res.num[i+j<span class="number">-1</span>]%=<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res.num[i+b.len]+=x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> / (bign a,<span class="type">int</span> b) &#123;</span><br><span class="line">    bign res;</span><br><span class="line">    res.len=a.len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a.len,t=<span class="number">0</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">        t=t*<span class="number">10</span>+a.num[i];</span><br><span class="line">        <span class="keyword">if</span>(t&gt;=b) res.num[i]=t/b,t%=b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> / (bign a,bign b) &#123;</span><br><span class="line">    bign res,x;</span><br><span class="line">    res.len=a.len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=res.len;i++) res.num[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a.len;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">        x=x*<span class="number">10</span>; <span class="comment">// bign * int</span></span><br><span class="line">        x.num[<span class="number">1</span>]=a.num[i];</span><br><span class="line">        <span class="keyword">while</span>(x&gt;b||x==b) &#123;</span><br><span class="line">            x=x-b; <span class="comment">// bign - bign</span></span><br><span class="line">            res.num[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">bign <span class="keyword">operator</span> % (bign a,bign b) &#123;</span><br><span class="line">    bign res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a.len;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">        res=res*<span class="number">10</span>; <span class="comment">// bign * int</span></span><br><span class="line">        res.num[<span class="number">1</span>]=a.num[i];</span><br><span class="line">        <span class="keyword">while</span>(res&gt;b||res==b) res=res-b; <span class="comment">// bign - bign</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(res.len&gt;<span class="number">1</span>&amp;&amp;res.num[res.len]==<span class="number">0</span>) res.len--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">bign <span class="title">gcd</span><span class="params">(bign a,bign b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">non_zero</span>(b)?<span class="built_in">gcd</span>(b,a%b):a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">bign <span class="title">qpow</span><span class="params">(bign a,bign b,bign m)</span> </span>&#123;</span><br><span class="line">    bign ret;</span><br><span class="line">    ret.num[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">non_zero</span>(b)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b.num[<span class="number">1</span>]&amp;<span class="number">1</span>) ret=ret*a%m;</span><br><span class="line">        a=a*a%m;</span><br><span class="line">        b=b/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="浮点数的精度问题"><a href="#浮点数的精度问题" class="headerlink" title="浮点数的精度问题"></a>浮点数的精度问题</h2><p><code>int sgn(DB x) &#123;return fabs(x)&lt;EPS?0:(x&gt;0?1:-1);&#125;</code></p>
<table>
<thead>
<tr>
<th>传统意义</th>
<th>修正写法1</th>
<th>修正写法2</th>
</tr>
</thead>
<tbody><tr>
<td>a &#x3D;&#x3D; b</td>
<td>sgn(a - b) &#x3D;&#x3D; 0</td>
<td>fabs(a - b) &lt; eps</td>
</tr>
<tr>
<td>a !&#x3D; b</td>
<td>sgn(a - b) !&#x3D; 0</td>
<td>fabs(a - b) &gt; eps</td>
</tr>
<tr>
<td>a &lt; b</td>
<td>sgn(a - b) &lt; 0</td>
<td>a - b &lt; -eps</td>
</tr>
<tr>
<td>a &lt;&#x3D; b</td>
<td>sgn(a - b) &lt;&#x3D; 0</td>
<td>a - b &lt; eps</td>
</tr>
<tr>
<td>a &gt; b</td>
<td>sgn(a - b) &gt; 0</td>
<td>a - b &gt; eps</td>
</tr>
<tr>
<td>a &gt;&#x3D; b</td>
<td>sgn(a - b) &gt;&#x3D; 0</td>
<td>a - b &gt; -eps</td>
</tr>
</tbody></table>
<h2 id="Lowbit-前缀和"><a href="#Lowbit-前缀和" class="headerlink" title="Lowbit 前缀和"></a>Lowbit 前缀和</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    n++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;n&gt;<span class="number">1</span>;n-=(n&gt;&gt;<span class="number">1</span>),i&lt;&lt;=<span class="number">1</span>) res+=i*(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">mt19937 <span class="title">mt</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">uniform_int_distribution&lt;<span class="type">int</span>&gt; <span class="title">rd1</span><span class="params">(<span class="number">0</span>,<span class="number">10000</span>)</span></span>; <span class="comment">//   整数</span></span><br><span class="line"><span class="function">uniform_real_distribution&lt;<span class="type">double</span>&gt; <span class="title">rd2</span><span class="params">(<span class="number">0</span>,<span class="number">1</span>)</span></span>; <span class="comment">// 浮点数</span></span><br><span class="line">cout&lt;&lt;<span class="built_in">rd1</span>(mt)&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;<span class="built_in">rd2</span>(mt)&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="builtin-系列函数（位运算）"><a href="#builtin-系列函数（位运算）" class="headerlink" title="_builtin 系列函数（位运算）"></a>_<em>builtin</em> 系列函数（位运算）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回最低位的 1 是从后向前的第几位，比如 2(10)，返回 2</span></span><br><span class="line"><span class="type">int</span> __builtin_ffs(<span class="type">unsigned</span> <span class="type">int</span> x)</span><br><span class="line"><span class="comment">// 返回前导 0 的个数，比如 2(10)，返回 30，x = 0 时结果未定义</span></span><br><span class="line"><span class="type">int</span> __builtin_clz(<span class="type">unsigned</span> <span class="type">int</span> x)</span><br><span class="line"><span class="comment">// 返回末尾0的个数，比如 2(10)，返回 1，x = 0 时结果未定义</span></span><br><span class="line"><span class="type">int</span> __builtin_ctz(<span class="type">unsigned</span> <span class="type">int</span> x)</span><br><span class="line"><span class="comment">// 返回 1 的个数</span></span><br><span class="line"><span class="type">int</span> __builtin_popcount(<span class="type">unsigned</span> <span class="type">int</span> x)</span><br><span class="line"><span class="comment">// 返回 1 的个数模 2 的结果</span></span><br><span class="line"><span class="type">int</span> __builtin_parity(<span class="type">unsigned</span> <span class="type">int</span> x)</span><br><span class="line"><span class="comment">// usigned long long 版本在函数名后加 ll</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/22/%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A/HDU%205029/" rel="prev" title="HDU 5029. Relief grain">
                  <i class="fa fa-chevron-left"></i> HDU 5029. Relief grain
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/04/29/%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A/HDU%202476/" rel="next" title="HDU. 2476 String painter">
                  HDU. 2476 String painter <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">c4Lnn</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"c4Lnn","repo":"c4Lnn.github.io","client_id":"c28f33d7cdbaa0b55dfc","client_secret":"a5a9a820c766b6294a8d197661b0931f1c8255e8","admin_user":"c4Lnn","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"b0cc07584c975c3a4d6531644657ec29"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
